<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bay Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        ::-webkit-scrollbar-track { background: #e5e7eb; border-radius: 10px; }
        .sidebar-icon { width: 1.25rem; height: 1.25rem; margin-right: 0.75rem; }
        .status-dot { width: 0.75rem; height: 0.75rem; border-radius: 9999px; margin-right: 0.5rem; }
        .bay-card { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .bay-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); }
        .modal-overlay { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease; }
        .page-content { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .sidebar-link.active { background-color: #1f2937; /* gray-900 */ color: white; }

        /* Dashboard Mini-Calendar */
        .calendar-day { padding: 0.25rem; text-align: center; cursor: pointer; border-radius: 0.375rem; transition: background-color 0.2s ease-in-out; position: relative; }
        .calendar-day:hover:not(.other-month) { background-color: #f3f4f6; }
        .calendar-day.other-month { color: #9ca3af; cursor: default; }
        .calendar-day.current-day { background-color: #4f46e5; color: white; font-weight: 600; }
        .calendar-day.current-day:hover { background-color: #4338ca; }
        .calendar-day.has-booking:not(.current-day) { background-color: #e0e7ff; }
        .calendar-day.has-booking:hover:not(.current-day) { background-color: #c7d2fe; }
        .calendar-day .day-number::after { content: ''; display: block; width: 6px; height: 6px; border-radius: 50%; margin: 2px auto 0; opacity: 0; transition: opacity 0.2s; }
        .calendar-day.has-booking .day-number::after { opacity: 1; background-color: #ef4444; }
        .calendar-day.has-multiple-bookings .day-number::after { background-color: #8b5cf6; }
        .calendar-tooltip { position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%) translateY(-5px); background-color: #1f2937; color: white; padding: 6px 10px; border-radius: 6px; font-size: 0.75rem; white-space: pre-wrap; z-index: 50; opacity: 0; visibility: hidden; transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out; pointer-events: none; min-width: 150px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .calendar-day:hover .calendar-tooltip { opacity: 1; visibility: visible; }
        #dayDetailBox { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); z-index: 1000; border: 1px solid #e5e7eb; width: 90%; max-width: 400px; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        #dayDetailBox.visible { opacity: 1; visibility: visible; }

        /* Bay Scheduling Page Styles */
        .calendar-view-button.active { background-color: #4f46e5; color: white; }
        .timeslot { border-top: 1px solid #e5e7eb; padding: 4px; font-size: 0.75rem; color: #6b7280; text-align: right; }
        .bay-header { padding: 8px; font-weight: 500; text-align: center; border-bottom: 1px solid #e5e7eb; background-color: #f9fafb; }
        .day-view-slot { border: 1px solid #e5e7eb; min-height: 40px; cursor: pointer; position: relative; }
        .day-view-slot:hover { background-color: #eff6ff; }
        .booking-block { position: absolute; background-color: #60a5fa; color: white; border: 1px solid #3b82f6; border-radius: 4px; padding: 2px 4px; font-size: 0.7rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; z-index: 10;}
        .booking-block:hover { filter: brightness(1.1); }
        .month-view-day { border: 1px solid #e5e7eb; min-height: 100px; padding: 4px; cursor: pointer; }
        .month-view-day:hover { background-color: #f9fafb; }
        .month-view-day.other-month-sched { background-color: #f9fafb; color: #9ca3af; }
        .month-view-booking-indicator { display:block; font-size:0.7rem; background-color: #bfdbfe; color:#1e40af; padding:1px 3px; border-radius:3px; margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
        .table-action-button {
            padding: 0.375rem 0.75rem; /* py-1.5 px-3 */
            font-size: 0.75rem; /* text-xs */
            border-radius: 0.375rem; /* rounded-md */
            transition: background-color 0.15s ease-in-out;
        }
        .chart-container {
            height: 300px; /* Adjust as needed */
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen overflow-hidden">
        <aside class="w-64 bg-gray-800 text-gray-100 flex flex-col fixed inset-y-0 left-0 z-30">
            <div class="h-20 flex items-center justify-center border-b border-gray-700">
                <svg class="h-8 w-auto text-indigo-400 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
                <h1 class="text-xl font-semibold">BayMaster</h1>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
                <a href="#dashboard" data-page="dashboardPage" class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white group active">
                    <svg class="sidebar-icon text-gray-400 group-hover:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>Dashboard
                </a>
                <div>
                    <h3 class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mt-3 mb-1">Bay Operations</h3>
                    <a href="#bayScheduling" data-page="baySchedulingPage" class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white group">
                        <svg class="sidebar-icon text-gray-400 group-hover:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>Bay Scheduling
                    </a>
                    <a href="#bayConfiguration" data-page="bayConfigurationPage" class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white group">
                        <svg class="sidebar-icon text-gray-400 group-hover:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>Bay Configuration
                    </a>
                    <a href="#downtimeMaintenance" data-page="downtimeMaintenancePage" class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white group">
                        <svg class="sidebar-icon text-gray-400 group-hover:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>Downtime & Maintenance
                    </a>
                </div>
                <div>
                    <h3 class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mt-3 mb-1">Workflow</h3>
                    <a href="#jobCards" data-page="jobCardsPage" class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white group">
                        <svg class="sidebar-icon text-gray-400 group-hover:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>Job Cards
                    </a>
                    <a href="#technicianManagement" data-page="technicianManagementPage" class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white group">
                        <svg class="sidebar-icon text-gray-400 group-hover:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>Technician Management
                    </a>
                </div>
                <div>
                    <h3 class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mt-3 mb-1">System</h3>
                    <a href="#notificationsAlerts" data-page="notificationsAlertsPage" class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white group">
                        <svg class="sidebar-icon text-gray-400 group-hover:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>Notifications & Alerts
                    </a>
                    <a href="#userRoleManagement" data-page="userRoleManagementPage" class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white group">
                        <svg class="sidebar-icon text-gray-400 group-hover:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>User & Role Management
                    </a>
                </div>
            </nav>
            <div class="p-4 border-t border-gray-700">
                <div class="flex items-center"><img class="h-10 w-10 rounded-full object-cover" src="https://placehold.co/100x100/6366f1/e0e7ff?text=User" alt="User Avatar" onerror="this.src='https://placehold.co/100x100/cccccc/ffffff?text=U'"><div class="ml-3"><p class="text-sm font-medium text-white">Alex Johnson</p><p class="text-xs text-gray-400">Administrator</p></div></div>
            </div>
        </aside>

        <div class="flex-1 ml-64 p-6 md:p-8 overflow-y-auto">
            
            <div id="dashboardPage" class="page-content">
                <header class="mb-8"><div class="flex flex-col md:flex-row justify-between items-center"><h2 class="text-3xl font-semibold text-gray-800">Bay Utilization Dashboard</h2><div class="flex items-center space-x-4 mt-4 md:mt-0"><div class="relative"><select class="appearance-none bg-white border border-gray-300 text-gray-700 py-2 px-4 pr-8 rounded-md leading-tight focus:outline-none focus:bg-white focus:border-indigo-500 text-sm"><option>Main Tenant</option><option>Tenant Alpha</option><option>Tenant Beta</option></select><div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"><svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg></div></div><button class="p-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"><svg class="h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg></button><button id="addNewBayBtnDashboard" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md text-sm flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>Add New Bay</button></div></div></header>
                <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-md"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-gray-500">Total Bays</p><p class="text-3xl font-semibold text-gray-800">12</p></div><div class="p-3 bg-indigo-100 rounded-full"><svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" /></svg></div></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-md"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-gray-500">Active Bays</p><p class="text-3xl font-semibold text-gray-800">8</p></div><div class="p-3 bg-green-100 rounded-full"><svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-md"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-gray-500">Maintenance</p><p class="text-3xl font-semibold text-gray-800">2</p></div><div class="p-3 bg-yellow-100 rounded-full"><svg class="h-6 w-6 text-yellow-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg></div></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-md"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-gray-500">Utilization</p><p class="text-3xl font-semibold text-gray-800">75%</p></div><div class="p-3 bg-blue-100 rounded-full"><svg class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg></div></div></div>
                </section>
                <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Bay Utilization</h3>
                        <div class="chart-container mx-auto max-w-xs">
                             <canvas id="bayUtilizationChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Weekly Booking Trends</h3>
                        <div class="chart-container">
                            <canvas id="weeklyBookingsChart"></canvas>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="flex justify-between items-center mb-4"><h3 class="text-xl font-semibold text-gray-700">Real-Time Bay Status</h3><div class="flex space-x-2"><span class="px-3 py-1 text-xs font-medium rounded-full bg-green-100 text-green-700">Available</span><span class="px-3 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700">Occupied</span><span class="px-3 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-700">Maintenance</span><span class="px-3 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700">Scheduled</span><span class="px-3 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-700">Cleaning</span></div></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <div class="bg-white p-5 rounded-lg shadow-md bay-card flex flex-col justify-between h-full"><div> <div class="flex items-center justify-between mb-3"><h4 class="text-lg font-semibold text-gray-800">Bay A-01</h4><span class="px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-700">Available</span></div><p class="text-sm text-gray-500 mb-1">Type: Standard</p><p class="text-sm text-gray-500 mb-3">Next: 02:00 PM (Job #J4568)</p><div class="w-full bg-gray-200 rounded-full h-2 mb-3"><div class="bg-green-500 h-2 rounded-full" style="width: 10%"></div></div></div><div class="mt-auto pt-3 flex justify-end space-x-2"><button class="text-xs bg-indigo-500 hover:bg-indigo-600 text-white py-1.5 px-3 rounded-md open-job-details-modal" data-job-id="J4568" data-bay-id="A-01">Start Job</button><button class="text-xs bg-gray-200 hover:bg-gray-300 text-gray-700 py-1.5 px-3 rounded-md open-job-details-modal" data-job-id="J4568" data-bay-id="A-01">Details</button></div></div>
                        <div class="bg-white p-5 rounded-lg shadow-md bay-card flex flex-col justify-between h-full"><div> <div class="flex items-center justify-between mb-3"><h4 class="text-lg font-semibold text-gray-800">Bay A-02</h4><span class="px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-700">Occupied</span></div><p class="text-sm text-gray-600 mb-1">Job: #J4567 - Oil Change</p><p class="text-sm text-gray-500 mb-1">Technician: Mike L.</p><p class="text-sm text-gray-500 mb-3">Ends: 11:30 AM</p><div class="w-full bg-gray-200 rounded-full h-2 mb-3"><div class="bg-red-500 h-2 rounded-full" style="width: 75%"></div></div></div><div class="mt-auto pt-3 flex justify-end space-x-2"><button class="text-xs bg-red-500 hover:bg-red-600 text-white py-1.5 px-3 rounded-md">End Job</button><button class="text-xs bg-gray-200 hover:bg-gray-300 text-gray-700 py-1.5 px-3 rounded-md open-job-details-modal" data-job-id="J4567" data-bay-id="A-02">Details</button></div></div>
                        <div class="bg-white p-5 rounded-lg shadow-md bay-card flex flex-col justify-between h-full"><div> <div class="flex items-center justify-between mb-3"><h4 class="text-lg font-semibold text-gray-800">Bay B-01</h4><span class="px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-700">Maintenance</span></div><p class="text-sm text-gray-600 mb-1">Reason: Lift Repair</p><p class="text-sm text-gray-500 mb-3">Until: EOD</p><div class="w-full bg-gray-200 rounded-full h-2 mb-3"><div class="bg-yellow-500 h-2 rounded-full" style="width: 100%"></div></div></div><div class="mt-auto pt-3 flex justify-end space-x-2"><button class="text-xs bg-yellow-500 hover:bg-yellow-600 text-white py-1.5 px-3 rounded-md">Mark Active</button><button class="text-xs bg-gray-200 hover:bg-gray-300 text-gray-700 py-1.5 px-3 rounded-md open-maintenance-log-modal" data-bay-id="B-01">Log</button></div></div>
                        <div class="bg-white p-5 rounded-lg shadow-md bay-card flex flex-col justify-between h-full"><div><div class="flex items-center justify-between mb-3"><h4 class="text-lg font-semibold text-gray-800">Bay C-01</h4><span class="px-3 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-700">Scheduled</span></div><p class="text-sm text-gray-600 mb-1">Next Job: #J4569 - Tire Rotation</p><p class="text-sm text-gray-500 mb-3">Starts: 01:00 PM</p><div class="w-full bg-gray-200 rounded-full h-2 mb-3"><div class="bg-blue-500 h-2 rounded-full" style="width: 30%"></div></div></div><div class="mt-auto pt-3 flex justify-end space-x-2"><button class="text-xs bg-gray-200 hover:bg-gray-300 text-gray-700 py-1.5 px-3 rounded-md open-job-details-modal" data-job-id="J4569" data-bay-id="C-01">Details</button></div></div>
                        <div class="bg-white p-5 rounded-lg shadow-md bay-card flex flex-col justify-between h-full"><div><div class="flex items-center justify-between mb-3"><h4 class="text-lg font-semibold text-gray-800">Bay A-03</h4><span class="px-3 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-700">Cleaning</span></div><p class="text-sm text-gray-600 mb-1">Status: Post-Job Cleanup</p><p class="text-sm text-gray-500 mb-3">Available in: ~15 mins</p><div class="w-full bg-gray-200 rounded-full h-2 mb-3"><div class="bg-purple-500 h-2 rounded-full" style="width: 50%"></div></div></div><div class="mt-auto pt-3 flex justify-end space-x-2"><button class="text-xs bg-purple-500 hover:bg-purple-600 text-white py-1.5 px-3 rounded-md">Mark Available</button></div></div>
                        <div id="addBayCardBtnDashboard" class="bg-white p-5 rounded-lg shadow-md bay-card border-2 border-dashed border-gray-300 flex items-center justify-center hover:border-indigo-500 cursor-pointer h-full"><div class="text-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-400 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg><p class="text-sm font-medium text-gray-500">Add New Bay</p></div></div>
                    </div>
                </section>
                <section class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-md"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold text-gray-700">Schedule Overview</h3><div class="flex items-center space-x-1"><button id="todayBtn" class="text-xs bg-indigo-100 hover:bg-indigo-200 text-indigo-700 font-medium py-1 px-2.5 rounded-md">Today</button><button id="prevMonthBtn" class="p-1.5 text-gray-500 hover:text-indigo-600 rounded-full hover:bg-gray-100"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button><span id="currentMonthYear" class="text-md font-medium text-gray-700 mx-1 w-28 text-center">May 2024</span><button id="nextMonthBtn" class="p-1.5 text-gray-500 hover:text-indigo-600 rounded-full hover:bg-gray-100"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg></button></div></div><div class="bg-gray-50 p-4 rounded-lg"><div class="grid grid-cols-7 gap-1 text-center text-xs text-gray-500 mb-2"><span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span></div><div id="calendarDaysContainer" class="grid grid-cols-7 gap-1 text-sm"></div></div></div>
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md"><h3 class="text-lg font-semibold text-gray-700 mb-4">Recent Activity</h3><ul class="space-y-3"><li class="flex items-center text-sm"><div class="status-dot bg-green-500"></div><span class="text-gray-600">Bay A-01 marked <span class="font-medium text-green-600">Available</span> by System.</span><span class="ml-auto text-xs text-gray-400">10:35 AM</span></li><li class="flex items-center text-sm"><div class="status-dot bg-red-500"></div><span class="text-gray-600">Job #J4566 completed on Bay A-04.</span><span class="ml-auto text-xs text-gray-400">10:30 AM</span></li><li class="flex items-center text-sm"><div class="status-dot bg-yellow-500"></div><span class="text-gray-600">Bay B-01 scheduled for <span class="font-medium text-yellow-600">Maintenance</span> (Lift Inspection).</span><span class="ml-auto text-xs text-gray-400">09:15 AM</span></li></ul><button class="mt-4 text-sm text-indigo-600 hover:text-indigo-800 font-medium">View All Logs</button></div>
                </section>
                <footer class="mt-12 text-center text-sm text-gray-500">&copy; 2024 BayMaster Solutions. All rights reserved.</footer>
            </div>

            <div id="baySchedulingPage" class="page-content hidden">
                <header class="mb-6 bg-white p-4 rounded-lg shadow">
                    <div class="flex flex-col sm:flex-row justify-between items-center">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-4 sm:mb-0">Bay Scheduling</h2>
                        <div class="flex items-center space-x-2 mb-4 sm:mb-0">
                            <button id="schedTodayBtn" class="text-sm bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-3 rounded-md">Today</button>
                            <button id="schedPrevBtn" class="p-2 rounded-md hover:bg-gray-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                            </button>
                            <span id="schedCurrentDateDisplay" class="text-lg font-medium text-gray-700 w-48 text-center">May 28, 2025</span>
                            <button id="schedNextBtn" class="p-2 rounded-md hover:bg-gray-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                            </button>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="relative">
                                <select id="bayTypeFilter" class="text-sm appearance-none bg-white border border-gray-300 text-gray-700 py-2 px-3 pr-8 rounded-md leading-tight focus:outline-none focus:border-indigo-500">
                                    <option value="all">All Bay Types</option>
                                    <option value="standard">Standard Lift</option>
                                    <option value="pit">Pit Style</option>
                                    <option value="paint">Paint Booth</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"><svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg></div>
                            </div>
                             <button id="newBookingBtnSchedPage" class="text-sm bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-md flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                                New Booking
                            </button>
                        </div>
                    </div>
                     <div class="mt-4 flex justify-start space-x-2 border-b pb-2">
                        <button data-view="day" class="calendar-view-button text-sm py-2 px-4 rounded-md hover:bg-gray-200 active">Day</button>
                        <button data-view="week" class="calendar-view-button text-sm py-2 px-4 rounded-md hover:bg-gray-200">Week</button>
                        <button data-view="month" class="calendar-view-button text-sm py-2 px-4 rounded-md hover:bg-gray-200">Month</button>
                    </div>
                </header>

                <div id="dailyCalendarView" class="calendar-sub-view bg-white rounded-lg shadow overflow-hidden">
                    <div class="grid grid-cols-[80px_repeat(3,1fr)] " id="dailyViewGridHeader"> <div class="timeslot sticky left-0 bg-white z-10">Time</div>
                        <div class="bay-header">Bay A-01</div>
                        <div class="bay-header">Bay A-02</div>
                        <div class="bay-header">Bay A-03</div>
                        </div>
                    <div class="overflow-auto" style="max-height: 60vh;">
                        <div class="grid grid-cols-[80px_repeat(3,1fr)] " id="dailyViewGridContent">
                            </div>
                    </div>
                </div>

                <div id="weeklyCalendarView" class="calendar-sub-view hidden bg-white p-4 rounded-lg shadow">
                    <div class="grid grid-cols-7 gap-px border border-gray-200">
                        <div class="text-center font-medium py-2 bg-gray-50">Mon</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Tue</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Wed</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Thu</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Fri</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Sat</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Sun</div>
                    </div>
                    <div class="grid grid-cols-7 gap-px border border-t-0 border-gray-200" id="weeklyViewGridContent" style="min-height: 50vh;">
                        </div>
                </div>

                <div id="monthlyCalendarView" class="calendar-sub-view hidden bg-white p-4 rounded-lg shadow">
                     <div class="grid grid-cols-7 gap-px border border-gray-200">
                        <div class="text-center font-medium py-2 bg-gray-50">Sun</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Mon</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Tue</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Wed</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Thu</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Fri</div>
                        <div class="text-center font-medium py-2 bg-gray-50">Sat</div>
                    </div>
                    <div class="grid grid-cols-7 gap-px border border-t-0 border-gray-200" id="monthlyViewGridContent" style="min-height: 60vh;">
                        </div>
                </div>
            </div>


            <div id="bayConfigurationPage" class="page-content hidden">
                 <header class="mb-6 bg-white p-4 rounded-lg shadow">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-4 md:mb-0">Bay Configuration</h2>
                        <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md text-sm flex items-center open-add-edit-bay-modal" data-action="add">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                            New Bay
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label for="filterBranch" class="block text-sm font-medium text-gray-700">Branch</label>
                            <select id="filterBranch" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                <option>Branch 11</option><option>Branch 12</option>
                            </select>
                        </div>
                        <div>
                            <label for="filterWorkshop" class="block text-sm font-medium text-gray-700">Workshop</label>
                            <select id="filterWorkshop" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                <option>Main Workshop</option><option>Express Service</option>
                            </select>
                        </div>
                        <div>
                            <label for="filterBayArea" class="block text-sm font-medium text-gray-700">Bay Area</label>
                            <select id="filterBayArea" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                <option>All Areas</option><option>Service Area A</option><option>Service Area B</option>
                            </select>
                        </div>
                    </div>
                     <div class="flex flex-wrap items-center gap-2 border-t pt-4">
                        <button id="deleteSelectedBaysBtn" class="table-action-button bg-red-500 hover:bg-red-600 text-white">Delete Selected</button>
                        <button id="advanceSearchBaysBtn" class="table-action-button bg-gray-200 hover:bg-gray-300 text-gray-700">Advance Search</button>
                        <button id="exportBaysBtn" class="table-action-button bg-gray-200 hover:bg-gray-300 text-gray-700">Export</button>
                        <button id="refreshBaysBtn" class="table-action-button bg-gray-200 hover:bg-gray-300 text-gray-700">Refresh</button>
                    </div>
                </header>
                 <div class="bg-white p-0 sm:p-6 rounded-xl shadow-md overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><input type="checkbox" id="selectAllBaysCheckbox" class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"></th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bay Description</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bay Type</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Is Active?</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="bayConfigTableBody">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap"><input type="checkbox" class="bay-select-checkbox rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" value="A1"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">A1</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">A1</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">OutSide Branch</td>
                                <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Yes</span></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button class="text-indigo-600 hover:text-indigo-900 open-add-edit-bay-modal" data-action="edit" data-bay-id="A1" data-bay-name="A1" data-bay-type="OutSide Branch" data-is-active="true" data-from-hours="09:00" data-to-hours="17:00" data-remarks="Standard bay">Edit</button>
                                </td>
                            </tr>
                             <tr>
                                <td class="px-6 py-4 whitespace-nowrap"><input type="checkbox" class="bay-select-checkbox rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" value="Bay 01"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Bay 01</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Service bay 01</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Working</td>
                                <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Yes</span></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button class="text-indigo-600 hover:text-indigo-900 open-add-edit-bay-modal" data-action="edit" data-bay-id="Bay 01" data-bay-name="Service bay 01" data-bay-type="Working" data-is-active="true" data-from-hours="08:00" data-to-hours="18:00" data-remarks="">Edit</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="py-3 px-6 border-t border-gray-200 flex justify-between items-center text-sm text-gray-500">
                        <span>View 1-2 of 2</span>
                        <div>
                            <button class="hover:text-indigo-600 disabled:opacity-50" disabled>&laquo; Prev</button>
                            <span class="mx-2">Page 1 of 1</span>
                            <button class="hover:text-indigo-600 disabled:opacity-50" disabled>Next &raquo;</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="downtimeMaintenancePage" class="page-content hidden">
                <header class="mb-8 flex justify-between items-center"><h2 class="text-3xl font-semibold text-gray-800">Downtime & Maintenance Logs</h2><button class="bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-md text-sm flex items-center open-maintenance-log-modal-page"><svg class="sidebar-icon text-white mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>Log New Maintenance</button></header>
                <div class="bg-white p-6 rounded-xl shadow-md overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Bay ID</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Issue</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Start Date</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">End Date (Exp.)</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr><td class="px-6 py-4 text-sm">B-01</td><td class="px-6 py-4 text-sm">Lift Hydraulic Leak</td><td class="px-6 py-4 text-sm">2025-05-27</td><td class="px-6 py-4 text-sm">2025-05-29</td><td class="px-6 py-4 text-sm"><span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Ongoing</span></td><td class="px-6 py-4 text-sm"><button class="text-indigo-600 hover:text-indigo-800 open-maintenance-log-modal-page" data-bay-id="B-01">View/Edit</button></td></tr></tbody></table></div>
            </div>

            <div id="jobCardsPage" class="page-content hidden">
                <header class="mb-8 flex justify-between items-center"><h2 class="text-3xl font-semibold text-gray-800">Job Cards</h2><button class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md text-sm flex items-center open-job-details-modal-page" data-action="create"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>Create New Job Card</button></header>
                <div class="bg-white p-6 rounded-xl shadow-md overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Job ID</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Bay</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Service</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr><td class="px-6 py-4 text-sm">J4567</td><td class="px-6 py-4 text-sm">A-02</td><td class="px-6 py-4 text-sm">Vehicle REG123</td><td class="px-6 py-4 text-sm">Oil Change</td><td class="px-6 py-4 text-sm"><span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">In Progress</span></td><td class="px-6 py-4 text-sm"><button class="text-indigo-600 hover:text-indigo-800 open-job-details-modal-page" data-job-id="J4567" data-bay-id="A-02">View/Edit</button></td></tr></tbody></table></div>
            </div>
            
            <div id="technicianManagementPage" class="page-content hidden">
                <header class="mb-8 flex justify-between items-center"><h2 class="text-3xl font-semibold text-gray-800">Technician Management</h2><button class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md text-sm flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>Add Technician</button></header>
                <div class="bg-white p-6 rounded-xl shadow-md overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Specialization</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Current Job</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr><td class="px-6 py-4 text-sm">T001</td><td class="px-6 py-4 text-sm">Mike L.</td><td class="px-6 py-4 text-sm">Engine Specialist</td><td class="px-6 py-4 text-sm">J4567 (Bay A-02)</td><td class="px-6 py-4 text-sm space-x-2"><button class="text-indigo-600 hover:text-indigo-900">Edit</button><button class="text-green-600 hover:text-green-900">Assign Job</button></td></tr></tbody></table></div>
            </div>

            <div id="notificationsAlertsPage" class="page-content hidden">
                <header class="mb-8 flex justify-between items-center"><h2 class="text-3xl font-semibold text-gray-800">Notifications & Alerts</h2><button class="text-sm text-gray-600 hover:text-indigo-700">Mark all as read</button></header>
                <div class="bg-white p-6 rounded-xl shadow-md space-y-4"><div class="p-4 border border-yellow-300 bg-yellow-50 rounded-md"><p class="font-medium text-yellow-700">Low Stock Alert: Brake Pads Model XYZ (2 units left)</p><p class="text-xs text-yellow-600">2 hours ago</p></div><div class="p-4 border border-blue-300 bg-blue-50 rounded-md"><p class="font-medium text-blue-700">Scheduled Maintenance Due: Bay C-01 - Lift inspection tomorrow</p><p class="text-xs text-blue-600">1 day ago</p></div></div>
            </div>
            
            <div id="userRoleManagementPage" class="page-content hidden">
                <header class="mb-8 flex justify-between items-center"><h2 class="text-3xl font-semibold text-gray-800">User & Role Management</h2><button class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md text-sm flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>Add User</button></header>
                <div class="bg-white p-6 rounded-xl shadow-md overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Username</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Role</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr><td class="px-6 py-4 text-sm">alex.johnson</td><td class="px-6 py-4 text-sm">alex@example.com</td><td class="px-6 py-4 text-sm">Administrator</td><td class="px-6 py-4 text-sm space-x-2"><button class="text-indigo-600 hover:text-indigo-900">Edit</button><button class="text-red-600 hover:text-red-900">Delete</button></td></tr></tbody></table></div>
            </div>
        </div> </div>

    <div id="dayDetailBox" class="fixed"> 
        <h4 id="dayDetailBoxTitle" class="text-lg font-semibold text-gray-800 mb-3"></h4>
        <div id="dayDetailBoxContent" class="text-sm text-gray-700 mb-4 whitespace-pre-wrap max-h-60 overflow-y-auto"></div>
        <button id="dayDetailBoxClose" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 px-4 rounded-md text-sm">Close</button>
    </div>

    <div id="bookingModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 modal-overlay opacity-0 pointer-events-none">
        <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl w-full max-w-lg modal-content transform scale-95">
            <div class="flex justify-between items-center mb-6">
                <h3 id="bookingModalTitle" class="text-xl font-semibold text-gray-800">New Booking</h3>
                <button id="closeBookingModal" class="text-gray-500 hover:text-gray-700"><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            <form id="bookingForm" onsubmit="event.preventDefault(); console.log('Booking form submitted'); closeModal(bookingModal);">
                <input type="hidden" id="bookingId">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="bookingBay" class="block text-sm font-medium text-gray-700 mb-1">Bay</label>
                        <select id="bookingBay" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            <option value="A-01">Bay A-01</option><option value="A-02">Bay A-02</option><option value="A-03">Bay A-03</option>
                        </select>
                    </div>
                    <div>
                        <label for="bookingWorkOrder" class="block text-sm font-medium text-gray-700 mb-1">Work Order #</label>
                        <input type="text" id="bookingWorkOrder" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., J5001">
                    </div>
                </div>
                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="bookingDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="date" id="bookingDate" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                     <div>
                        <label for="bookingTechnician" class="block text-sm font-medium text-gray-700 mb-1">Technician</label>
                        <select id="bookingTechnician" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            <option value="T001">Mike L.</option><option value="T002">Sarah K.</option><option value="">Unassigned</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="bookingStartTime" class="block text-sm font-medium text-gray-700 mb-1">Start Time</label>
                        <input type="time" id="bookingStartTime" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="bookingEndTime" class="block text-sm font-medium text-gray-700 mb-1">End Time</label>
                        <input type="time" id="bookingEndTime" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>
                <div class="mb-4">
                    <label for="bookingCustomer" class="block text-sm font-medium text-gray-700 mb-1">Customer Name</label>
                    <input type="text" id="bookingCustomer" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Customer Name">
                </div>
                <div class="mb-4">
                    <label for="bookingVehicle" class="block text-sm font-medium text-gray-700 mb-1">Vehicle Details</label>
                    <input type="text" id="bookingVehicle" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Make, Model, REG">
                </div>
                <div class="mb-6">
                    <label for="bookingServiceType" class="block text-sm font-medium text-gray-700 mb-1">Service Type</label>
                    <input type="text" id="bookingServiceType" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., Oil Change, Tire Rotation">
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50" onclick="closeModal(bookingModal)">Cancel</button>
                    <button type="submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Save Booking</button>
                </div>
            </form>
        </div>
    </div>

    <div id="jobDetailsModal" class="fixed inset-0 z-40 flex items-center justify-center bg-black bg-opacity-50 modal-overlay opacity-0 pointer-events-none"><div class="bg-white p-6 md:p-8 rounded-lg shadow-xl w-full max-w-lg modal-content transform scale-95"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-semibold text-gray-800">Job Details - <span id="jobModalTitleId">J4567</span> (<span id="jobModalBayId">Bay A-02</span>)</h3><button id="closeJobDetailsModal" class="text-gray-500 hover:text-gray-700"><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div><form onsubmit="event.preventDefault(); console.log('Job form submitted'); closeModal(jobDetailsModal);"><div class="mb-4"><label for="jobDescription" class="block text-sm font-medium text-gray-700 mb-1">Job Description</label><textarea id="jobDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., Customer reports engine knocking sound on acceleration."></textarea></div><div class="mb-4"><label for="jobTechnician" class="block text-sm font-medium text-gray-700 mb-1">Assigned Technician</label><select id="jobTechnician" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"><option>Mike L.</option><option>Sarah K.</option><option>Unassigned</option></select></div><div class="mb-6"><label for="jobNotes" class="block text-sm font-medium text-gray-700 mb-1">Internal Notes/Diagnostics</label><textarea id="jobNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Initial findings, parts ordered, etc."></textarea></div><div class="mb-4 p-4 bg-indigo-50 border-l-4 border-indigo-400 rounded-md hidden" id="geminiJobSuggestionsArea"><h4 class="text-md font-semibold text-indigo-700 mb-2"> AI Suggestions</h4><div id="geminiJobOutput" class="text-sm text-gray-700 whitespace-pre-wrap"></div><div id="geminiJobLoading" class="text-sm text-indigo-700 hidden">Generating suggestions...</div></div><div class="flex flex-col sm:flex-row justify-between items-center space-y-3 sm:space-y-0 sm:space-x-3"><button type="button" id="getJobSuggestionsBtn" class="w-full sm:w-auto flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5zM12.5 10a.5.5 0 01-.5.5h-2a.5.5 0 010-1h2a.5.5 0 01.5.5zM10 12.5a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5zM7.5 10a.5.5 0 01-.5.5h-2a.5.5 0 010-1h2a.5.5 0 01.5.5z" clip-rule="evenodd" /><path d="M9.25 5.25a.75.75 0 00-1.5 0v.042A4.483 4.483 0 003.5 9.5c0 1.865 1.13 3.438 2.75 4.148V14.75a.75.75 0 001.5 0v-.947a4.546 4.546 0 001.75-.832V14.75a.75.75 0 001.5 0v-1.958c.42-.29.796-.633 1.125-1.017V14.75a.75.75 0 001.5 0v-2.084A4.483 4.483 0 0016.5 9.5a4.483 4.483 0 00-4.25-4.208V5.25zM5 9.5A3.001 3.001 0 018 6.5h4A3.001 3.001 0 0115 9.5c0 1.083-.574 2.03-1.438 2.562a.751.751 0 00-.312.938A3.001 3.001 0 0112 13.5H8a3.001 3.001 0 01-2.25-3.5.75.75 0 00-.312-.938A3.001 3.001 0 015 9.5z" /></svg> Suggest Job Details</button><div class="flex w-full sm:w-auto space-x-3"><button type="button" class="w-full sm:w-auto px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50" onclick="closeModal(jobDetailsModal)">Cancel</button><button type="submit" class="w-full sm:w-auto px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Save Job</button></div></div></form></div></div>
    <div id="maintenanceLogModal" class="fixed inset-0 z-40 flex items-center justify-center bg-black bg-opacity-50 modal-overlay opacity-0 pointer-events-none"><div class="bg-white p-6 md:p-8 rounded-lg shadow-xl w-full max-w-lg modal-content transform scale-95"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-semibold text-gray-800">Log Maintenance - <span id="maintenanceModalBayId">Bay B-01</span></h3><button id="closeMaintenanceLogModal" class="text-gray-500 hover:text-gray-700"><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div><form onsubmit="event.preventDefault(); console.log('Maintenance form submitted'); closeModal(maintenanceLogModal);"><div class="mb-4"><label for="maintenanceIssue" class="block text-sm font-medium text-gray-700 mb-1">Issue / Reason</label><input type="text" id="maintenanceIssue" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., Lift hydraulic leak, Annual inspection"></div><div class="mb-4"><label for="maintenanceDetails" class="block text-sm font-medium text-gray-700 mb-1">Details / Actions Taken</label><textarea id="maintenanceDetails" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Describe the issue and steps taken..."></textarea></div><div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6"><div><label for="maintenanceStartDate" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label><input type="date" id="maintenanceStartDate" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></div><div><label for="maintenanceEndDate" class="block text-sm font-medium text-gray-700 mb-1">Expected End Date</label><input type="date" id="maintenanceEndDate" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></div></div><div class="mb-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-md hidden" id="geminiMaintenanceSuggestionsArea"><h4 class="text-md font-semibold text-yellow-700 mb-2"> AI Maintenance Insights</h4><div id="geminiMaintenanceOutput" class="text-sm text-gray-700 whitespace-pre-wrap"></div><div id="geminiMaintenanceLoading" class="text-sm text-yellow-700 hidden">Generating insights...</div></div><div class="flex flex-col sm:flex-row justify-between items-center space-y-3 sm:space-y-0 sm:space-x-3"><button type="button" id="getMaintenanceInsightsBtn" class="w-full sm:w-auto flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-yellow-500 hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" /></svg> Get Maintenance Insights</button><div class="flex w-full sm:w-auto space-x-3"><button type="button" class="w-full sm:w-auto px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50" onclick="closeModal(maintenanceLogModal)">Cancel</button><button type="submit" class="w-full sm:w-auto px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Save Log</button></div></div></form></div></div>
    <div id="addEditBayModal" class="fixed inset-0 z-40 flex items-center justify-center bg-black bg-opacity-50 modal-overlay opacity-0 pointer-events-none"><div class="bg-white p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md modal-content transform scale-95"><div class="flex justify-between items-center mb-6"><h3 id="bayModalTitle" class="text-xl font-semibold text-gray-800">Add New Bay</h3><button id="closeAddEditBayModal" class="text-gray-500 hover:text-gray-700"><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div><form id="addEditBayForm" onsubmit="event.preventDefault(); console.log('Bay form submitted for action: ' + document.getElementById('bayAction').value); closeModal(addEditBayModal);"><input type="hidden" id="bayAction" value="add"><input type="hidden" id="editingBayId" value=""><div class="mb-4"><label for="bayIdInput" class="block text-sm font-medium text-gray-700 mb-1">Code <span class="text-red-500">*</span></label><input type="text" id="bayIdInput" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., A-04" required></div><div class="mb-4"><label for="bayNameInput" class="block text-sm font-medium text-gray-700 mb-1">Bay Description <span class="text-red-500">*</span></label><input type="text" id="bayNameInput" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., Main Service Bay 4" required></div><div class="mb-4"><label for="bayTypeSelect" class="block text-sm font-medium text-gray-700 mb-1">Bay Type <span class="text-red-500">*</span></label><select id="bayTypeSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" required><option value="">- Select -</option><option value="Working">Working</option><option value="OutSide Branch">OutSide Branch</option><option value="Standard Lift">Standard Lift</option><option value="Pit Style">Pit Style</option><option value="Paint Booth">Paint Booth</option><option value="Washing">Washing</option></select></div><div class="grid grid-cols-2 gap-4 mb-4"><div><label for="bayFromHours" class="block text-sm font-medium text-gray-700 mb-1">From Hours</label><input type="time" id="bayFromHours" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></div><div><label for="bayToHours" class="block text-sm font-medium text-gray-700 mb-1">To Hours</label><input type="time" id="bayToHours" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></div></div><div class="mb-4"><label for="bayRemarks" class="block text-sm font-medium text-gray-700 mb-1">Remarks</label><textarea id="bayRemarks" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea></div><div class="mb-6"><label class="flex items-center"><input type="checkbox" id="bayIsActive" class="rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500 mr-2" checked><span class="text-sm text-gray-700">Is Active?</span></label></div><div class="flex justify-end space-x-3"><button type="button" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50" onclick="closeModal(addEditBayModal)">Exit</button><button type="submit" id="saveBayButton" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700">Save</button></div></form></div></div>

    <div id="advancedSearchModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 modal-overlay opacity-0 pointer-events-none">
        <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl w-full max-w-lg modal-content transform scale-95">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-gray-800">Advanced Bay Search</h3>
                <button id="closeAdvancedSearchModal" class="text-gray-500 hover:text-gray-700"><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            <form id="advancedSearchForm" onsubmit="event.preventDefault(); console.log('Advanced search submitted'); closeModal(advancedSearchModal);">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="searchBayCode" class="block text-sm font-medium text-gray-700 mb-1">Bay Code</label>
                        <input type="text" id="searchBayCode" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., A-01">
                    </div>
                    <div>
                        <label for="searchBayDescription" class="block text-sm font-medium text-gray-700 mb-1">Bay Description</label>
                        <input type="text" id="searchBayDescription" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Contains...">
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                     <div>
                        <label for="searchBayType" class="block text-sm font-medium text-gray-700 mb-1">Bay Type</label>
                        <select id="searchBayType" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            <option value="">Any</option>
                            <option value="Working">Working</option>
                            <option value="OutSide Branch">OutSide Branch</option>
                            <option value="Standard Lift">Standard Lift</option>
                            <option value="Pit Style">Pit Style</option>
                            <option value="Paint Booth">Paint Booth</option>
                            <option value="Washing">Washing</option>
                        </select>
                    </div>
                    <div>
                        <label for="searchIsActive" class="block text-sm font-medium text-gray-700 mb-1">Is Active?</label>
                        <select id="searchIsActive" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            <option value="">Any</option>
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50" onclick="document.getElementById('advancedSearchForm').reset();">Clear</button>
                    <button type="button" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50" onclick="closeModal(advancedSearchModal)">Cancel</button>
                    <button type="submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700">Search</button>
                </div>
            </form>
        </div>
    </div>

    <div id="exportBaysModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 modal-overlay opacity-0 pointer-events-none">
        <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl w-full max-w-md modal-content transform scale-95">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-gray-800">Export Bay Data</h3>
                <button id="closeExportBaysModal" class="text-gray-500 hover:text-gray-700"><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            <form id="exportBaysForm" onsubmit="event.preventDefault(); console.log('Exporting bays with format: ' + document.querySelector('input[name=\'exportFormat\']:checked').value ); closeModal(exportBaysModal);">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Export Format</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="exportFormat" value="csv" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300" checked>
                            <span class="ml-2 text-sm text-gray-700">CSV (Comma Separated Values)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="exportFormat" value="pdf" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                            <span class="ml-2 text-sm text-gray-700">PDF Document</span>
                        </label>
                         <label class="flex items-center">
                            <input type="radio" name="exportFormat" value="excel" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                            <span class="ml-2 text-sm text-gray-700">Excel (XLSX)</span>
                        </label>
                    </div>
                </div>
                <div class="mb-6">
                    <p class="text-sm font-medium text-gray-700 mb-1">Columns to include: (All selected by default - mock)</p>
                    <p class="text-xs text-gray-500">Code, Bay Description, Bay Type, Is Active, From Hours, To Hours, Remarks.</p>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50" onclick="closeModal(exportBaysModal)">Cancel</button>
                    <button type="submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Export Data</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        // --- Page Navigation ---
        const sidebarLinks = document.querySelectorAll('.sidebar-link');
        const pageContents = document.querySelectorAll('.page-content');
        const defaultPage = 'dashboardPage';

        function showPage(pageId) {
            pageContents.forEach(page => page.classList.add('hidden'));
            const targetPage = document.getElementById(pageId);
            if (targetPage) targetPage.classList.remove('hidden');
            else document.getElementById(defaultPage).classList.remove('hidden');
        }
        sidebarLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                const pageId = link.dataset.page;
                sidebarLinks.forEach(sl => {
                    sl.classList.remove('active', 'bg-gray-900', 'text-white');
                    sl.classList.add('text-gray-300', 'hover:bg-gray-700', 'hover:text-white');
                });
                link.classList.add('active', 'bg-gray-900', 'text-white');
                link.classList.remove('text-gray-300', 'hover:bg-gray-700', 'hover:text-white');
                showPage(pageId);
                window.location.hash = link.getAttribute('href');
            });
        });
        function loadPageFromHash() {
            const hash = window.location.hash.substring(1);
            const targetLink = document.querySelector(`.sidebar-link[href="#${hash}"]`);
            if (targetLink) targetLink.click();
            else {
                const defaultLink = document.querySelector(`.sidebar-link[data-page="${defaultPage}"]`);
                if (defaultLink) {
                    defaultLink.classList.add('active', 'bg-gray-900', 'text-white');
                    defaultLink.classList.remove('text-gray-300', 'hover:bg-gray-700', 'hover:text-white');
                }
                showPage(defaultPage);
            }
        }

        // --- Modal Handling ---
        const jobDetailsModal = document.getElementById('jobDetailsModal');
        const closeJobDetailsModalBtn = document.getElementById('closeJobDetailsModal');
        const jobModalTitleId = document.getElementById('jobModalTitleId');
        const jobModalBayId = document.getElementById('jobModalBayId');
        const maintenanceLogModal = document.getElementById('maintenanceLogModal');
        const closeMaintenanceLogModalBtn = document.getElementById('closeMaintenanceLogModal');
        const maintenanceModalBayId = document.getElementById('maintenanceModalBayId');
        const addEditBayModal = document.getElementById('addEditBayModal');
        const closeAddEditBayModalBtn = document.getElementById('closeAddEditBayModal');
        const bayModalTitle = document.getElementById('bayModalTitle');
        const addEditBayForm = document.getElementById('addEditBayForm');
        const bayActionInput = document.getElementById('bayAction');
        const editingBayIdInput = document.getElementById('editingBayId');
        const bayIdInput = document.getElementById('bayIdInput');
        const bayNameInput = document.getElementById('bayNameInput');
        const bayTypeSelect = document.getElementById('bayTypeSelect'); 
        const bayFromHoursInput = document.getElementById('bayFromHours');
        const bayToHoursInput = document.getElementById('bayToHours');
        const bayRemarksInput = document.getElementById('bayRemarks');
        const bayIsActiveCheckbox = document.getElementById('bayIsActive');
        const saveBayButton = document.getElementById('saveBayButton');
        const bookingModal = document.getElementById('bookingModal');
        const closeBookingModalBtn = document.getElementById('closeBookingModal');
        const bookingModalTitle = document.getElementById('bookingModalTitle');
        const bookingForm = document.getElementById('bookingForm');
        const advancedSearchModal = document.getElementById('advancedSearchModal');
        const closeAdvancedSearchModalBtn = document.getElementById('closeAdvancedSearchModal');
        const exportBaysModal = document.getElementById('exportBaysModal');
        const closeExportBaysModalBtn = document.getElementById('closeExportBaysModal');


        function openModal(modal) { if(modal) { modal.classList.remove('opacity-0', 'pointer-events-none'); const mc = modal.querySelector('.modal-content'); if (mc) mc.classList.remove('scale-95'); } }
        function closeModal(modal) { if(modal) { modal.classList.add('opacity-0', 'pointer-events-none'); const mc = modal.querySelector('.modal-content'); if (mc) mc.classList.add('scale-95'); } }
        
        document.body.addEventListener('click', function(event) {
            if (event.target.closest('.open-job-details-modal') || event.target.closest('.open-job-details-modal-page')) {
                const btn = event.target.closest('.open-job-details-modal') || event.target.closest('.open-job-details-modal-page');
                const action = btn.dataset.action;
                if (jobModalTitleId) jobModalTitleId.textContent = action === 'create' ? 'New Job' : (btn.dataset.jobId || 'N/A');
                if (jobModalBayId) jobModalBayId.textContent = action === 'create' ? 'N/A' : (btn.dataset.bayId || 'N/A');
                if (document.getElementById('jobDescription')) document.getElementById('jobDescription').value = action !== 'create' && btn.dataset.jobId === 'J4567' ? 'Oil Change and basic checkup.' : (action !== 'create' && btn.dataset.jobId === 'J4568' ? 'Customer reports tire pressure light is on.' : '');
                if(action === 'create' && document.getElementById('jobDescription')) { document.getElementById('jobDescription').value = ''; if(document.getElementById('jobNotes')) document.getElementById('jobNotes').value = ''; }
                if (document.getElementById('geminiJobSuggestionsArea')) document.getElementById('geminiJobSuggestionsArea').classList.add('hidden'); 
                if (document.getElementById('geminiJobOutput')) document.getElementById('geminiJobOutput').textContent = '';
                openModal(jobDetailsModal);
            }
            if (event.target.closest('.open-maintenance-log-modal') || event.target.closest('.open-maintenance-log-modal-page')) {
                const btn = event.target.closest('.open-maintenance-log-modal') || event.target.closest('.open-maintenance-log-modal-page');
                const bayId = btn.dataset.bayId || 'Select Bay'; 
                if (maintenanceModalBayId) maintenanceModalBayId.textContent = bayId;
                if (document.getElementById('geminiMaintenanceSuggestionsArea')) document.getElementById('geminiMaintenanceSuggestionsArea').classList.add('hidden'); 
                if (document.getElementById('geminiMaintenanceOutput')) document.getElementById('geminiMaintenanceOutput').textContent = '';
                if (document.getElementById('maintenanceIssue')) document.getElementById('maintenanceIssue').value = bayId === 'B-01' ? 'Lift Repair' : '';
                openModal(maintenanceLogModal);
            }
            if (event.target.closest('.open-add-edit-bay-modal')) {
                const btn = event.target.closest('.open-add-edit-bay-modal');
                const action = btn.dataset.action; 
                if (addEditBayForm) addEditBayForm.reset(); 
                if (action === 'edit') {
                    if (bayModalTitle) bayModalTitle.textContent = 'Edit Bay'; 
                    if (saveBayButton) saveBayButton.textContent = 'Save'; 
                    if (bayActionInput) bayActionInput.value = 'edit';
                    if (editingBayIdInput) editingBayIdInput.value = btn.dataset.bayId; 
                    if (bayIdInput) { bayIdInput.value = btn.dataset.bayId; bayIdInput.readOnly = true; }
                    if (bayNameInput) bayNameInput.value = btn.dataset.bayName; 
                    if (bayTypeSelect) bayTypeSelect.value = btn.dataset.bayType;
                    if (bayIsActiveCheckbox) bayIsActiveCheckbox.checked = btn.dataset.isActive === 'true';
                    if (bayFromHoursInput) bayFromHoursInput.value = btn.dataset.fromHours || '';
                    if (bayToHoursInput) bayToHoursInput.value = btn.dataset.toHours || '';
                    if (bayRemarksInput) bayRemarksInput.value = btn.dataset.remarks || '';
                } else { 
                    if (bayModalTitle) bayModalTitle.textContent = 'Add New Bay'; 
                    if (saveBayButton) saveBayButton.textContent = 'Save'; 
                    if (bayActionInput) bayActionInput.value = 'add';
                    if (editingBayIdInput) editingBayIdInput.value = ''; 
                    if (bayIdInput) bayIdInput.readOnly = false;
                    if (bayIsActiveCheckbox) bayIsActiveCheckbox.checked = true; 
                }
                openModal(addEditBayModal);
            }
        });

        if(closeJobDetailsModalBtn) closeJobDetailsModalBtn.addEventListener('click', () => closeModal(jobDetailsModal));
        if(closeMaintenanceLogModalBtn) closeMaintenanceLogModalBtn.addEventListener('click', () => closeModal(maintenanceLogModal));
        if(closeAddEditBayModalBtn) closeAddEditBayModalBtn.addEventListener('click', () => closeModal(addEditBayModal));
        if(closeBookingModalBtn) closeBookingModalBtn.addEventListener('click', () => closeModal(bookingModal));
        if(closeAdvancedSearchModalBtn) closeAdvancedSearchModalBtn.addEventListener('click', () => closeModal(advancedSearchModal));
        if(closeExportBaysModalBtn) closeExportBaysModalBtn.addEventListener('click', () => closeModal(exportBaysModal));
        
        [jobDetailsModal, maintenanceLogModal, addEditBayModal, bookingModal, advancedSearchModal, exportBaysModal].forEach(modal => {
            if (modal) { modal.addEventListener('click', (event) => { if (event.target === modal) closeModal(modal); }); }
        });

        // --- Gemini API Integration ---
        const getJobSuggestionsBtn = document.getElementById('getJobSuggestionsBtn');
        const geminiJobSuggestionsArea = document.getElementById('geminiJobSuggestionsArea');
        const geminiJobOutput = document.getElementById('geminiJobOutput');
        const geminiJobLoading = document.getElementById('geminiJobLoading');
        const jobDescriptionInput = document.getElementById('jobDescription');
        if (getJobSuggestionsBtn) { getJobSuggestionsBtn.addEventListener('click', async () => { const currentJobDescription = jobDescriptionInput.value.trim(); if (!currentJobDescription) { geminiJobOutput.textContent = "Please enter a job description first."; geminiJobSuggestionsArea.classList.remove('hidden'); return; } geminiJobSuggestionsArea.classList.remove('hidden'); geminiJobLoading.classList.remove('hidden'); geminiJobOutput.textContent = ''; const prompt = `Based on the following vehicle job description, suggest potential diagnostic steps, commonly required parts, and a more detailed service description. Job Description: "${currentJobDescription}"`; try { console.log("Calling Gemini API for job suggestions with prompt:", prompt); let chatHistory = []; chatHistory.push({ role: "user", parts: [{ text: prompt }] }); const payload = { contents: chatHistory }; const apiKey = "";  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`; const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (!response.ok) { const errorData = await response.json(); console.error("Gemini API Error:", errorData); throw new Error(`API request failed with status ${response.status}: ${errorData?.error?.message || 'Unknown error'}`); } const result = await response.json(); let generatedText = "Could not retrieve suggestions at this time."; if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) { generatedText = result.candidates[0].content.parts[0].text; } else { console.warn("Unexpected response structure from Gemini API:", result); } geminiJobOutput.textContent = generatedText; } catch (error) { console.error("Error fetching job suggestions:", error); geminiJobOutput.textContent = `Error: ${error.message}. Please check the console for more details.`; } finally { geminiJobLoading.classList.add('hidden'); } }); }
        const getMaintenanceInsightsBtn = document.getElementById('getMaintenanceInsightsBtn');
        const geminiMaintenanceSuggestionsArea = document.getElementById('geminiMaintenanceSuggestionsArea'); const geminiMaintenanceOutput = document.getElementById('geminiMaintenanceOutput'); const geminiMaintenanceLoading = document.getElementById('geminiMaintenanceLoading'); const maintenanceIssueInput = document.getElementById('maintenanceIssue'); const maintenanceDetailsInput = document.getElementById('maintenanceDetails');
        if (getMaintenanceInsightsBtn) { getMaintenanceInsightsBtn.addEventListener('click', async () => { const issue = maintenanceIssueInput.value.trim(); const details = maintenanceDetailsInput.value.trim(); if (!issue && !details) { geminiMaintenanceOutput.textContent = "Please enter an issue or some details first."; geminiMaintenanceSuggestionsArea.classList.remove('hidden'); return; } geminiMaintenanceSuggestionsArea.classList.remove('hidden'); geminiMaintenanceLoading.classList.remove('hidden'); geminiMaintenanceOutput.textContent = ''; const prompt = `Provide maintenance insights for a workshop bay equipment. Issue: "${issue}". Details: "${details}". Suggest common troubleshooting steps and related preventative maintenance.`; try { console.log("Calling Gemini API for maintenance insights with prompt:", prompt); let chatHistory = []; chatHistory.push({ role: "user", parts: [{ text: prompt }] }); const payload = { contents: chatHistory }; const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`; const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (!response.ok) { const errorData = await response.json(); console.error("Gemini API Error:", errorData); throw new Error(`API request failed with status ${response.status}: ${errorData?.error?.message || 'Unknown error'}`); } const result = await response.json(); let generatedText = "Could not retrieve insights at this time."; if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) { generatedText = result.candidates[0].content.parts[0].text; } else { console.warn("Unexpected response structure from Gemini API:", result); } geminiMaintenanceOutput.textContent = generatedText; } catch (error) { console.error("Error fetching maintenance insights:", error); geminiMaintenanceOutput.textContent = `Error: ${error.message}. Please check the console for more details.`; } finally { geminiMaintenanceLoading.classList.add('hidden'); } }); }

        // --- Dashboard Mini-Calendar Functionality ---
        const currentMonthYearEl = document.getElementById('currentMonthYear');
        const calendarDaysContainerEl = document.getElementById('calendarDaysContainer');
        const prevMonthBtn = document.getElementById('prevMonthBtn');
        const nextMonthBtn = document.getElementById('nextMonthBtn');
        const todayBtn = document.getElementById('todayBtn');
        const dayDetailBox = document.getElementById('dayDetailBox');
        const dayDetailBoxTitle = document.getElementById('dayDetailBoxTitle');
        const dayDetailBoxContent = document.getElementById('dayDetailBoxContent');
        const dayDetailBoxClose = document.getElementById('dayDetailBoxClose');
        let miniCalendarDate = new Date(2025, 4, 28); 
        const miniCalendarBookings = { "2025-05-06": "Job #J4568 - Bay A-01 (2 PM)\nType: Tire Rotation", "2025-05-11": "Maintenance - Bay B-01 (All Day)\nReason: Lift Inspection", "2025-05-28": "Job #J4569 - Bay C-01 (1 PM)\nType: Oil Change\n\nJob #J4570 - Bay A-02 (3 PM)\nType: Brake Check", "2025-06-02": "Job #J5001 - Bay A-01 (9 AM)\nType: Annual Service" };
        function renderMiniCalendar() { if (!calendarDaysContainerEl || !currentMonthYearEl) { return; } calendarDaysContainerEl.innerHTML = ''; const year = miniCalendarDate.getFullYear(); const month = miniCalendarDate.getMonth(); currentMonthYearEl.textContent = `${miniCalendarDate.toLocaleString('default', { month: 'long' })} ${year}`; const firstDayOfMonth = new Date(year, month, 1); const lastDayOfMonth = new Date(year, month + 1, 0); const daysInMonth = lastDayOfMonth.getDate(); const startingDayOfWeek = firstDayOfMonth.getDay(); for (let i = 0; i < startingDayOfWeek; i++) { const emptyCell = document.createElement('span'); emptyCell.classList.add('calendar-day', 'other-month'); calendarDaysContainerEl.appendChild(emptyCell); } for (let day = 1; day <= daysInMonth; day++) { const dayCell = document.createElement('div'); dayCell.classList.add('calendar-day'); dayCell.setAttribute('role', 'button'); dayCell.setAttribute('tabindex', '0'); const dayNumberSpan = document.createElement('span'); dayNumberSpan.classList.add('day-number'); dayNumberSpan.textContent = day; dayCell.appendChild(dayNumberSpan); const today = new Date(); const calendarCellDate = new Date(year, month, day); if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) { dayCell.classList.add('current-day'); } const dateStr = calendarCellDate.toISOString().split('T')[0]; if (miniCalendarBookings[dateStr]) { dayCell.classList.add('has-booking'); if (miniCalendarBookings[dateStr].includes('\n')) { dayCell.classList.add('has-multiple-bookings'); } const tooltip = document.createElement('span'); tooltip.classList.add('calendar-tooltip'); tooltip.textContent = miniCalendarBookings[dateStr]; dayCell.appendChild(tooltip); } dayCell.dataset.date = dateStr; dayCell.addEventListener('click', handleMiniCalendarDayClick); dayCell.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { handleMiniCalendarDayClick(e); } }); calendarDaysContainerEl.appendChild(dayCell); } const totalCells = startingDayOfWeek + daysInMonth; const remainingCells = (totalCells % 7 === 0) ? 0 : 7 - (totalCells % 7); for (let i = 0; i < remainingCells; i++) { const emptyCell = document.createElement('span'); emptyCell.classList.add('calendar-day', 'other-month'); calendarDaysContainerEl.appendChild(emptyCell); } }
        function handleMiniCalendarDayClick(e) { const targetDay = e.currentTarget; if(!targetDay.classList.contains('other-month')) { const dateStr = targetDay.dataset.date; console.log(`Mini Calendar Clicked on date: ${dateStr}`); dayDetailBoxTitle.textContent = `Schedule for ${new Date(dateStr + 'T00:00:00').toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`; dayDetailBoxContent.textContent = miniCalendarBookings[dateStr] || 'No bookings for this day.'; dayDetailBox.classList.add('visible'); } }
        if(dayDetailBoxClose) { dayDetailBoxClose.addEventListener('click', () => { dayDetailBox.classList.remove('visible'); }); }
        if (prevMonthBtn) { prevMonthBtn.addEventListener('click', () => { miniCalendarDate.setMonth(miniCalendarDate.getMonth() - 1); renderMiniCalendar(); }); }
        if (nextMonthBtn) { nextMonthBtn.addEventListener('click', () => { miniCalendarDate.setMonth(miniCalendarDate.getMonth() + 1); renderMiniCalendar(); }); }
        if (todayBtn) { todayBtn.addEventListener('click', () => { miniCalendarDate = new Date(); renderMiniCalendar(); }); }

        // --- Bay Scheduling Page Specific JS ---
        const baySchedulingPage = document.getElementById('baySchedulingPage');
        
        let schedTodayBtn, schedPrevBtn, schedNextBtn, schedCurrentDateDisplay, viewButtons, calendarSubViews, newBookingBtnSchedPage, dailyViewGridHeader, dailyViewGridContent, weeklyViewGridContent, monthlyViewGridContent;
        let currentSchedulerDate = new Date(2025, 4, 28); 
        let currentSchedulerView = 'day';
        const mockBays = [ {id: 'A-01', name: 'Bay A-01'}, {id: 'A-02', name: 'Bay A-02'}, {id: 'A-03', name: 'Bay A-03'}, {id: 'B-01', name: 'Bay B-01'} ];
        const mockBookings = [
            { id: 'B001', bayId: 'A-01', date: '2025-05-28', startTime: '09:00', endTime: '11:00', title: 'J5001 - Oil Change', customer: 'John Doe', technician: 'Mike L.' },
            { id: 'B002', bayId: 'A-02', date: '2025-05-28', startTime: '10:00', endTime: '12:30', title: 'J5002 - Tire Align', customer: 'Jane Smith', technician: 'Sarah K.' },
            { id: 'B003', bayId: 'A-01', date: '2025-05-28', startTime: '14:00', endTime: '15:30', title: 'J5003 - Brake Check', customer: 'Bob Johnson', technician: 'Mike L.' },
            { id: 'B004', bayId: 'A-03', date: '2025-05-29', startTime: '11:00', endTime: '13:00', title: 'J5004 - Full Service', customer: 'Alice Brown', technician: 'Sarah K.' }
        ];

        function initializeSchedulingPageElements() {
            if (!baySchedulingPage) return false;
            schedTodayBtn = baySchedulingPage.querySelector('#schedTodayBtn');
            schedPrevBtn = baySchedulingPage.querySelector('#schedPrevBtn');
            schedNextBtn = baySchedulingPage.querySelector('#schedNextBtn');
            schedCurrentDateDisplay = baySchedulingPage.querySelector('#schedCurrentDateDisplay');
            viewButtons = baySchedulingPage.querySelectorAll('.calendar-view-button');
            calendarSubViews = baySchedulingPage.querySelectorAll('.calendar-sub-view');
            newBookingBtnSchedPage = baySchedulingPage.querySelector('#newBookingBtnSchedPage');
            dailyViewGridHeader = baySchedulingPage.querySelector('#dailyViewGridHeader');
            dailyViewGridContent = baySchedulingPage.querySelector('#dailyViewGridContent');
            weeklyViewGridContent = baySchedulingPage.querySelector('#weeklyViewGridContent');
            monthlyViewGridContent = baySchedulingPage.querySelector('#monthlyViewGridContent');
            
            if (!schedCurrentDateDisplay || !viewButtons || viewButtons.length === 0 || !calendarSubViews || calendarSubViews.length === 0) {
                console.error("Essential scheduling page control elements not found during initialization.");
                return false; 
            }
            return true;
        }

        function updateSchedulerDateDisplay() {
            if (!schedCurrentDateDisplay) return;
            if (currentSchedulerView === 'day') { schedCurrentDateDisplay.textContent = currentSchedulerDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }); }
            else if (currentSchedulerView === 'week') { const startOfWeek = new Date(currentSchedulerDate); startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay() + (startOfWeek.getDay() === 0 ? -6 : 1)); const endOfWeek = new Date(startOfWeek); endOfWeek.setDate(endOfWeek.getDate() + 6); schedCurrentDateDisplay.textContent = `${startOfWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${endOfWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`; }
            else { schedCurrentDateDisplay.textContent = currentSchedulerDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long' }); }
        }
        
        function renderDayView() {
            if(!dailyViewGridHeader || !dailyViewGridContent) { console.error("Daily view grid elements not found for renderDayView."); return; }
            dailyViewGridHeader.innerHTML = '<div class="timeslot sticky left-0 bg-white z-10 border-r">Time</div>';
            let bayHeaderHtml = ''; mockBays.forEach(bay => bayHeaderHtml += `<div class="bay-header">${bay.name}</div>`);
            dailyViewGridHeader.innerHTML += bayHeaderHtml; dailyViewGridHeader.className = `grid grid-cols-[80px_repeat(${mockBays.length},1fr)]`;
            dailyViewGridContent.innerHTML = ''; dailyViewGridContent.className = `grid grid-cols-[80px_repeat(${mockBays.length},1fr)] relative`;
            const timeSlots = []; for (let hour = 8; hour < 17; hour++) { timeSlots.push(`${String(hour).padStart(2,'0')}:00`); timeSlots.push(`${String(hour).padStart(2,'0')}:30`); }
            timeSlots.forEach(time => { dailyViewGridContent.innerHTML += `<div class="timeslot sticky left-0 bg-white z-10 border-r">${time.endsWith(':00') ? new Date('1970-01-01T'+time+':00').toLocaleTimeString('en-US', {hour:'numeric', hour12:true}) : ''}</div>`; mockBays.forEach(bay => { dailyViewGridContent.innerHTML += `<div class="day-view-slot" data-bay-id="${bay.id}" data-time="${time}" data-date="${currentSchedulerDate.toISOString().split('T')[0]}"></div>`; }); });
            const todayBookings = mockBookings.filter(b => b.date === currentSchedulerDate.toISOString().split('T')[0]);
            todayBookings.forEach(booking => {
                const startHour = parseInt(booking.startTime.split(':')[0]); const startMinute = parseInt(booking.startTime.split(':')[1]); const endHour = parseInt(booking.endTime.split(':')[0]); const endMinute = parseInt(booking.endTime.split(':')[1]);
                const durationMinutes = (endHour * 60 + endMinute) - (startHour * 60 + startMinute);
                const bookingHeight = (durationMinutes / 30) * (40 + 1); 
                const topOffsetMinutes = (startHour - 8) * 60 + startMinute; 
                const topPosition = (topOffsetMinutes / 30) * (40 + 1) ; 
                const bayIndex = mockBays.findIndex(b => b.id === booking.bayId); if (bayIndex === -1) return;
                const bookingBlock = document.createElement('div'); bookingBlock.className = 'booking-block open-booking-details';
                bookingBlock.style.height = `${bookingHeight -2}px`; bookingBlock.style.top = `${topPosition}px`;
                const bayColumnWidth = (dailyViewGridContent.offsetWidth - 80) / mockBays.length; 
                bookingBlock.style.left = `${80 + bayIndex * bayColumnWidth + 1}px`; 
                bookingBlock.style.width = `${bayColumnWidth - 2}px`; 
                bookingBlock.textContent = `${booking.title.substring(0,15)}...`; bookingBlock.title = `${booking.title}\nCustomer: ${booking.customer}\nTech: ${booking.technician}`; bookingBlock.dataset.bookingId = booking.id;
                dailyViewGridContent.appendChild(bookingBlock);
            });
        }

        function renderWeekView() {
            if(!weeklyViewGridContent) { console.error("Weekly view grid element not found for renderWeekView."); return; }
            weeklyViewGridContent.innerHTML = ''; const today = new Date(currentSchedulerDate); const currentDayOfWeek = today.getDay(); 
            const startDate = new Date(today); startDate.setDate(today.getDate() - currentDayOfWeek + (currentDayOfWeek === 0 ? -6 : 1)); 
            for(let i=0; i<7; i++) { const day = new Date(startDate); day.setDate(startDate.getDate() + i); const dateStr = day.toISOString().split('T')[0]; let dayHtml = `<div class="p-2 border-r border-b border-gray-200 min-h-[10rem] overflow-y-auto" data-date="${dateStr}"><div class="text-sm font-semibold text-center">${day.toLocaleDateString('en-US', {day:'numeric'})}</div>`; mockBookings.filter(b => b.date === dateStr).forEach(booking => { dayHtml += `<div class="text-xs bg-blue-200 text-blue-800 p-1 rounded mt-1 open-booking-details" data-booking-id="${booking.id}" title="${booking.title} (${booking.startTime}-${booking.endTime})">${booking.title.substring(0,10)}...</div>`; }); dayHtml += `</div>`; weeklyViewGridContent.innerHTML += dayHtml; }
        }

        function renderMonthView() {
            if(!monthlyViewGridContent) { console.error("Monthly view grid element not found for renderMonthView."); return; }
            monthlyViewGridContent.innerHTML = ''; const year = currentSchedulerDate.getFullYear(); const month = currentSchedulerDate.getMonth();
            const firstDay = new Date(year, month, 1); const lastDay = new Date(year, month + 1, 0); const daysInMonth = lastDay.getDate(); const startDayOfWeek = firstDay.getDay();
            for (let i = 0; i < startDayOfWeek; i++) { monthlyViewGridContent.innerHTML += `<div class="month-view-day other-month-sched"></div>`; }
            for (let day = 1; day <= daysInMonth; day++) { const cellDate = new Date(year, month, day); const dateStr = cellDate.toISOString().split('T')[0]; let dayHtml = `<div class="month-view-day" data-date="${dateStr}"><div class="text-sm font-semibold text-right">${day}</div>`; mockBookings.filter(b => b.date === dateStr).forEach(booking => { dayHtml += `<span class="month-view-booking-indicator open-booking-details" data-booking-id="${booking.id}">${booking.title.substring(0,10)}</span>`; }); dayHtml += `</div>`; monthlyViewGridContent.innerHTML += dayHtml; }
            const totalCells = startDayOfWeek + daysInMonth; const remainingCells = (totalCells % 7 === 0) ? 0 : 7 - (totalCells % 7);
            for (let i = 0; i < remainingCells; i++) { monthlyViewGridContent.innerHTML += `<div class="month-view-day other-month-sched"></div>`; }
        }

        function switchSchedulerView(view) {
            if (!baySchedulingPage) { console.error("Global 'baySchedulingPage' element not found. Cannot switch view."); return; }
            if (!initializeSchedulingPageElements()) { console.error("Failed to initialize Bay Scheduling Page child elements. Cannot switch view."); return; }

            currentSchedulerView = view;

            if (calendarSubViews && calendarSubViews.length > 0) {
                calendarSubViews.forEach(v => { 
                    if(v && typeof v.classList !== 'undefined') v.classList.add('hidden'); 
                    // else if (v) console.warn("A calendarSubView item is not a valid DOM element or lacks classList:", v); 
                });
            } else { console.warn("calendarSubViews NodeList is empty or not initialized in switchSchedulerView. No views to hide."); }

            const activeViewPanel = baySchedulingPage.querySelector(`#${view}CalendarView`);
            if (activeViewPanel && typeof activeViewPanel.classList !== 'undefined') {
                activeViewPanel.classList.remove('hidden');
            } else { console.error(`Calendar view panel with ID #${view}CalendarView not found or invalid within baySchedulingPage.`); return; }

            if (viewButtons && viewButtons.length > 0) {
                viewButtons.forEach(btn => { if(btn && typeof btn.classList !== 'undefined') btn.classList.remove('active'); /* else if (btn) console.warn("A viewButton item is not a valid DOM element or lacks classList:", btn); */ });
            } else { console.warn("viewButtons NodeList is empty or not initialized in switchSchedulerView. No buttons to deactivate."); }
            
            const activeButton = baySchedulingPage.querySelector(`.calendar-view-button[data-view="${view}"]`);
            if (activeButton && typeof activeButton.classList !== 'undefined') {
                activeButton.classList.add('active');
            } else { console.warn(`Calendar view button with data-view="${view}" not found or invalid within baySchedulingPage.`); }
            
            updateSchedulerDateDisplay();
            if (view === 'day') renderDayView();
            else if (view === 'week') renderWeekView();
            else if (view === 'month') renderMonthView();
        }

        function setupSchedulingPageListeners() {
            if (!initializeSchedulingPageElements()) {
                console.error("Cannot setup scheduling page listeners: elements not found.");
                return;
            }

            if (viewButtons) {
                viewButtons.forEach(button => {
                    button.addEventListener('click', () => switchSchedulerView(button.dataset.view));
                });
            }
            if(schedTodayBtn) schedTodayBtn.addEventListener('click', () => { currentSchedulerDate = new Date(2025, 4, 28); updateSchedulerDateDisplay(); if (currentSchedulerView === 'day') renderDayView(); else if (currentSchedulerView === 'week') renderWeekView(); else renderMonthView(); });
            if(schedPrevBtn) schedPrevBtn.addEventListener('click', () => { if (currentSchedulerView === 'day') currentSchedulerDate.setDate(currentSchedulerDate.getDate() - 1); else if (currentSchedulerView === 'week') currentSchedulerDate.setDate(currentSchedulerDate.getDate() - 7); else currentSchedulerDate.setMonth(currentSchedulerDate.getMonth() - 1); updateSchedulerDateDisplay(); if (currentSchedulerView === 'day') renderDayView(); else if (currentSchedulerView === 'week') renderWeekView(); else renderMonthView(); });
            if(schedNextBtn) schedNextBtn.addEventListener('click', () => { if (currentSchedulerView === 'day') currentSchedulerDate.setDate(currentSchedulerDate.getDate() + 1); else if (currentSchedulerView === 'week') currentSchedulerDate.setDate(currentSchedulerDate.getDate() + 7); else currentSchedulerDate.setMonth(currentSchedulerDate.getMonth() + 1); updateSchedulerDateDisplay(); if (currentSchedulerView === 'day') renderDayView(); else if (currentSchedulerView === 'week') renderWeekView(); else renderMonthView(); });
            if (newBookingBtnSchedPage) { newBookingBtnSchedPage.addEventListener('click', () => { if(bookingForm) bookingForm.reset(); if(bookingModalTitle) bookingModalTitle.textContent = 'New Booking'; if(document.getElementById('bookingId')) document.getElementById('bookingId').value = ''; if(document.getElementById('bookingDate')) document.getElementById('bookingDate').value = currentSchedulerDate.toISOString().split('T')[0]; openModal(bookingModal); }); }
            
            [dailyViewGridContent, weeklyViewGridContent, monthlyViewGridContent].forEach(grid => {
                if(grid) {
                    grid.addEventListener('click', (event) => {
                        const target = event.target;
                        if (target.closest('.open-booking-details')) { 
                            const bookingId = target.closest('.open-booking-details').dataset.bookingId; const booking = mockBookings.find(b => b.id === bookingId); if (booking) { if(bookingForm) bookingForm.reset(); if(bookingModalTitle) bookingModalTitle.textContent = 'Booking Details'; if(document.getElementById('bookingId')) document.getElementById('bookingId').value = booking.id; if(document.getElementById('bookingBay')) document.getElementById('bookingBay').value = booking.bayId; if(document.getElementById('bookingWorkOrder')) document.getElementById('bookingWorkOrder').value = booking.title.split(' - ')[0]; if(document.getElementById('bookingDate')) document.getElementById('bookingDate').value = booking.date; if(document.getElementById('bookingStartTime')) document.getElementById('bookingStartTime').value = booking.startTime; if(document.getElementById('bookingEndTime')) document.getElementById('bookingEndTime').value = booking.endTime; if(document.getElementById('bookingCustomer')) document.getElementById('bookingCustomer').value = booking.customer; if(document.getElementById('bookingServiceType')) document.getElementById('bookingServiceType').value = booking.title.split(' - ')[1] || ''; if(document.getElementById('bookingTechnician')) document.getElementById('bookingTechnician').value = booking.technician; openModal(bookingModal); }
                        } else if (target.classList.contains('day-view-slot') || (target.classList.contains('month-view-day') && !target.classList.contains('other-month-sched'))) {
                             if(bookingForm) bookingForm.reset(); if(bookingModalTitle) bookingModalTitle.textContent = 'New Booking'; if(document.getElementById('bookingId')) document.getElementById('bookingId').value = ''; if(document.getElementById('bookingDate')) document.getElementById('bookingDate').value = target.dataset.date || currentSchedulerDate.toISOString().split('T')[0]; if(target.dataset.bayId && document.getElementById('bookingBay')) document.getElementById('bookingBay').value = target.dataset.bayId; if(target.dataset.time && document.getElementById('bookingStartTime')) document.getElementById('bookingStartTime').value = target.dataset.time; openModal(bookingModal);
                        }
                    });
                }
            });
        }
        
        const baySchedulingLink = document.querySelector('.sidebar-link[data-page="baySchedulingPage"]');
        if (baySchedulingLink) {
            baySchedulingLink.addEventListener('click', () => {
                if (baySchedulingPage && !baySchedulingPage.dataset.initialized) {
                     setTimeout(() => { 
                        if(initializeSchedulingPageElements()) { 
                            setupSchedulingPageListeners(); 
                            switchSchedulerView('day'); 
                            baySchedulingPage.dataset.initialized = "true";
                        } else {
                            console.error("Could not initialize scheduling page elements on link click.");
                        }
                    }, 0);
                }
            });
        }
        
        // Initial page setup
        document.addEventListener('DOMContentLoaded', () => {
            loadPageFromHash(); 
            if (document.getElementById('calendarDaysContainer') && document.getElementById('currentMonthYear')) {
                 renderMiniCalendar();
            }
            const addNewBayBtnDashboard = document.getElementById('addNewBayBtnDashboard');
            if (addNewBayBtnDashboard) { addNewBayBtnDashboard.addEventListener('click', () => { if(addEditBayForm) addEditBayForm.reset(); if(bayModalTitle) bayModalTitle.textContent = 'Add New Bay'; if(saveBayButton) saveBayButton.textContent = 'Add Bay'; if(bayActionInput) bayActionInput.value = 'add'; if(editingBayIdInput) editingBayIdInput.value = ''; if(bayIdInput) bayIdInput.readOnly = false; openModal(addEditBayModal); }); }
            const addBayCardBtnDashboard = document.getElementById('addBayCardBtnDashboard');
            if (addBayCardBtnDashboard) { addBayCardBtnDashboard.addEventListener('click', () => { if(addEditBayForm) addEditBayForm.reset(); if(bayModalTitle) bayModalTitle.textContent = 'Add New Bay'; if(saveBayButton) saveBayButton.textContent = 'Add Bay'; if(bayActionInput) bayActionInput.value = 'add'; if(editingBayIdInput) editingBayIdInput.value = ''; if(bayIdInput) bayIdInput.readOnly = false; openModal(addEditBayModal); }); }
        
            if (window.location.hash === '#bayScheduling' || (!window.location.hash && defaultPage === 'baySchedulingPage')) {
                 if (baySchedulingPage && !baySchedulingPage.dataset.initialized) {
                    setTimeout(() => {
                        if(initializeSchedulingPageElements()){
                            setupSchedulingPageListeners();
                            switchSchedulerView('day');
                            baySchedulingPage.dataset.initialized = "true";
                        } else {
                             console.error("Could not initialize scheduling page elements on initial page load for scheduler.");
                        }
                    }, 0);
                }
            }

            // Bay Configuration Page specific button listeners
            const advanceSearchBaysBtn = document.getElementById('advanceSearchBaysBtn');
            if(advanceSearchBaysBtn) {
                advanceSearchBaysBtn.addEventListener('click', () => {
                    if(document.getElementById('advancedSearchForm')) document.getElementById('advancedSearchForm').reset();
                    openModal(advancedSearchModal);
                });
            }
            const exportBaysBtn = document.getElementById('exportBaysBtn');
            if(exportBaysBtn) {
                exportBaysBtn.addEventListener('click', () => {
                    if(document.getElementById('exportBaysForm')) document.getElementById('exportBaysForm').reset();
                    openModal(exportBaysModal);
                });
            }
            const deleteSelectedBaysBtn = document.getElementById('deleteSelectedBaysBtn');
            if(deleteSelectedBaysBtn) {
                deleteSelectedBaysBtn.addEventListener('click', () => {
                    const selectedBays = [];
                    document.querySelectorAll('.bay-select-checkbox:checked').forEach(checkbox => {
                        selectedBays.push(checkbox.value);
                    });
                    if (selectedBays.length > 0) {
                        console.log('Attempting to delete selected bays:', selectedBays);
                        alert(`Mock delete for bays: ${selectedBays.join(', ')}. (Replace alert with custom modal)`);

                    } else {
                         alert('Please select at least one bay to delete. (Replace alert with custom modal)');
                    }
                });
            }
            const selectAllBaysCheckbox = document.getElementById('selectAllBaysCheckbox');
            if(selectAllBaysCheckbox) {
                selectAllBaysCheckbox.addEventListener('change', (event) => {
                    document.querySelectorAll('.bay-select-checkbox').forEach(checkbox => {
                        checkbox.checked = event.target.checked;
                    });
                });
            }
             const refreshBaysBtn = document.getElementById('refreshBaysBtn');
            if(refreshBaysBtn){
                refreshBaysBtn.addEventListener('click', () => {
                    console.log("Refreshing bay list...");
                    alert("Mock Bay List Refreshed. (Replace alert with actual refresh logic)");
                });
            }

            // Initialize Charts on Dashboard
            const bayUtilizationCtx = document.getElementById('bayUtilizationChart');
            if (bayUtilizationCtx) {
                new Chart(bayUtilizationCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Active Bays', 'Maintenance', 'Available'],
                        datasets: [{
                            label: 'Bay Status',
                            data: [8, 2, 2], // Mock data: 8 Active, 2 Maintenance, 2 Available (Total 12)
                            backgroundColor: [
                                'rgba(75, 192, 192, 0.7)', // Greenish
                                'rgba(255, 205, 86, 0.7)', // Yellowish
                                'rgba(54, 162, 235, 0.7)'  // Bluish
                            ],
                            borderColor: [
                                'rgba(75, 192, 192, 1)',
                                'rgba(255, 205, 86, 1)',
                                'rgba(54, 162, 235, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            }
                        }
                    }
                });
            }

            const weeklyBookingsCtx = document.getElementById('weeklyBookingsChart');
            if (weeklyBookingsCtx) {
                new Chart(weeklyBookingsCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'], // Last 7 days
                        datasets: [{
                            label: 'Bookings This Week',
                            data: [12, 19, 3, 5, 2, 3, 7], // Mock data
                            fill: false,
                            borderColor: 'rgb(75, 192, 192)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        });
        console.log("Bay Management Multi-Page UI Loaded with Full Scheduler Mock");
    </script>
</body>
</html>
