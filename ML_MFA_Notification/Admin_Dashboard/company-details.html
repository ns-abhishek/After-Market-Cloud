<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Details</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            color: #374151;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 1rem;
        }

        .stats-card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: transform 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-5px);
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stats-label {
            font-size: 1rem;
            color: #6b7280;
        }

        .company-header {
            background-color: #1e40af;
            color: white;
            padding: 1.5rem;
            border-radius: 8px 8px 0 0;
        }

        .info-section {
            background-color: white;
            border-radius: 0 0 8px 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .grid-item {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: transform 0.2s;
        }

        .grid-item:hover {
            transform: translateY(-5px);
        }

        .date-card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .date-label {
            font-size: 1rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .date-value {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .validity-card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }

        .validity-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1e40af;
        }

        .validity-dates {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .validity-date {
            text-align: center;
            flex: 1;
        }

        .validity-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .validity-value {
            font-size: 1.125rem;
            font-weight: 500;
        }

        /* Circular progress */
        .circle-progress-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }

        .circle-progress-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(#e5e7eb 0% 100%);
        }

        .circle-progress {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(#10b981 0% var(--progress), transparent var(--progress) 100%);
        }

        .circle-progress-inner {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .circle-progress-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #10b981;
        }

        .circle-progress-label {
            font-size: 0.75rem;
            color: #6b7280;
        }

        /* Branch count breakdown */
        .branch-breakdown {
            display: flex;
            /* justify-content: center; */
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .branch-status {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Company Header -->
        <div class="company-header">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold" id="company-name">Company Details</h1>
                <div class="space-x-4">
                    <a href="dashboard.html" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Back to Dashboard
                    </a>
                </div>
            </div>
        </div>

        <!-- Company Info Section -->
        <div class="info-section">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                <div>
                    <h2 class="text-xl font-semibold" id="company-location">Head Office Location: <span>New York</span></h2>
                    <p class="text-gray-600" id="company-status">Status: <span class="text-green-600 font-medium">Active</span></p>
                </div>
                <div class="mt-4 md:mt-0">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800" id="company-id">
                        ID: COMP-001
                    </span>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6 mb-8">
            <!-- Branch Count -->
            <div class="stats-card">
                <div class="stats-number text-blue-600" id="branch-count">0</div>
                <div class="stats-label">Total Branches</div>
                <div class="branch-breakdown">
                    <div class="branch-status">
                        <div class="status-dot bg-green-500"></div>
                        <span id="active-branches">0 Active</span>
                    </div>
                    <div class="branch-status">
                        <div class="status-dot bg-red-500"></div>
                        <span id="inactive-branches">0 Inactive</span>
                    </div>
                </div>
            </div>

            <!-- User Count -->
            <div class="stats-card">
                <div class="stats-number text-green-600" id="user-count">0</div>
                <div class="stats-label">Total Users</div>
                <div class="branch-breakdown">
                    <div class="branch-status">
                        <div class="status-dot bg-green-500"></div>
                        <span id="active-users">0 Active</span>
                    </div>
                    <div class="branch-status">
                        <div class="status-dot bg-red-500"></div>
                        <span id="inactive-users">0 Inactive</span>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="grid grid-cols-1 gap-2">
                        <div class="flex justify-between items-center text-sm">
                            <span>Read Access:</span>
                            <span id="read-access-users" class="font-medium">0</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span>Read and Write Access:</span>
                            <span id="write-access-users" class="font-medium">0</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span>Admin Access:</span>
                            <span id="admin-access-users" class="font-medium">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Software Validity and Renewal Section -->
        <div class="validity-card mb-8">
            <h2 class="validity-title">Software Validity & Renewal</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Software Validity -->
                <div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="validity-date">
                            <div class="validity-label">Start Date</div>
                            <div class="validity-value" id="start-date">01/01/2023</div>
                        </div>
                        <div class="validity-date">
                            <div class="validity-label">End Date</div>
                            <div class="validity-value" id="end-date">31/12/2023</div>
                        </div>
                    </div>

                    <!-- Circular Progress -->
                    <div class="circle-progress-container mt-4">
                        <div class="circle-progress-bg"></div>
                        <div class="circle-progress" id="validity-progress" style="--progress: 75%"></div>
                        <div class="circle-progress-inner">
                            <div class="circle-progress-value" id="progress-percentage">75%</div>
                            <div class="circle-progress-label">Complete</div>
                        </div>
                    </div>
                </div>

                <!-- Renewal Date -->
                <div class="flex flex-col justify-center items-center">
                    <div class="text-lg font-semibold mb-3">Renewal Date</div>
                    <div class="text-2xl font-bold text-amber-600" id="renewal-date">31/12/2023</div>
                    <div class="mt-3 text-sm font-medium" id="days-remaining">30 days remaining</div>
                    <div class="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800 max-w-xs text-center">
                        Renewal notice will be sent 60 days before expiration
                    </div>
                </div>
            </div>
        </div>

        <!-- Branch List Section -->
        <h2 class="text-2xl font-semibold mb-4">Branches</h2>
        <div class="bg-white rounded-lg shadow overflow-hidden mb-8">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Users</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="branch-list">
                    <!-- Branch items will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const companyId = urlParams.get('id');

        // Get DOM elements
        const companyNameEl = document.getElementById('company-name');
        const companyLocationEl = document.getElementById('company-location');
        const companyStatusEl = document.getElementById('company-status');
        const companyIdEl = document.getElementById('company-id');
        const branchCountEl = document.getElementById('branch-count');
        const activeBranchesEl = document.getElementById('active-branches');
        const inactiveBranchesEl = document.getElementById('inactive-branches');
        const userCountEl = document.getElementById('user-count');
        const activeUsersEl = document.getElementById('active-users');
        const inactiveUsersEl = document.getElementById('inactive-users');
        const readAccessUsersEl = document.getElementById('read-access-users');
        const writeAccessUsersEl = document.getElementById('write-access-users');
        const adminAccessUsersEl = document.getElementById('admin-access-users');
        const startDateEl = document.getElementById('start-date');
        const endDateEl = document.getElementById('end-date');
        const validityProgressEl = document.getElementById('validity-progress');
        const progressPercentageEl = document.getElementById('progress-percentage');
        const renewalDateEl = document.getElementById('renewal-date');
        const daysRemainingEl = document.getElementById('days-remaining');
        const branchListEl = document.getElementById('branch-list');

        // Load data from localStorage
        const companyData = JSON.parse(localStorage.getItem('companyData')) || [];
        const branchData = JSON.parse(localStorage.getItem('branchData')) || [];

        // Find the company by ID
        const company = companyData.find(c => c.id.toString() === companyId);

        if (!company) {
            // Handle case when company is not found
            alert('Company not found!');
            window.location.href = 'dashboard.html';
        } else {
            // Update company details
            companyNameEl.textContent = company.name;

            // Generate a head office location based on the region
            let headOfficeLocation;
            switch(company.region) {
                case 'north': headOfficeLocation = 'New York'; break;
                case 'south': headOfficeLocation = 'Miami'; break;
                case 'east': headOfficeLocation = 'Boston'; break;
                case 'west': headOfficeLocation = 'San Francisco'; break;
                case 'central': headOfficeLocation = 'Chicago'; break;
                default: headOfficeLocation = 'Corporate HQ';
            }

            companyLocationEl.innerHTML = `Head Office Location: <span>${headOfficeLocation}</span>`;
            companyStatusEl.innerHTML = `Status: <span class="${company.active ? 'text-green-600' : 'text-red-600'} font-medium">${company.active ? 'Active' : 'Inactive'}</span>`;
            companyIdEl.textContent = `ID: COMP-${company.id.toString().padStart(3, '0')}`;

            // Filter branches for this company
            const companyBranches = branchData.filter(b => b.companyId === company.id);
            const activeBranches = companyBranches.filter(b => b.active);
            const inactiveBranches = companyBranches.filter(b => !b.active);

            // Update branch counts
            branchCountEl.textContent = companyBranches.length;
            activeBranchesEl.textContent = `${activeBranches.length} Active`;
            inactiveBranchesEl.textContent = `${inactiveBranches.length} Inactive`;

            // Generate random user counts (in a real app, this would come from your database)
            const userCount = Math.floor(Math.random() * 100) + 20;
            const activeUsers = Math.floor(userCount * 0.8); // 80% active
            const inactiveUsers = userCount - activeUsers;

            // Calculate access type distribution
            const readAccessUsers = Math.floor(userCount * 0.5); // 50% read access
            const writeAccessUsers = Math.floor(userCount * 0.3); // 30% read/write access
            const adminAccessUsers = userCount - readAccessUsers - writeAccessUsers; // remaining are admins

            // Update user count elements
            userCountEl.textContent = userCount;
            activeUsersEl.textContent = `${activeUsers} Active`;
            inactiveUsersEl.textContent = `${inactiveUsers} Inactive`;
            readAccessUsersEl.textContent = readAccessUsers;
            writeAccessUsersEl.textContent = writeAccessUsers;
            adminAccessUsersEl.textContent = adminAccessUsers;

            // Generate random dates for software validity (in a real app, this would come from your database)
            const today = new Date();
            const startDate = new Date(today.getFullYear(), 0, 1); // January 1st of current year
            const endDate = new Date(today.getFullYear(), 11, 31); // December 31st of current year

            startDateEl.textContent = startDate.toLocaleDateString();
            endDateEl.textContent = endDate.toLocaleDateString();

            // Calculate validity progress
            const totalDays = (endDate - startDate) / (1000 * 60 * 60 * 24);
            const elapsedDays = (today - startDate) / (1000 * 60 * 60 * 24);
            const progressPercentage = Math.min(100, Math.max(0, Math.round((elapsedDays / totalDays) * 100)));

            // Update circular progress
            validityProgressEl.style.setProperty('--progress', `${progressPercentage}%`);
            progressPercentageEl.textContent = `${progressPercentage}%`;

            // Set renewal date (1 day after end date)
            const renewalDate = new Date(endDate);
            renewalDate.setDate(renewalDate.getDate() + 1);
            renewalDateEl.textContent = renewalDate.toLocaleDateString();

            // Calculate days remaining until renewal
            const daysRemaining = Math.ceil((renewalDate - today) / (1000 * 60 * 60 * 24));
            daysRemainingEl.textContent = `${daysRemaining} days remaining`;

            // Change color based on days remaining
            if (daysRemaining <= 30) {
                daysRemainingEl.classList.add('text-red-600');
            } else if (daysRemaining <= 60) {
                daysRemainingEl.classList.add('text-amber-600');
            } else {
                daysRemainingEl.classList.add('text-green-600');
            }

            // Display branches
            if (companyBranches.length === 0) {
                branchListEl.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-6 py-4 whitespace-nowrap text-center text-gray-500">
                            No branches found for this company
                        </td>
                    </tr>
                `;
            } else {
                companyBranches.forEach(branch => {
                    // Generate random user count for each branch
                    const branchUserCount = Math.floor(Math.random() * 20) + 1;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <a href="branch-details.html?id=${branch.id}&companyId=${company.id}" class="text-sm font-medium text-blue-600 hover:text-blue-800">${branch.name}</a>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-500">${branch.name.includes('HO') ? 'Head Office' : 'Branch'}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${branchUserCount}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${branch.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${branch.active ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                    `;
                    branchListEl.appendChild(row);
                });
            }
        }
    </script>
</body>
</html>
