<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Parts Network Commerce</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
            margin: 0;
            overflow-x: hidden;
        }
        .container {
            width: 100%;
            max-width: 100%;
            padding-left: 0;
            padding-right: 0;
            margin: 0 auto;
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f9fafb;
        }
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af;
            border-radius: 10px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #6b7280;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
        }
        .modal-content {
            margin: 5% auto;
            padding: 16px;
            border-radius: 8px;
            width: 95%;
            max-width: 900px;
        }
        .dark .modal-content {
            background-color: #1f2937;
            color: #d1d5db;
            border: 1px solid #374151;
        }
        .light .modal-content {
            background-color: #ffffff;
            color: #111827;
            border: 1px solid #e5e7eb;
        }
        .layout-btn-active, .filter-pos-btn-active {
            background-color: #374151 !important;
            color: white !important;
            border-color: #374151 !important;
        }
        .dark .layout-btn-active, .dark .filter-pos-btn-active {
            background-color: #d1d5db !important;
            color: #111827 !important;
            border-color: #d1d5db !important;
        }
        .product-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .dark .product-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.25);
        }
        .quick-view-btn-container {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .product-card:hover .quick-view-btn-container {
            opacity: 1;
        }
        .truncate-3-lines {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .site-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            width: 100%;
        }
        .site-content {
            flex-grow: 1;
            width: 100%;
        }
        #imagePreview, #qrCodePreview, #videoPreview {
            max-width: 100%;
            max-height: 200px;
            height: 200px;
            margin-top: 10px;
            border-radius: 4px;
            object-fit: contain;
        }
        .preview-container {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pagination-item.active a {
            background-color: #374151 !important;
            color: white !important;
            border-color: #374151 !important;
        }
        .dark .pagination-item.active a {
            background-color: #d1d5db !important;
            color: #111827 !important;
            border-color: #d1d5db !important;
        }
        .pagination-item.disabled a {
            color: #9ca3af !important;
            cursor: not-allowed;
        }
        .dark .pagination-item.disabled a {
            color: #4b5563 !important;
        }
        .filter-section {
            margin-bottom: 1.5rem;
        }
        .filter-title {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        #filterSidebar.filters-panel-horizontal {
            width: 100%;
            padding: 1rem;
            align-self: stretch;
        }
        #filterSidebar.filters-panel-bottom {
            width: 100%;
            padding: 1rem;
            order: 2;
            align-self: stretch;
        }
        #filterSidebar.filters-panel-left, #filterSidebar.filters-panel-right {
            width: 260px;
            padding: 1rem;
            overflow-y: auto;
            box-sizing: border-box;
            align-self: stretch;
        }
        #mainContentContainer.filters-left, #mainContentContainer.filters-right {
            display: flex;
            flex-direction: row;
            align-items: stretch;
            gap: 1rem;
            width: 100%;
        }
        #mainContentContainer.filters-left #filterSidebar, #mainContentContainer.filters-right #filterSidebar {
            position: static;
            height: auto;
        }
        #mainContentContainer.filters-left #productListingArea, #mainContentContainer.filters-right #productListingArea {
            flex: 1;
            margin: 0;
            width: auto;
            align-self: stretch;
        }
        #mainContentContainer.filters-right #filterSidebar {
            order: 2;
        }
        #mainContentContainer.filters-top, #mainContentContainer.filters-bottom {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 1rem;
        }
        #mainContentContainer.filters-top #productListingArea, #mainContentContainer.filters-bottom #productListingArea {
            align-self: stretch;
        }
        #filterForm.filters-form-horizontal {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: start;
        }
        #filterForm.filters-form-horizontal .filter-section {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            margin-bottom: 0;
            min-height: auto;
        }
        #filterForm.filters-form-horizontal .filter-section > * {
            flex-grow: 0;
        }
        #filterForm.filters-form-horizontal .filter-section select,
        #filterForm.filters-form-horizontal .filter-section input[type="text"],
        #filterForm.filters-form-horizontal .filter-section input[type="number"] {
            width: 100%;
        }
        #filterForm.filters-form-horizontal .filter-buttons-container {
            grid-column: 1 / -1;
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        #filterForm.filters-form-horizontal .filter-buttons-container button {
            flex: 1;
        }
        #productDisplayAreaWrapper {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 8px;
        }
        .nav-category-link.active {
            color: #111827;
            font-weight: 600;
            border-bottom: 2px solid #111827;
        }
        .dark .nav-category-link.active {
            color: #f3f4f6;
            border-bottom-color: #f3f4f6;
        }
        input[type="checkbox"], input[type="radio"] {
            color: #4b5563;
            appearance: none;
            width: 1em;
            height: 1em;
            border: 1px solid #6b7280;
            border-radius: 0.25rem;
            display: inline-block;
            position: relative;
            cursor: pointer;
        }
        input[type="radio"] {
            border-radius: 50%;
        }
        input[type="checkbox"]:checked, input[type="radio"]:checked {
            background-color: #4b5563;
            border-color: #4b5563;
        }
        input[type="checkbox"]:checked::before {
            content: '✓';
            font-size: 0.8em;
            color: white;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        input[type="radio"]:checked::before {
            content: '';
            display: block;
            width: 0.5em;
            height: 0.5em;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        input:focus, select:focus, textarea:focus {
            --tw-ring-color: #6b7280 !important;
            box-shadow: 0 0 0 2px var(--tw-ring-color);
        }
        select {
            color: inherit;
            appearance: none;
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
        .dark select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        }
        .light select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        }
        .ui-slider {
            background: #e5e7eb;
            border: none;
            height: 8px;
            border-radius: 4px;
        }
        .dark .ui-slider {
            background: #374151;
        }
        .ui-slider .ui-slider-range {
            background: #4b5563;
        }
        .ui-slider .ui-slider-handle {
            width: 16px;
            height: 16px;
            background: #374151;
            border: 2px solid #ffffff;
            border-radius: 50%;
            top: -4px;
            cursor: pointer;
        }
        .dark .ui-slider .ui-slider-handle {
            background: #d1d5db;
            border-color: #1f2937;
        }
        .sortable-item {
            padding: 8px;
            margin: 4px 0;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            cursor: move;
        }
        .dark .sortable-item {
            background: #374151;
            border-color: #4b5563;
        }
        .sortable-item.ui-sortable-helper {
            opacity: 0.8;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .customize-options-container {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .customize-options-column {
            flex: 1;
            min-width: 300px;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #e5e7eb;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }
        .dark .comparison-table th, .dark .comparison-table td {
            border-color: #374151;
        }
        .comparison-table th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        .dark .comparison-table th {
            background-color: #1f2937;
        }
        .comparison-table .highlight-diff {
            background-color: #fef3c7;
        }
        .dark .comparison-table .highlight-diff {
            background-color: #4b5563;
        }
        @media (max-width: 768px) {
            #mainContentContainer.filters-left, #mainContentContainer.filters-right {
                flex-direction: column;
                align-items: stretch;
            }
            #mainContentContainer.filters-left #filterSidebar,
            #mainContentContainer.filters-right #filterSidebar {
                width: 100%;
                align-self: stretch;
            }
            #mainContentContainer.filters-left #productListingArea,
            #mainContentContainer.filters-right #productListingArea {
                width: 100%;
            }
            .comparison-table {
                display: block;
                overflow-x: auto;
            }
        }
        @media (max-width: 640px) {
            .modal-content {
                margin: 2% auto;
                padding: 12px;
                width: 98%;
            }
            #qrCodeScanner, #cameraFeed, #videoFeed {
                width: 100% !important;
                height: 200px !important;
            }
            #imagePreview, #qrCodePreview, #videoPreview {
                max-height: 150px;
                height: 150px;
            }
            .preview-container {
                height: 150px;
            }
            #filterForm.filters-form-horizontal {
                grid-template-columns: 1fr;
            }
            #filterForm.filters-form-horizontal .filter-buttons-container {
                flex-direction: column;
            }
            #filterForm.filters-form-horizontal .filter-buttons-container button {
                width: 100%;
            }
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-light': '#FFFFFF',
                        'secondary-light': '#F9FAFB',
                        'text-light': '#111827',
                        'border-light': '#E5E7EB',
                        'primary-dark': '#030712',
                        'secondary-dark': '#1F2937',
                        'text-dark': '#F3F4F6',
                        'border-dark': '#374151',
                    }
                }
            }
        }
    </script>
</head>
<body class="light bg-primary-light text-text-light">
    <div class="site-container">
        <header class="bg-secondary-light dark:bg-secondary-dark shadow-md sticky top-0 z-50 border-b border-border-light dark:border-border-dark w-full">
            <div class="container mx-auto px-4 py-3"style="max-width: 100%;">
                <div class="flex flex-wrap items-center justify-between">
                    <a href="#" class="text-2xl font-bold text-text-light dark:text-text-dark">Quest <span class="text-text-light dark:text-text-dark">Network Commerce</span> Search</a>
                    <div class="w-full md:w-1/2 lg:w-2/5 order-3 md:order-2 mt-3 md:mt-0">
                        <div class="relative flex items-center border border-border-light dark:border-border-dark rounded-lg overflow-hidden shadow-sm">
                            <input type="text" id="productSearchInput" placeholder="Search by Part #, Name, Category..." class="w-full px-4 py-2.5 text-sm bg-primary-light dark:bg-gray-700 text-text-light dark:text-text-dark focus:outline-none focus:ring-2">
                            <button id="customizeSearchBtn" title="Customize Search" class="p-2.5 hover:bg-gray-100 dark:hover:bg-gray-600 border-l border-border-light dark:border-border-dark">
                                <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 8a4 4 0 100 8 4 4 0 000-8zm0 6a2 2 0 110-4 2 2 0 010 4zm8-2a8 8 0 11-16 0 8 8 0 0116 0zm-2 0a6 6 0 10-12 0 6 6 0 0012 0z"></path></svg>
                            </button>
                            <button id="voiceSearchBtn" title="Voice Search" class="p-2.5 hover:bg-gray-100 dark:hover:bg-gray-600">
                                <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 2.78 2.96 4.96 5.91 4.96s5.42-2.18 5.91-4.96c.09-.6-.39-1.14-1-1.14z"></path></svg>
                            </button>
                            <button id="barcodeSearchBtn" title="Barcode/QR Search" class="p-2.5 hover:bg-gray-100 dark:hover:bg-gray-600 border-l border-border-light dark:border-border-dark">
                                <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M3 6h2v12H3zm4 0h1v12H7zm3 0h1v12h-1zm3 0h1v12h-1zm3 0h1v12h-1zm3 0h2v12h-2z"></path></svg>
                            </button>
                            <button id="imageSearchBtn" title="Image Search" class="p-2.5 hover:bg-gray-100 dark:hover:bg-gray-600 border-l border-border-light dark:border-border-dark">
                                <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"></path></svg>
                            </button>
                            <button id="videoSearchBtn" title="Video Record" class="p-2.5 hover:bg-gray-100 dark:hover:bg-gray-600 border-l border-border-light dark:border-border-dark">
                                <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M18 4l-4 4h-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2v-2h2l4 4V4z"></path></svg>
                            </button>
                        </div>
                        <div id="suggestions" class="absolute z-10 w-full md:w-1/2 lg:w-2/5 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-b-lg shadow-lg mt-1 hidden"></div>
                    </div>
                    <div class="flex items-center space-x-3 order-2 md:order-3">
                        <button id="themeToggleBtn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600" title="Toggle Dark/Light Mode">
                            <svg id="themeIconMoon" class="w-5 h-5 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                            <svg id="themeIconSun" class="w-5 h-5 text-gray-700 dark:text-gray-300 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-12.66l-.707.707M4.04 19.96l-.707.707M21 12h-1M4 12H3m15.364 4.636l-.707-.707M5.364 6.364l-.707-.707M12 6a6 6 0 100 12 6 6 0 000-12z"></path></svg>
                        </button>
                        <div class="relative group">
                            <button class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600" title="My Account">
                                <svg class="w-6 h-6 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                            </button>
                            <div class="absolute right-0 mt-2 w-48 bg-primary-light dark:bg-secondary-dark rounded-md shadow-lg py-1 hidden group-hover:block z-20 border border-border-light dark:border-border-dark">
                                <a href="#" class="block px-4 py-2 text-sm text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-700">Profile</a>
                                <a href="#" class="block px-4 py-2 text-sm text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-700">Orders</a>
                                <a href="#" class="block px-4 py-2 text-sm text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-700">Wishlist</a>
                                <a href="#" class="block px-4 py-2 text-sm text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-700">Logout</a>
                            </div>
                        </div>
                        <a href="#" class="relative p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600" title="Shopping Cart">
                            <svg class="w-6 h-6 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63-.63-.184-1.707.707-1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                            <span id="cartItemCount" class="absolute top-0 right-0 block h-4 w-4 text-xs text-center rounded-full bg-red-500 text-white">3</span>
                        </a>
                    </div>
                </div>
                <nav id="categoryNavigation" class="mt-3 border-t border-border-light dark:border-border-dark pt-2">
                    <ul class="flex flex-wrap space-x-4 text-sm font-medium">
                        <li><a href="#" class="nav-category-link text-text-light dark:text-text-dark hover:text-gray-700 dark:hover:text-gray-300" data-category="">All Categories</a></li>
                        <li><a href="#" class="nav-category-link text-text-light dark:text-text-dark hover:text-gray-700 dark:hover:text-gray-300" data-category="Bearings">Bearings</a></li>
                        <li><a href="#" class="nav-category-link text-text-light dark:text-text-dark hover:text-gray-700 dark:hover:text-gray-300" data-category="Gears">Gears & Drives</a></li>
                        <li><a href="#" class="nav-category-link text-text-light dark:text-text-dark hover:text-gray-700 dark:hover:text-gray-300" data-category="Motors">Motors</a></li>
                        <li><a href="#" class="nav-category-link text-text-light dark:text-text-dark hover:text-gray-700 dark:hover:text-gray-300" data-category="Fasteners">Fasteners</a></li>
                        <li><a href="#" class="nav-category-link text-text-light dark:text-text-dark hover:text-gray-700 dark:hover:text-gray-300" data-category="Pneumatics">Pneumatics</a></li>
                        <li><a href="#" class="nav-category-link text-text-light dark:text-text-dark hover:text-gray-700 dark:hover:text-gray-300" data-category="Belts">Belts</a></li>
                        <li><a href="#" class="nav-category-link text-text-light dark:text-text-dark hover:text-gray-700 dark:hover:text-gray-300" data-category="Valves">Valves</a></li>
                        <li><a href="#" class="nav-category-link text-text-light dark:text-text-dark hover:text-gray-700 dark:hover:text-gray-300" data-category="Sensors">Sensors</a></li>
                    </ul>
                </nav>
            </div>
        </header>
        <main class="site-content container mx-auto px-4 py-6" style="max-width: 100% !important;">
            <div class="mb-4 p-3 bg-secondary-light dark:bg-secondary-dark rounded-lg shadow border border-border-light dark:border-border-dark flex flex-wrap items-center justify-end gap-2 text-sm">
                <span class="mr-2 text-text-light dark:text-text-dark">Filter Position:</span>
                <button id="filterPosTop" class="filter-pos-btn py-1 px-3 rounded-md border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700">Top</button>
                <button id="filterPosLeft" class="filter-pos-btn py-1 px-3 rounded-md border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 filter-pos-btn-active">Left</button>
                <button id="filterPosRight" class="filter-pos-btn py-1 px-3 rounded-md border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700">Right</button>
                <button id="filterPosBottom" class="filter-pos-btn py-1 px-3 rounded-md border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700">Bottom</button>
            </div>
            <div id="mainContentContainer" class="flex flex-col gap-6 filters-left">
                <aside id="filterSidebar" class="w-full p-4 bg-secondary-light dark:bg-secondary-dark rounded-lg shadow border border-border-light dark:border-border-dark filters-panel-left">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-semibold text-text-light dark:text-text-dark">Filters</h3>
                        <button id="resetFiltersBtn" class="text-xs text-gray-600 dark:text-gray-400 hover:underline">Reset All</button>
                    </div>
                    <form id="filterForm">
                        <div class="filter-section" id="categoryFilterSection">
                            <h4 class="filter-title text-text-light dark:text-text-dark">Category</h4>
                            <input type="text" id="filterCategorySearch" placeholder="Search Categories" class="w-full p-2 mb-2 border border-gray-300 dark:border-gray-600 rounded-md bg-primary-light dark:bg-gray-700 text-text-light dark:text-text-dark text-sm focus:outline-none focus:ring-1">
                            <div id="categoryFilterCheckboxes" class="space-y-1 max-h-40 overflow-y-auto text-sm">
                                <label class="flex items-center"><input type="checkbox" name="category" value="Bearings" class="mr-2 rounded"> Bearings</label>
                                <label class="flex items-center"><input type="checkbox" name="category" value="Gears" class="mr-2 rounded"> Gears</label>
                                <label class="flex items-center"><input type="checkbox" name="category" value="Motors" class="mr-2 rounded"> Motors</label>
                                <label class="flex items-center"><input type="checkbox" name="category" value="Fasteners" class="mr-2 rounded"> Fasteners</label>
                                <label class="flex items-center"><input type="checkbox" name="category" value="Pneumatics" class="mr-2 rounded"> Pneumatics</label>
                                <label class="flex items-center"><input type="checkbox" name="category" value="Belts" class="mr-2 rounded"> Belts</label>
                                <label class="flex items-center"><input type="checkbox" name="category" value="Valves" class="mr-2 rounded"> Valves</label>
                                <label class="flex items-center"><input type="checkbox" name="category" value="Sensors" class="mr-2 rounded"> Sensors</label>
                            </div>
                        </div>
                        <div class="filter-section" id="brandFilterSection">
                            <h4 class="filter-title text-text-light dark:text-text-dark">Brand</h4>
                            <input type="text" id="filterBrandSearch" placeholder="Search Brands" class="w-full p-2 mb-2 border border-gray-300 dark:border-gray-600 rounded-md bg-primary-light dark:bg-gray-700 text-text-light dark:text-text-dark text-sm focus:outline-none focus:ring-1">
                            <div id="brandFilterCheckboxes" class="space-y-1 max-h-40 overflow-y-auto text-sm">
                                <label class="flex items-center"><input type="checkbox" name="brand" value="SKF" class="mr-2 rounded"> SKF</label>
                                <label class="flex items-center"><input type="checkbox" name="brand" value="Timken" class="mr-2 rounded"> Timken</label>
                                <label class="flex items-center"><input type="checkbox" name="brand" value="Siemens" class="mr-2 rounded"> Siemens</label>
                                <label class="flex items-center"><input type="checkbox" name="brand" value="Festo" class="mr-2 rounded"> Festo</label>
                                <label class="flex items-center"><input type="checkbox" name="brand" value="Gates" class="mr-2 rounded"> Gates</label>
                                <label class="flex items-center"><input type="checkbox" name="brand" value="ASCO" class="mr-2 rounded"> ASCO</label>
                                <label class="flex items-center"><input type="checkbox" name="brand" value="Omron" class="mr-2 rounded"> Omron</label>
                                <label class="flex items-center"><input type="checkbox" name="brand" value="Generic" class="mr-2 rounded"> Generic</label>
                            </div>
                        </div>
                        <div class="filter-section" id="priceFilterSection">
                            <h4 class="filter-title text-text-light dark:text-text-dark">Price Range</h4>
                            <div id="priceRangeSlider" class="w-full mt-4"></div>
                            <div class="flex justify-between text-sm mt-2">
                                <span id="priceRangeMin">$0</span>
                                <span id="priceRangeMax">$1000</span>
                            </div>
                        </div>
                        <div class="filter-section" id="distanceFilterSection">
                            <h4 class="filter-title text-text-light dark:text-text-dark">Distance (km)</h4>
                            <input type="number" id="filterDistance" name="distance" placeholder="Max Distance" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-primary-light dark:bg-gray-700 text-text-light dark:text-text-dark text-sm focus:outline-none focus:ring-1" min="0">
                        </div>
                        <div class="filter-section" id="ratingFilterSection">
                            <h4 class="filter-title text-text-light dark:text-text-dark">Rating</h4>
                            <div id="ratingFilterRadios" class="space-y-1 text-sm"></div>
                        </div>
                        <div class="filter-section" id="inStockFilterSection">
                            <h4 class="filter-title text-text-light dark:text-text-dark">Availability</h4>
                            <label class="flex items-center text-sm"><input type="checkbox" id="filterInStock" name="inStock" class="mr-2 rounded"> In Stock Only</label>
                        </div>
                        <div class="filter-section" id="materialFilterSection">
                            <h4 class="filter-title text-text-light dark:text-text-dark">Material</h4>
                            <div id="materialFilterCheckboxes" class="space-y-1 text-sm max-h-32 overflow-y-auto">
                                <label class="flex items-center"><input type="checkbox" name="material" value="Steel" class="mr-2 rounded"> Steel</label>
                                <label class="flex items-center"><input type="checkbox" name="material" value="Stainless Steel" class="mr-2 rounded"> Stainless Steel</label>
                                <label class="flex items-center"><input type="checkbox" name="material" value="Aluminum" class="mr-2 rounded"> Aluminum</label>
                                <label class="flex items-center"><input type="checkbox" name="material" value="Brass" class="mr-2 rounded"> Brass</label>
                                <label class="flex items-center"><input type="checkbox" name="material" value="Plastic" class="mr-2 rounded"> Plastic</label>
                                <label class="flex items-center"><input type="checkbox" name="material" value="Rubber" class="mr-2 rounded"> Rubber</label>
                            </div>
                        </div>
                        <div class="filter-section" id="conditionFilterSection">
                            <h4 class="filter-title text-text-light dark:text-text-dark">Condition</h4>
                            <div class="space-y-1 text-sm">
                                <label class="flex items-center"><input type="radio" name="condition" value="" class="mr-2" checked> Any</label>
                                <label class="flex items-center"><input type="radio" name="condition" value="New" class="mr-2"> New</label>
                                <label class="flex items-center"><input type="radio" name="condition" value="Used" class="mr-2"> Used</label>
                                <label class="flex items-center"><input type="radio" name="condition" value="Refurbished" class="mr-2"> Refurbished</label>
                            </div>
                        </div>
                        <div class="filter-section" id="discountFilterSection">
                            <h4 class="filter-title text-text-light dark:text-text-dark">Discount</h4>
                            <div class="space-y-1 text-sm">
                                <label class="flex items-center"><input type="radio" name="discount" value="" class="mr-2" checked> Any</label>
                                <label class="flex items-center"><input type="radio" name="discount" value="10" class="mr-2"> 10% & Up</label>
                                <label class="flex items-center"><input type="radio" name="discount" value="25" class="mr-2"> 25% & Up</label>
                                <label class="flex items-center"><input type="radio" name="discount" value="50" class="mr-2"> 50% & Up</label>
                            </div>
                        </div>
                        <div class="filter-section" id="sizeFilterSection">
                            <h4 class="filter-title text-text-light dark:text-text-dark">Size/Dimensions</h4>
                            <input type="text" id="filterSize" name="size" placeholder="e.g., 20mm, 1/2 inch x 2 inch" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-primary-light dark:bg-gray-700 text-text-light dark:text-text-dark text-sm focus:outline-none focus:ring-1">
                        </div>
                        <div class="filter-section" id="warrantyFilterSection">
                            <h4 class="filter-title text-text-light dark:text-text-dark">Warranty Period</h4>
                            <div class="space-y-1 text-sm">
                                <label class="flex items-center"><input type="radio" name="warranty" value="" class="mr-2" checked> Any</label>
                                <label class="flex items-center"><input type="radio" name="warranty" value="6" class="mr-2"> 6 Months & Up</label>
                                <label class="flex items-center"><input type="radio" name="warranty" value="12" class="mr-2"> 1 Year & Up</label>
                                <label class="flex items-center"><input type="radio" name="warranty" value="24" class="mr-2"> 2 Years & Up</label>
                            </div>
                        </div>
                        <div class="filter-buttons-container">
                            <button type="button" id="applyFiltersBtn" class="w-full bg-gray-700 hover:bg-gray-800 dark:bg-gray-300 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors">Apply Filters</button>
                        </div>
                    </form>
                </aside>
                <section id="productListingArea" class="w-full flex flex-col">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-4 p-3 bg-secondary-light dark:bg-secondary-dark rounded-lg shadow border border-border-light dark:border-border-dark">
                        <p class="text-sm text-text-light dark:text-text-dark mb-2 sm:mb-0">Showing <span id="resultsCountStart">1</span>-<span id="resultsCountEnd">0</span> of <span id="resultsTotalCount" class="font-semibold">0</span> results for "<span id="searchTermDisplay" class="font-semibold">All Parts</span>"</p>
                        <div class="flex items-center space-x-2 mt-2 sm:mt-0">
                            <span class="text-sm text-text-light dark:text-text-dark">Sort by:</span>
                            <select id="sortOptions" class="p-1.5 border border-gray-300 dark:border-gray-600 rounded-md bg-primary-light dark:bg-gray-700 text-text-light dark:text-text-dark text-xs focus:outline-none focus:ring-1">
                                <option value="best-match">Best Match</option>
                                <option value="new-arrivals">New Arrivals</option>
                                <option value="price-low-high">Price: Low to High</option>
                                <option value="price-high-low">Price: High to Low</option>
                                <option value="most-popular">Most Popular</option>
                            </select>
                            <div class="flex border border-gray-300 dark:border-gray-600 rounded-md overflow-hidden">
                                <button id="layoutGrid2Btn" title="2 Column Grid" class="layout-btn p-1.5 hover:bg-gray-200 dark:hover:bg-gray-500 text-xs">2 Col</button>
                                <button id="layoutGrid3Btn" title="3 Column Grid" class="layout-btn p-1.5 hover:bg-gray-200 dark:hover:bg-gray-500 border-l border-gray-300 dark:border-gray-600 text-xs layout-btn-active">3 Col</button>
                                <button id="layoutGrid4Btn" title="4 Column Grid" class="layout-btn p-1.5 hover:bg-gray-200 dark:hover:bg-gray-500 border-l border-gray-300 dark:border-gray-600 text-xs">4 Col</button>
                                <button id="layoutListBtn" title="List View" class="layout-btn p-1.5 hover:bg-gray-200 dark:hover:bg-gray-500 border-l border-gray-300 dark:border-gray-600">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                                </button>
                                <button id="layoutCompareBtn" title="Compare View (Select Products)" class="layout-btn p-1.5 hover:bg-gray-200 dark:hover:bg-gray-500 border-l border-gray-300 dark:border-gray-600">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="productDisplayAreaWrapper" class="flex-grow">
                        <div id="productDisplayArea" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
                    </div>
                    <div id="comparisonViewArea" class="hidden mt-6 p-4 bg-secondary-light dark:bg-secondary-dark rounded-lg shadow border border-border-light dark:border-border-dark">
                        <h3 class="text-xl font-semibold mb-4 text-text-light dark:text-text-dark">Compare Products</h3>
                        <div id="comparisonItems" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                        <div id="comparisonTable" class="mt-4"></div>
                    </div>
                    <div id="paginationControls" class="mt-8 flex justify-center"></div>
                </section>
            </div>
        </main>
        <footer class="bg-secondary-dark dark:bg-primary-dark text-gray-300 dark:text-gray-400 py-8 mt-auto border-t border-border-dark dark:border-gray-700 w-full">
            <div class="container mx-auto px-4 text-center text-sm">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <h5 class="font-semibold mb-2 text-gray-100 dark:text-white">About Us</h5>
                        <ul class="space-y-1">
                            <li><a href="#" class="hover:text-gray-300 dark:hover:text-gray-100">Company Info</a></li>
                            <li><a href="#" class="hover:text-gray-300 dark:hover:text-gray-100">Careers</a></li>
                            <li><a href="#" class="hover:text-gray-300 dark:hover:text-gray-100">Press</a></li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="font-semibold mb-2 text-gray-100 dark:text-white">Customer Service</h5>
                        <ul class="space-y-1">
                            <li><a href="#" class="hover:text-gray-300 dark:hover:text-gray-100">Contact Us</a></li>
                            <li><a href="#" class="hover:text-gray-300 dark:hover:text-gray-100">FAQs</a></li>
                            <li><a href="#" class="hover:text-gray-300 dark:hover:text-gray-100">Shipping & Returns</a></li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="font-semibold mb-2 text-gray-100 dark:text-white">Policies</h5>
                        <ul class="space-y-1">
                            <li><a href="#" class="hover:text-gray-300 dark:hover:text-gray-100">Privacy Policy</a></li>
                            <li><a href="#" class="hover:text-gray-300 dark:hover:text-gray-100">Terms of Service</a></li>
                        </ul>
                    </div>
                </div>
                <p>© <span id="currentYear"></span> Quest Network Commerce. All rights reserved.</p>
                <p>Designed for Network Commerce Search.</p>
            </div>
        </footer>
    </div>
    <div id="voiceSearchModal" class="modal">
        <div class="modal-content shadow-xl">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-border-light dark:border-border-dark">
                <h3 class="text-xl font-semibold">Voice Search</h3>
                <button id="closeVoiceModal" class="text-2xl font-bold hover:text-red-500">×</button>
            </div>
            <p class="mb-2 text-sm">Listening... Say your search query.</p>
            <div class="w-16 h-16 mx-auto my-4 bg-gray-700 dark:bg-gray-300 rounded-full flex items-center justify-center animate-pulse">
                <svg class="w-8 h-8 text-white dark:text-gray-900" fill="currentColor" viewBox="0 0 20 20"><path d="M7 4a3 3 0 016 0v4a3 3 0 01-6 0V4zm1 10.585A6.001 6.001 0 0014 14V8h2v6a8 8 0 01-14.044 4.463l-.005-.017L1.95 18.44A8.003 8.003 0 018 2a8 8 0 018 8v6c0 1.886-.67 3.633-1.793 4.999L14 14.585V14a6.001 6.001 0 00-6-5.915z"/></svg>
            </div>
            <p id="voiceTranscript" class="text-center italic text-gray-600 dark:text-gray-400 h-6 mb-4">"Show me 1/2 inch steel bolts"</p>
            <button id="executeVoiceSearchBtn" class="mt-4 w-full bg-gray-700 hover:bg-gray-800 dark:bg-gray-300 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors">Search</button>
        </div>
    </div>
    <div id="barcodeSearchModal" class="modal">
        <div class="modal-content shadow-xl">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-border-light dark:border-border-dark">
                <h3 class="text-xl font-semibold">Barcode/QR Code Scan</h3>
                <button id="closeBarcodeModal" class="text-2xl font-bold hover:text-red-500">×</button>
            </div>
            <p class="mb-2 text-sm">Scan a barcode/QR code or upload an image.</p>
            <div id="qrCodeScanner" class="w-full h-64 bg-gray-200 dark:bg-gray-900 my-4 rounded-md border border-border-light dark:border-border-dark"></div>
            <p class="text-center italic text-gray-600 dark:text-gray-400 h-6 mb-2">Scanned: <span id="scannedCode">---</span></p>
            <div class="preview-container w-full bg-gray-100 dark:bg-gray-700 my-2 rounded-md border border-border-light dark:border-border-dark">
                <img id="qrCodePreview" src="https://placehold.co/300x200/e2e8f0/cbd5e0?text=Preview" alt="QR Code Preview" class="hidden">
                <p id="qrCodePreviewPlaceholder" class="text-gray-400 dark:text-gray-500">Preview will appear here</p>
            </div>
            <input type="file" id="qrCodeUploadInput" accept="image/*" class="block w-full text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-200 dark:file:bg-gray-700 file:text-gray-700 dark:file:text-gray-200 hover:file:bg-gray-300 dark:hover:file:bg-gray-600 mb-3">
            <div class="flex space-x-2 mt-4">
                <button id="startBarcodeScanBtn" class="w-1/2 bg-gray-700 dark:bg-gray-300 hover:bg-gray-800 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors">Start Scan</button>
                <button id="executeBarcodeSearchBtn" class="w-1/2 bg-gray-700 dark:bg-gray-300 hover:bg-gray-800 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors">Search Scanned Code</button>
            </div>
        </div>
    </div>
    <div id="imageSearchModal" class="modal">
        <div class="modal-content shadow-xl">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-border-light dark:border-border-dark">
                <h3 class="text-xl font-semibold">Image Search</h3>
                <button id="closeImageSearchModal" class="text-2xl font-bold hover:text-red-500">×</button>
            </div>
            <p class="mb-3 text-sm">Capture or upload an image of the part.</p>
            <div id="cameraFeed" class="w-full h-64 bg-gray-200 dark:bg-gray-900 my-4 rounded-md border border-border-light dark:border-border-dark"></div>
            <div class="preview-container w-full bg-gray-100 dark:bg-gray-700 my-2 rounded-md border border-border-light dark:border-border-dark">
                <img id="imagePreview" src="https://placehold.co/300x200/e2e8f0/cbd5e0?text=Preview" alt="Image Preview" class="hidden">
                <p id="imagePreviewPlaceholder" class="text-gray-400 dark:text-gray-500">Image preview will appear here</p>
            </div>
            <input type="file" id="imageUploadInput" accept="image/*" class="block w-full text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-200 dark:file:bg-gray-700 file:text-gray-700 dark:file:text-gray-200 hover:file:bg-gray-300 dark:hover:file:bg-gray-600 mb-3">
            <div class="flex space-x-2 mt-4">
                <button id="captureImageBtn" class="w-1/2 bg-gray-700 dark:bg-gray-300 hover:bg-gray-800 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors">Capture Image</button>
                <button id="executeImageSearchBtn" class="w-1/2 bg-gray-700 dark:bg-gray-300 hover:bg-gray-800 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors">Search by Image</button>
            </div>
        </div>
    </div>
    <div id="videoSearchModal" class="modal">
        <div class="modal-content shadow-xl">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-border-light dark:border-border-dark">
                <h3 class="text-xl font-semibold">Video Search</h3>
                <button id="closeVideoSearchModal" class="text-2xl font-bold hover:text-red-500">×</button>
            </div>
            <p class="mb-3 text-sm">Record a short video of the part.</p>
            <div id="videoFeed" class="w-full h-64 bg-gray-200 dark:bg-gray-900 my-4 rounded-md border border-border-light dark:border-border-dark"></div>
            <div class="preview-container w-full bg-gray-100 dark:bg-gray-700 my-2 rounded-md border border-border-light dark:border-border-dark">
                <video id="videoPreview" controls class="hidden"></video>
                <p id="videoPreviewPlaceholder" class="text-gray-400 dark:text-gray-500">Video preview will appear here</p>
            </div>
            <div class="flex space-x-2 mt-4">
                <button id="startVideoRecordBtn" class="w-1/3 bg-gray-700 dark:bg-gray-300 hover:bg-gray-800 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors">Start Recording</button>
                <button id="stopVideoRecordBtn" class="w-1/3 bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-md text-sm transition-colors" disabled>Stop Recording</button>
                <button id="executeVideoSearchBtn" class="w-1/3 bg-gray-700 dark:bg-gray-300 hover:bg-gray-800 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors" disabled>Search by Video</button>
            </div>
        </div>
    </div>
    <div id="quickViewModal" class="modal">
        <div class="modal-content shadow-xl max-w-3xl">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-border-light dark:border-border-dark">
                <h3 id="quickViewProductName" class="text-xl font-semibold">Product Name</h3>
                <button id="closeQuickViewModal" class="text-2xl font-bold hover:text-red-500">×</button>
            </div>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="md:w-1/2">
                    <img id="quickViewProductImage" src="https://placehold.co/400x400/e2e8f0/cbd5e0?text=Part+Image" alt="Product Image" class="w-full h-auto rounded-md object-cover border border-border-light dark:border-border-dark">
                </div>
                <div class="md:w-1/2">
                    <p id="quickViewProductDescription" class="text-sm mb-3 text-gray-600 dark:text-gray-300">Detailed product description goes here...</p>
                    <p class="text-2xl font-bold mb-3" id="quickViewProductPrice">$0.00</p>
                    <div class="mb-4">
                        <span class="text-sm font-medium">Availability:</span>
                        <span id="quickViewProductAvailability" class="font-semibold ml-1">In Stock</span>
                    </div>
                    <button class="add-to-cart-quickview w-full bg-gray-700 hover:bg-gray-800 dark:bg-gray-300 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2.5 px-4 rounded-md text-sm transition-colors mb-2">Add to Cart</button>
                    <button id="quickViewProductLink" class="block w-full text-center text-sm bg-gray-600 hover:bg-gray-700 dark:bg-gray-400 dark:hover:bg-gray-500 text-white dark:text-gray-900 font-semibold py-2 rounded-md transition-colors">View Full Details</button>
                </div>
            </div>
        </div>
    </div>
    <div id="productDetailsModal" class="modal">
        <div class="modal-content shadow-xl max-w-4xl">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-border-light dark:border-border-dark">
                <h3 id="productDetailsName" class="text-xl font-semibold">Product Details</h3>
                <button id="closeProductDetailsModal" class="text-2xl font-bold hover:text-red-500">×</button>
            </div>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="md:w-1/2">
                    <img id="productDetailsImage" src="https://placehold.co/400x400/e2e8f0/cbd5e0?text=Part+Image" alt="Product Image" class="w-full h-auto rounded-md object-cover border border-border-light dark:border-border-dark">
                </div>
                <div class="md:w-1/2">
                    <p id="productDetailsDescription" class="text-sm mb-3 text-gray-600 dark:text-gray-300"></p>
                    <p class="text-2xl font-bold mb-3" id="productDetailsPrice">$0.00</p>
                    <div class="mb-2">
                        <span class="text-sm font-medium">Availability:</span>
                        <span id="productDetailsAvailability" class="font-semibold ml-1"></span>
                    </div>
                    <div class="mb-2">
                        <span class="text-sm font-medium">Category:</span>
                        <span id="productDetailsCategory" class="ml-1 text-sm"></span>
                    </div>
                    <div class="mb-2">
                        <span class="text-sm font-medium">Brand:</span>
                        <span id="productDetailsBrand" class="ml-1 text-sm"></span>
                    </div>
                    <div class="mb-2">
                        <span class="text-sm font-medium">Material:</span>
                        <span id="productDetailsMaterial" class="ml-1 text-sm"></span>
                    </div>
                    <div class="mb-2">
                        <span class="text-sm font-medium">Condition:</span>
                        <span id="productDetailsCondition" class="ml-1 text-sm"></span>
                    </div>
                    <div class="mb-2">
                        <span class="text-sm font-medium">Rating:</span>
                        <span id="productDetailsRating" class="ml-1 text-sm"></span>
                    </div>
                    <div class="mb-2">
                        <span class="text-sm font-medium">Discount:</span>
                        <span id="productDetailsDiscount" class="ml-1 text-sm"></span>
                    </div>
                    <div class="mb-2">
                        <span class="text-sm font-medium">Distance:</span>
                        <span id="productDetailsDistance" class="ml-1 text-sm"></span>
                    </div>
                    <div class="mb-2">
                        <span class="text-sm font-medium">Warranty:</span>
                        <span id="productDetailsWarranty" class="ml-1 text-sm"></span>
                    </div>
                    <div class="mb-2">
                        <span class="text-sm font-medium">Size:</span>
                        <span id="productDetailsSize" class="ml-1 text-sm"></span>
                    </div>
                    <button class="add-to-cart-details w-full bg-gray-700 hover:bg-gray-800 dark:bg-gray-300 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2.5 px-4 rounded-md text-sm transition-colors mt-2">Add to Cart</button>
                </div>
            </div>
        </div>
    </div>
    <div id="customizeSearchModal" class="modal">
        <div class="modal-content shadow-xl max-w-900">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-border-light dark:border-border-dark">
                <h3 class="text-xl font-semibold">Customize Search & Filters</h3>
                <button id="closeCustomizeSearchModal" class="text-2xl font-bold hover:text-red-500">×</button>
            </div>
            <p class="mb-3 text-sm">Drag to reorder search and filter options, toggle to enable/disable, or add new filters.</p>
            <div class="customize-options-container">
                <div class="customize-options-column">
                    <h4 class="text-md font-semibold mb-2">Search Options</h4>
                    <div id="sortableSearchOptions" class="mb-4">
                        <div class="sortable-item flex items-center justify-between" data-option="text">
                            <span>Text Search</span>
                            <input type="checkbox" class="search-option-toggle mr-2 rounded" data-option="text" checked disabled>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-option="voice">
                            <span>Voice Search</span>
                            <input type="checkbox" class="search-option-toggle mr-2 rounded" data-option="voice" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-option="barcode">
                            <span>Barcode/QR Code</span>
                            <input type="checkbox" class="search-option-toggle mr-2 rounded" data-option="barcode" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-option="image">
                            <span>Image Search</span>
                            <input type="checkbox" class="search-option-toggle mr-2 rounded" data-option="image" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-option="video">
                            <span>Video Search</span>
                            <input type="checkbox" class="search-option-toggle mr-2 rounded" data-option="video" checked>
                        </div>
                    </div>
                </div>
                <div class="customize-options-column">
                    <h4 class="text-md font-semibold mb-2">Filter Options</h4>
                    <div id="sortableFilterOptions" class="space-y-2 mb-4">
                        <div class="sortable-item flex items-center justify-between" data-filter="category">
                            <span>Category</span>
                            <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="category" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-filter="brand">
                            <span>Brand</span>
                            <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="brand" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-filter="price">
                            <span>Price Range</span>
                            <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="price" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-filter="distance">
                            <span>Distance</span>
                            <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="distance" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-filter="rating">
                            <span>Rating</span>
                            <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="rating" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-filter="inStock">
                            <span>Availability</span>
                            <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="inStock" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-filter="material">
                            <span>Material</span>
                            <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="material" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-filter="condition">
                            <span>Condition</span>
                            <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="condition" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-filter="discount">
                            <span>Discount</span>
                            <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="discount" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-filter="size">
                            <span>Size/Dimensions</span>
                            <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="size" checked>
                        </div>
                        <div class="sortable-item flex items-center justify-between" data-filter="warranty">
                            <span>Warranty Period</span>
                            <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="warranty" checked>
                        </div>
                    </div>
                </div>
            </div>
            <h4 class="text-md font-semibold mb-2">Add New Filter</h4>
            <div class="flex flex-col gap-2">
                <input type="text" id="newFilterName" placeholder="Filter Name (e.g., Weight)" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-primary-light dark:bg-gray-700 text-text-light dark:text-text-dark text-sm focus:outline-none focus:ring-1">
                <select id="newFilterType" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-primary-light dark:bg-gray-700 text-text-light dark:text-text-dark text-sm focus:outline-none focus:ring-1">
                    <option value="text">Text Input</option>
                    <option value="checkbox">Checkboxes</option>
                    <option value="radio">Radio Buttons</option>
                </select>
                <textarea id="newFilterOptions" placeholder="Enter options (one per line, for checkboxes/radio)" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-primary-light dark:bg-gray-700 text-text-light dark:text-text-dark text-sm focus:outline-none focus:ring-1" rows="4"></textarea>
                <button id="addNewFilterBtn" class="bg-gray-700 hover:bg-gray-800 dark:bg-gray-300 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors">Add Filter</button>
            </div>
            <button id="applyCustomizationBtn" class="mt-4 w-full bg-gray-700 hover:bg-gray-800 dark:bg-gray-300 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors">Apply Customization</button>
        </div>
    </div>
    <script>
$(document).ready(function() {
    // --- Global Variables ---
    let currentPage = 1;
    const itemsPerPage = 9;
    let currentLayout = 'grid-3';
    let currentFilteredProducts = [];
    let productsToCompare = [];
    let html5QrCode = null;
    let stream = null;
    let mediaRecorder = null;
    let recordedChunks = [];
    let searchOptionsOrder = ['text', 'voice', 'barcode', 'image', 'video'];
    let filterOptionsOrder = ['category', 'brand', 'price', 'distance', 'rating', 'inStock', 'material', 'condition', 'discount', 'size', 'warranty'];
    let enabledSearchOptions = ['text', 'voice', 'barcode', 'image', 'video'];
    let enabledFilters = ['category', 'brand', 'price', 'distance', 'rating', 'inStock', 'material', 'condition', 'discount', 'size', 'warranty'];
    let customFilters = {};
    const productDisplayArea = $('#productDisplayArea');
    const comparisonViewArea = $('#comparisonViewArea');
    const comparisonItemsContainer = $('#comparisonItems');
    const comparisonTableContainer = $('#comparisonTable');

    // --- Theme Toggle ---
    const themeToggleBtn = $('#themeToggleBtn');
    const themeIconMoon = $('#themeIconMoon');
    const themeIconSun = $('#themeIconSun');
    const initialTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

    function applyTheme(theme) {
        if (theme === 'dark') {
            $('html').addClass('dark').removeClass('light');
            themeIconMoon.hide();
            themeIconSun.show();
            $('.modal-content').removeClass('light').addClass('dark');
        } else {
            $('html').removeClass('dark').addClass('light');
            themeIconSun.hide();
            themeIconMoon.show();
            $('.modal-content').removeClass('dark').addClass('light');
        }
        const activeLayoutBtn = $('.layout-btn-active');
        if (activeLayoutBtn.length) setActiveLayoutButton(activeLayoutBtn.attr('id'));
        const activeFilterPosBtn = $('.filter-pos-btn-active');
        if (activeFilterPosBtn.length) setActiveFilterPosButton(activeFilterPosBtn.attr('id'));
        $('#paginationControls .pagination-item.active a').toggleClass('bg-gray-700 text-white border-gray-700', theme === 'light').toggleClass('bg-gray-300 text-gray-900 border-gray-300', theme === 'dark');
    }
    applyTheme(initialTheme);
    themeToggleBtn.on('click', function() {
        const newTheme = $('html').hasClass('dark') ? 'light' : 'dark';
        localStorage.setItem('theme', newTheme);
        applyTheme(newTheme);
    });

    // --- Mock Product Data ---
    const mockProducts = [
        { id: 1, name: "Cylindrical Roller Bearing NU205", category: "Bearings", brand: "SKF", price: 45.99, rating: 4, inStock: true, imageUrl: "https://placehold.co/300x300/e2e8f0/707070?text=Bearing+NU205", description: "High-quality cylindrical roller bearing for industrial applications.", material: "Steel", condition: "New", discountValue: 10, discountText: "10% OFF", barcode: "123456789012", distance: 5, warranty: 12, size: "25mm x 52mm x 15mm" },
        { id: 2, name: "Spur Gear Module 2, 30 Teeth", category: "Gears", brand: "Generic", price: 22.50, rating: 5, inStock: true, imageUrl: "https://placehold.co/300x300/d1d5db/606060?text=Spur+Gear", description: "Precision steel spur gear, module 2, 30 teeth.", material: "Steel", condition: "New", discountValue: 0, barcode: "234567890123", distance: 10, warranty: 6, size: "60mm OD" },
        { id: 3, name: "AC Induction Motor 1HP", category: "Motors", brand: "Siemens", price: 180.00, rating: 4, inStock: false, imageUrl: "https://placehold.co/300x300/9ca3af/505050?text=AC+Motor", description: "Reliable 1HP AC induction motor, three-phase.", material: "Aluminum", condition: "New", discountValue: 0, barcode: "345678901234", distance: 15, warranty: 24, size: "200mm x 150mm x 300mm" },
        { id: 4, name: "M6 Hex Bolt Stainless Steel (Pack of 50)", category: "Fasteners", brand: "Generic", price: 12.75, rating: 3, inStock: true, imageUrl: "https://placehold.co/300x300/6b7280/404040?text=Hex+Bolts", description: "Pack of 50 M6x20mm stainless steel hex bolts.", material: "Stainless Steel", condition: "New", discountValue: 5, discountText: "5% OFF", barcode: "456789012345", distance: 8, warranty: 6, size: "M6 x 20mm" },
        { id: 5, name: "Deep Groove Ball Bearing 6203ZZ", category: "Bearings", brand: "Timken", price: 8.90, rating: 5, inStock: true, imageUrl: "https://placehold.co/300x300/4b5563/303030?text=Bearing+6203ZZ", description: "Shielded deep groove ball bearing.", material: "Steel", condition: "New", discountValue: 0, barcode: "567890123456", distance: 12, warranty: 12, size: "17mm x 40mm x 12mm" },
        { id: 6, name: "Pneumatic Cylinder DNC-32-100-PPV-A", category: "Pneumatics", brand: "Festo", price: 75.00, rating: 4, inStock: true, imageUrl: "https://placehold.co/300x300/374151/202020?text=Pneumatic+Cylinder", description: "Double-acting pneumatic standard cylinder.", material: "Aluminum", condition: "New", discountValue: 0, barcode: "678901234567", distance: 20, warranty: 12, size: "32mm bore x 100mm stroke" },
        { id: 7, name: "V-Belt A-Section 32 inch", category: "Belts", brand: "Gates", price: 15.20, rating: 4, inStock: false, imageUrl: "https://placehold.co/300x300/1f2937/101010?text=V-Belt", description: "Durable V-belt for power transmission.", material: "Rubber", condition: "New", discountValue: 0, barcode: "789012345678", distance: 25, warranty: 6, size: "32 inch" },
        { id: 8, name: "Industrial Solenoid Valve 1/2\" NPT", category: "Valves", brand: "ASCO", price: 55.00, rating: 4, inStock: true, imageUrl: "https://placehold.co/300x300/e2e8f0/707070?text=Solenoid+Valve", description: "1/2\" NPT solenoid valve for industrial fluid control.", material: "Brass", condition: "New", discountValue: 0, barcode: "789012345679", distance: 18, warranty: 12, size: "1/2 inch NPT" },
        { id: 9, name: "Proximity Sensor M18", category: "Sensors", brand: "Omron", price: 35.00, rating: 5, inStock: true, imageUrl: "https://placehold.co/300x300/e2e8f0/707070?text=Proximity+Sensor", description: "Inductive proximity sensor, M18, NPN output.", material: "Stainless Steel", condition: "New", discountValue: 0, barcode: "890123456789", distance: 22, warranty: 12, size: "M18 x 60mm" }
    ];
    currentFilteredProducts = [...mockProducts];

    // --- Filter Position Handling ---
    function setActiveFilterPosButton(buttonId) {
        $('.filter-pos-btn').removeClass('filter-pos-btn-active');
        $(`#${buttonId}`).addClass('filter-pos-btn-active');
    }

    function setFilterPosition(position) {
        const mainContainer = $('#mainContentContainer');
        const filterSidebar = $('#filterSidebar');
        const filterForm = $('#filterForm');
        mainContainer.removeClass('filters-left filters-right filters-top filters-bottom');
        filterSidebar.removeClass('filters-panel-horizontal filters-panel-left filters-panel-right filters-panel-bottom');
        filterForm.removeClass('filters-form-horizontal');

        if (position === 'top') {
            mainContainer.addClass('filters-top');
            filterSidebar.addClass('filters-panel-horizontal');
            filterForm.addClass('filters-form-horizontal');
            equalizeFilterHeights();
        } else if (position === 'left') {
            mainContainer.addClass('filters-left');
            filterSidebar.addClass('filters-panel-left');
        } else if (position === 'right') {
            mainContainer.addClass('filters-right');
            filterSidebar.addClass('filters-panel-right');
        } else if (position === 'bottom') {
            mainContainer.addClass('filters-bottom');
            filterSidebar.addClass('filters-panel-horizontal filters-panel-bottom');
            filterForm.addClass('filters-form-horizontal');
            equalizeFilterHeights();
        }
        setActiveFilterPosButton(`filterPos${position.charAt(0).toUpperCase() + position.slice(1)}`);
    }

    // Set default filter position to Left
    setFilterPosition('left');

    $('#filterPosTop').on('click', () => setFilterPosition('top'));
    $('#filterPosLeft').on('click', () => setFilterPosition('left'));
    $('#filterPosRight').on('click', () => setFilterPosition('right'));
    $('#filterPosBottom').on('click', () => setFilterPosition('bottom'));

    // --- Equalize Filter Heights for Horizontal Layout ---
    function equalizeFilterHeights() {
        if ($('#filterForm').hasClass('filters-form-horizontal')) {
            const filterSections = $('#filterForm .filter-section');
            let maxHeight = 0;
            filterSections.css('height', 'auto'); // Reset heights
            filterSections.each(function() {
                const height = $(this).outerHeight();
                if (height > maxHeight) maxHeight = height;
            });
            filterSections.css('height', `${maxHeight}px`);
        } else {
            $('#filterForm .filter-section').css('height', 'auto');
        }
        // Ensure product listing aligns with filter sidebar
        const productListingArea = $('#productListingArea');
        const filterSidebar = $('#filterSidebar');
        if ($('#mainContentContainer').hasClass('filters-left') || $('#mainContentContainer').hasClass('filters-right')) {
            const sidebarHeight = filterSidebar.outerHeight();
            productListingArea.css('min-height', `${sidebarHeight}px`);
        } else {
            productListingArea.css('min-height', 'auto');
        }
    }

    // Call on window resize to adjust filter heights and alignment
    $(window).on('resize', equalizeFilterHeights);

    // --- Voice Search Handling ---
    let recognition = null;
    function initializeVoiceSearch() {
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                $('#voiceTranscript').text('Listening...');
            };

            recognition.onresult = function(event) {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                $('#voiceTranscript').text(transcript || 'Speak now...');
            };

            recognition.onerror = function(event) {
                console.error('Voice recognition error:', event.error);
                $('#voiceTranscript').text('Error occurred. Please try again.');
                if (event.error === 'no-speech' || event.error === 'not-allowed' || event.error === 'service-not-allowed') {
                    $('#voiceSearchModal').hide();
                    recognition.stop();
                }
            };

            recognition.onend = function() {
                if ($('#voiceSearchModal').is(':visible')) {
                    $('#voiceTranscript').text('Processing...');
                }
            };

            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function() {
                    recognition.start();
                })
                .catch(function(err) {
                    console.error('Microphone access denied:', err);
                    $('#voiceTranscript').text('Microphone access denied.');
                    $('#voiceSearchModal').hide();
                });
        } else {
            $('#voiceTranscript').text('Voice recognition not supported in this browser.');
            $('#voiceSearchModal').hide();
        }
    }

    $('#voiceSearchBtn').on('click', function() {
        if (enabledSearchOptions.includes('voice')) {
            $('#voiceSearchModal').show();
            initializeVoiceSearch();
        }
    });

    $('#closeVoiceModal').on('click', function() {
        if (recognition) recognition.stop();
        $('#voiceSearchModal').hide();
    });

    $('#executeVoiceSearchBtn').on('click', function() {
        if (recognition) recognition.stop();
        const query = $('#voiceTranscript').text();
        if (query && query !== 'Listening...' && query !== 'Processing...' && query !== 'Speak now...') {
            $('#productSearchInput').val(query);
            filterProducts();
        }
        $('#voiceSearchModal').hide();
    });

    // --- Product Display ---
    function displayProducts(products, page = 1) {
        productDisplayArea.empty();
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const paginatedProducts = products.slice(start, end);

        if (paginatedProducts.length === 0) {
            productDisplayArea.html('<p class="col-span-full text-center text-gray-600 dark:text-gray-400">No products found.</p>');
            updatePagination(products.length, page);
            updateResultsCount(0, 0, products.length);
            return;
        }

        paginatedProducts.forEach(product => {
            const discountHtml = product.discountValue > 0 ? `<span class="absolute top-2 left-2 bg-red-500 text-white text-xs font-semibold px-2 py-1 rounded">${product.discountText || `${product.discountValue}% OFF`}</span>` : '';
            const productHtml = `
                <div class="product-card bg-primary-light dark:bg-secondary-dark rounded-lg shadow border border-border-light dark:border-border-dark p-4 relative flex ${currentLayout === 'list' ? 'flex-row' : 'flex-col'} gap-4">
                    ${discountHtml}
                    <div class="${currentLayout === 'list' ? 'w-1/3' : 'w-full'}">
                        <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-48 object-cover rounded-md border border-border-light dark:border-border-dark">
                    </div>
                    <div class="${currentLayout === 'list' ? 'w-2/3' : 'w-full'} flex flex-col justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-text-light dark:text-text-dark truncate">${product.name}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 truncate-3-lines">${product.description}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Category: ${product.category}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Brand: ${product.brand}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Material: ${product.material}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Condition: ${product.condition}</p>
                            <div class="flex items-center mt-2">
                                ${'<span class="text-yellow-500">★</span>'.repeat(product.rating)}${'<span class="text-gray-300 dark:text-gray-600">★</span>'.repeat(5 - product.rating)}
                            </div>
                        </div>
                        <div class="mt-3">
                            <p class="text-xl font-bold text-text-light dark:text-text-dark">$${product.price.toFixed(2)}</p>
                            <p class="text-sm ${product.inStock ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}">${product.inStock ? 'In Stock' : 'Out of Stock'}</p>
                            <div class="quick-view-btn-container flex space-x-2 mt-3">
                                <button class="quick-view-btn w-full bg-gray-700 hover:bg-gray-800 dark:bg-gray-300 dark:hover:bg-gray-400 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors" data-id="${product.id}">Quick View</button>
                                <button class="add-to-cart-btn w-full bg-gray-600 hover:bg-gray-700 dark:bg-gray-400 dark:hover:bg-gray-500 text-white dark:text-gray-900 font-semibold py-2 px-4 rounded-md text-sm transition-colors" data-id="${product.id}">${productsToCompare.includes(product.id) ? 'Remove from Compare' : 'Compare'}</button>
                            </div>
                        </div>
                    </div>
                </div>`;
            productDisplayArea.append(productHtml);
        });

        updatePagination(products.length, page);
        updateResultsCount(start + 1, Math.min(end, products.length), products.length);
        equalizeFilterHeights();
    }

    function updateResultsCount(start, end, total) {
        $('#resultsCountStart').text(start);
        $('#resultsCountEnd').text(end);
        $('#resultsTotalCount').text(total);
        const searchTerm = $('#productSearchInput').val() || 'All Parts';
        $('#searchTermDisplay').text(searchTerm);
    }

    function updatePagination(totalItems, currentPage) {
        const totalPages = Math.ceil(totalItems / itemsPerPage);
        let paginationHtml = '<ul class="flex space-x-2">';
        paginationHtml += `<li class="pagination-item ${currentPage === 1 ? 'disabled' : ''}"><a href="#" class="pagination-link px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 text-sm" data-page="${currentPage - 1}">Previous</a></li>`;

        for (let i = 1; i <= totalPages; i++) {
            paginationHtml += `<li class="pagination-item ${i === currentPage ? 'active' : ''}"><a href="#" class="pagination-link px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 text-sm" data-page="${i}">${i}</a></li>`;
        }

        paginationHtml += `<li class="pagination-item ${currentPage === totalPages ? 'disabled' : ''}"><a href="#" class="pagination-link px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 text-sm" data-page="${currentPage + 1}">Next</a></li>`;
        paginationHtml += '</ul>';
        $('#paginationControls').html(paginationHtml);

        $('.pagination-link').on('click', function(e) {
            e.preventDefault();
            const page = $(this).data('page');
            if (page && !$(this).parent().hasClass('disabled')) {
                currentPage = page;
                displayProducts(currentFilteredProducts, currentPage);
            }
        });
    }

    // Initial display
    displayProducts(currentFilteredProducts, currentPage);

    // --- Filter Products ---
    function filterProducts() {
        const searchQuery = $('#productSearchInput').val().toLowerCase();
        const selectedCategories = $('input[name="category"]:checked').map((_, el) => $(el).val()).get();
        const selectedBrands = $('input[name="brand"]:checked').map((_, el) => $(el).val()).get();
        const priceRange = $('#priceRangeSlider').slider('values');
        const distance = parseFloat($('#filterDistance').val()) || Infinity;
        const minRating = $('input[name="rating"]:checked').val() || 0;
        const inStock = $('#filterInStock').is(':checked');
        const selectedMaterials = $('input[name="material"]:checked').map((_, el) => $(el).val()).get();
        const condition = $('input[name="condition"]:checked').val();
        const discount = parseInt($('input[name="discount"]:checked').val()) || 0;
        const size = $('#filterSize').val().toLowerCase();
        const warranty = parseInt($('input[name="warranty"]:checked').val()) || 0;

        currentFilteredProducts = mockProducts.filter(product => {
            const matchesSearch = !searchQuery || product.name.toLowerCase().includes(searchQuery) || product.description.toLowerCase().includes(searchQuery) || product.category.toLowerCase().includes(searchQuery) || product.barcode.includes(searchQuery);
            const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(product.category);
            const matchesBrand = selectedBrands.length === 0 || selectedBrands.includes(product.brand);
            const matchesPrice = product.price >= priceRange[0] && product.price <= priceRange[1];
            const matchesDistance = product.distance <= distance;
            const matchesRating = product.rating >= minRating;
            const matchesStock = !inStock || product.inStock;
            const matchesMaterial = selectedMaterials.length === 0 || selectedMaterials.includes(product.material);
            const matchesCondition = !condition || product.condition === condition;
            const matchesDiscount = product.discountValue >= discount;
            const matchesSize = !size || product.size.toLowerCase().includes(size);
            const matchesWarranty = product.warranty >= warranty;

            return matchesSearch && matchesCategory && matchesBrand && matchesPrice && matchesDistance && matchesRating && matchesStock && matchesMaterial && matchesCondition && matchesDiscount && matchesSize && matchesWarranty;
        });

        currentPage = 1;
        displayProducts(currentFilteredProducts, currentPage);
        equalizeFilterHeights();
    }

    $('#applyFiltersBtn').on('click', filterProducts);
    $('#resetFiltersBtn').on('click', function() {
        $('#filterForm')[0].reset();
        $('#priceRangeSlider').slider('values', [0, 1000]);
        $('#priceRangeMin').text('$0');
        $('#priceRangeMax').text('$1000');
        $('#filterCategorySearch, #filterBrandSearch, #filterDistance, #filterSize').val('');
        filterProducts();
    });

    $('#productSearchInput').on('input', filterProducts);

    // --- Price Range Slider ---
    $('#priceRangeSlider').slider({
        range: true,
        min: 0,
        max: 1000,
        values: [0, 1000],
        slide: function(event, ui) {
            $('#priceRangeMin').text(`$${ui.values[0]}`);
            $('#priceRangeMax').text(`$${ui.values[1]}`);
        },
        stop: function() {
            filterProducts();
        }
    });

    // --- Rating Filter ---
    const ratingOptions = [5, 4, 3, 2, 1, 0];
    ratingOptions.forEach(rating => {
        const label = rating === 0 ? 'Any' : `${rating} Stars & Up`;
        $('#ratingFilterRadios').append(`
            <label class="flex items-center">
                <input type="radio" name="rating" value="${rating}" class="mr-2" ${rating === 0 ? 'checked' : ''}>
                ${rating > 0 ? '<span class="text-yellow-500">★</span>'.repeat(rating) + '<span class="text-gray-300 dark:text-gray-600">★</span>'.repeat(5 - rating) : label}
                ${rating > 0 ? '& Up' : ''}
            </label>
        `);
    });

    $('input[name="rating"]').on('change', filterProducts);

    // --- Category and Brand Search ---
    $('#filterCategorySearch').on('input', function() {
        const query = $(this).val().toLowerCase();
        $('#categoryFilterCheckboxes label').each(function() {
            const category = $(this).text().toLowerCase();
            $(this).toggle(category.includes(query));
        });
    });

    $('#filterBrandSearch').on('input', function() {
        const query = $(this).val().toLowerCase();
        $('#brandFilterCheckboxes label').each(function() {
            const brand = $(this).text().toLowerCase();
            $(this).toggle(brand.includes(query));
        });
    });

    // --- Layout Handling ---
    function setActiveLayoutButton(buttonId) {
        $('.layout-btn').removeClass('layout-btn-active');
        $(`#${buttonId}`).addClass('layout-btn-active');
    }

    function applyLayout(layout) {
        currentLayout = layout;
        let gridClass = 'grid-cols-1';
        if (layout === 'grid-2') {
            gridClass = 'grid-cols-1 sm:grid-cols-2';
        } else if (layout === 'grid-3') {
            gridClass = 'grid-cols-1 sm:grid-cols-2 md:grid-cols-3';
        } else if (layout === 'grid-4') {
            gridClass = 'grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4';
        } else if (layout === 'list') {
            gridClass = 'grid-cols-1';
        }

        productDisplayArea.removeClass('grid-cols-1 sm:grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4').addClass(gridClass);
        displayProducts(currentFilteredProducts, currentPage);
    }

    $('#layoutGrid2Btn').on('click', function() {
        applyLayout('grid-2');
        setActiveLayoutButton('layoutGrid2Btn');
    });

    $('#layoutGrid3Btn').on('click', function() {
        applyLayout('grid-3');
        setActiveLayoutButton('layoutGrid3Btn');
    });

    $('#layoutGrid4Btn').on('click', function() {
        applyLayout('grid-4');
        setActiveLayoutButton('layoutGrid4Btn');
    });

    $('#layoutListBtn').on('click', function() {
        applyLayout('list');
        setActiveLayoutButton('layoutListBtn');
    });

    $('#layoutCompareBtn').on('click', function() {
        comparisonViewArea.toggleClass('hidden', productsToCompare.length === 0);
        productDisplayArea.toggleClass('hidden', productsToCompare.length > 0);
        displayComparison();
        setActiveLayoutButton('layoutCompareBtn');
    });

    // --- Comparison View ---
    function displayComparison() {
        comparisonItemsContainer.empty();
        comparisonTableContainer.empty();
        if (productsToCompare.length === 0) {
            comparisonItemsContainer.html('<p class="text-text-light dark:text-text-dark col-span-full text-center">Select up to 3 products to compare.</p>');
            return;
        }

        productsToCompare.forEach(productId => {
            const product = mockProducts.find(p => p.id === productId);
            if (product) {
                const comparisonHtml = `
                    <div class="bg-primary-light dark:bg-secondary-dark rounded-lg shadow border border-border-light dark:border-border-dark p-4">
                        <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-32 object-cover rounded-md mb-3 border border-border-light dark:border-border-dark">
                        <h4 class="text-md font-semibold text-text-light dark:text-text-dark truncate">${product.name}</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Price: $${product.price.toFixed(2)}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Category: ${product.category}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Brand: ${product.brand}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Material: ${product.material}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Condition: ${product.condition}</p>
                        <p class="text-sm ${product.inStock ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}">${product.inStock ? 'In Stock' : 'Out of Stock'}</p>
                        <div class="flex items-center mt-2">
                            ${'<span class="text-yellow-500">★</span>'.repeat(product.rating)}${'<span class="text-gray-300 dark:text-gray-600">★</span>'.repeat(5 - product.rating)}
                        </div>
                        <button class="remove-compare-btn w-full mt-3 bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-md text-sm transition-colors" data-id="${product.id}">Remove</button>
                    </div>`;
                comparisonItemsContainer.append(comparisonHtml);
            }
        });

        // Comparison Table
        if (productsToCompare.length > 1) {
            const compareProducts = productsToCompare.map(id => mockProducts.find(p => p.id === id));
            const attributes = ['name', 'price', 'category', 'brand', 'material', 'condition', 'inStock', 'rating', 'discountValue', 'distance', 'warranty', 'size'];
            let tableHtml = '<h4 class="text-lg font-semibold mb-2 text-text-light dark:text-text-dark">Comparison Table</h4><table class="comparison-table"><thead><tr><th>Attribute</th>';
            compareProducts.forEach(product => {
                tableHtml += `<th>${product.name}</th>`;
            });
            tableHtml += '</tr></thead><tbody>';

            attributes.forEach(attr => {
                tableHtml += `<tr><td class="font-medium">${attr.charAt(0).toUpperCase() + attr.slice(1)}</td>`;
                const values = compareProducts.map(product => {
                    if (attr === 'price') return `$${product[attr].toFixed(2)}`;
                    if (attr === 'inStock') return product[attr] ? 'In Stock' : 'Out of Stock';
                    if (attr === 'rating') return `${product[attr]} Stars`;
                    if (attr === 'discountValue') return product[attr] > 0 ? `${product[attr]}%` : 'None';
                    if (attr === 'distance') return `${product[attr]} km`;
                    if (attr === 'warranty') return `${product[attr]} months`;
                    return product[attr];
                });
                const allSame = values.every((val, i, arr) => val === arr[0]);
                values.forEach(val => {
                    tableHtml += `<td class="${allSame ? '' : 'highlight-diff'}">${val}</td>`;
                });
                tableHtml += '</tr>';
            });

            tableHtml += '</tbody></table>';
            comparisonTableContainer.html(tableHtml);
        }

        $('.remove-compare-btn').on('click', function() {
            const productId = parseInt($(this).data('id'));
            productsToCompare = productsToCompare.filter(id => id !== productId);
            displayComparison();
            if (productsToCompare.length === 0) {
                comparisonViewArea.addClass('hidden');
                productDisplayArea.removeClass('hidden');
                applyLayout(currentLayout);
            }
        });
    }

    productDisplayArea.on('click', '.add-to-cart-btn', function() {
        const productId = parseInt($(this).data('id'));
        if (productsToCompare.includes(productId)) {
            productsToCompare = productsToCompare.filter(id => id !== productId);
            $(this).text('Compare');
        } else if (productsToCompare.length < 3) {
            productsToCompare.push(productId);
            $(this).text('Remove from Compare');
        } else {
            alert('You can compare up to 3 products.');
        }
        displayComparison();
    });

    // --- Quick View ---
    productDisplayArea.on('click', '.quick-view-btn', function() {
        const productId = $(this).data('id');
        const product = mockProducts.find(p => p.id === productId);
        if (product) {
            $('#quickViewProductName').text(product.name);
            $('#quickViewProductImage').attr('src', product.imageUrl).attr('alt', product.name);
            $('#quickViewProductDescription').text(product.description);
            $('#quickViewProductPrice').text(`$${product.price.toFixed(2)}`);
            $('#quickViewProductAvailability').text(product.inStock ? 'In Stock' : 'Out of Stock').removeClass('text-green-600 dark:text-green-400 text-red-600 dark:text-red-400').addClass(product.inStock ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400');
            $('#quickViewProductLink').data('id', product.id); // Store product ID for details modal
            $('#quickViewModal').show();
        }
    });

    $('#closeQuickViewModal').on('click', function() {
        $('#quickViewModal').hide();
    });

    $('.add-to-cart-quickview').on('click', function() {
        const productId = $('.quick-view-btn').data('id');
        alert(`Added product ID ${productId} to cart.`);
    });

    // --- Product Details ---
    $('#quickViewProductLink').on('click', function(e) {
        e.preventDefault();
        const productId = $(this).data('id');
        const product = mockProducts.find(p => p.id === productId);
        if (product) {
            $('#productDetailsName').text(product.name);
            $('#productDetailsImage').attr('src', product.imageUrl).attr('alt', product.name);
            $('#productDetailsDescription').text(product.description);
            $('#productDetailsPrice').text(`$${product.price.toFixed(2)}`);
            $('#productDetailsAvailability').text(product.inStock ? 'In Stock' : 'Out of Stock').removeClass('text-green-600 dark:text-green-400 text-red-600 dark:text-red-400').addClass(product.inStock ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400');
            $('#productDetailsCategory').text(product.category);
            $('#productDetailsBrand').text(product.brand);
            $('#productDetailsMaterial').text(product.material);
            $('#productDetailsCondition').text(product.condition);
            $('#productDetailsRating').html(`${'<span class="text-yellow-500">★</span>'.repeat(product.rating)}${'<span class="text-gray-300 dark:text-gray-600">★</span>'.repeat(5 - product.rating)}`);
            $('#productDetailsDiscount').text(product.discountValue > 0 ? `${product.discountValue}%` : 'None');
            $('#productDetailsDistance').text(`${product.distance} km`);
            $('#productDetailsWarranty').text(`${product.warranty} months`);
            $('#productDetailsSize').text(product.size);
            $('.add-to-cart-details').data('id', product.id);
            $('#quickViewModal').hide();
            $('#productDetailsModal').show();
        }
    });

    $('#closeProductDetailsModal').on('click', function() {
        $('#productDetailsModal').hide();
    });

    $('.add-to-cart-details').on('click', function() {
        const productId = $(this).data('id');
        alert(`Added product ID ${productId} to cart.`);
    });

    // --- Barcode/QR Code Scanning ---
    function startBarcodeScan() {
        html5QrCode = new Html5Qrcode("qrCodeScanner");
        const config = { fps: 10, qrbox: { width: 250, height: 250 } };

        html5QrCode.start(
            { facingMode: "environment" },
            config,
            (decodedText) => {
                $('#scannedCode').text(decodedText);
                $('#qrCodePreview').attr('src', '').addClass('hidden');
                $('#qrCodePreviewPlaceholder').show();
                html5QrCode.stop();
                $('#startBarcodeScanBtn').show();
            },
            (error) => {
                console.warn('QR Code scan error:', error);
            }
        ).catch(err => {
            console.error('QR Code scanner initialization failed:', err);
            $('#scannedCode').text('Camera access denied.');
            $('#barcodeSearchModal').hide();
        });
    }

    $('#barcodeSearchBtn').on('click', function() {
        if (enabledSearchOptions.includes('barcode')) {
            $('#barcodeSearchModal').show();
            $('#scannedCode').text('---');
            $('#qrCodePreview').addClass('hidden');
            $('#qrCodePreviewPlaceholder').show();
            $('#startBarcodeScanBtn').show();
        }
    });

    $('#startBarcodeScanBtn').on('click', function() {
        $(this).hide();
        startBarcodeScan();
    });

    $('#qrCodeUploadInput').on('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                $('#qrCodePreview').attr('src', e.target.result).removeClass('hidden');
                $('#qrCodePreviewPlaceholder').hide();
                html5QrCode.scanFile(file, true)
                    .then(decodedText => {
                        $('#scannedCode').text(decodedText);
                    })
                    .catch(err => {
                        $('#scannedCode').text('Unable to decode QR code.');
                    });
            };
            reader.readAsDataURL(file);
        }
    });

    $('#executeBarcodeSearchBtn').on('click', function() {
        const code = $('#scannedCode').text();
        if (code && code !== '---') {
            $('#productSearchInput').val(code);
            filterProducts();
            $('#barcodeSearchModal').hide();
            if (html5QrCode) {
                html5QrCode.stop();
                html5QrCode = null;
            }
        }
    });

    $('#closeBarcodeModal').on('click', function() {
        if (html5QrCode) {
            html5QrCode.stop();
            html5QrCode = null;
        }
        $('#barcodeSearchModal').hide();
    });

    // --- Image Search ---
    function startCamera() {
        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
            .then(function(s) {
                stream = s;
                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();
                $('#cameraFeed').html(video);
            })
            .catch(function(err) {
                console.error('Camera access denied:', err);
                $('#imagePreviewPlaceholder').text('Camera access denied.');
                $('#imageSearchModal').hide();
            });
    }

    $('#imageSearchBtn').on('click', function() {
        if (enabledSearchOptions.includes('image')) {
            $('#imageSearchModal').show();
            $('#imagePreview').addClass('hidden');
            $('#imagePreviewPlaceholder').show().text('Image preview will appear here');
            startCamera();
        }
    });

    $('#captureImageBtn').on('click', function() {
        const video = $('#cameraFeed video')[0];
        if (video) {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            const imageData = canvas.toDataURL('image/jpeg');
            $('#imagePreview').attr('src', imageData).removeClass('hidden');
            $('#imagePreviewPlaceholder').hide();
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                $('#cameraFeed').empty();
            }
        }
    });

    $('#imageUploadInput').on('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                $('#imagePreview').attr('src', e.target.result).removeClass('hidden');
                $('#imagePreviewPlaceholder').hide();
            };
            reader.readAsDataURL(file);
        }
    });

    $('#executeImageSearchBtn').on('click', function() {
        const imageSrc = $('#imagePreview').attr('src');
        if (imageSrc) {
            alert('Image search is not implemented. This would typically involve an API call to an image recognition service.');
            $('#imageSearchModal').hide();
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            $('#cameraFeed').empty();
        }
    });

    $('#closeImageSearchModal').on('click', function() {
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
            stream = null;
        }
        $('#imageSearchModal').hide();
        $('#cameraFeed').empty();
    });

    // --- Video Search ---
    function startVideoRecording() {
        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
            .then(function(s) {
                stream = s;
                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();
                $('#videoFeed').html(video);
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = function(e) {
                    recordedChunks.push(e.data);
                };
                mediaRecorder.onstop = function() {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    $('#videoPreview').attr('src', url).removeClass('hidden');
                    $('#videoPreviewPlaceholder').hide();
                    recordedChunks = [];
                };
                mediaRecorder.start();
                $('#startVideoRecordBtn').prop('disabled', true);
                $('#stopVideoRecordBtn').prop('disabled', false);
                $('#executeVideoSearchBtn').prop('disabled', true);
            })
            .catch(function(err) {
                console.error('Camera/Microphone access denied:', err);
                $('#videoPreviewPlaceholder').text('Camera/Microphone access denied.');
                $('#videoSearchModal').hide();
            });
    }

    $('#videoSearchBtn').on('click', function() {
        if (enabledSearchOptions.includes('video')) {
            $('#videoSearchModal').show();
            $('#videoPreview').addClass('hidden');
            $('#videoPreviewPlaceholder').show().text('Video preview will appear here');
            $('#startVideoRecordBtn').prop('disabled', false);
            $('#stopVideoRecordBtn').prop('disabled', true);
            $('#executeVideoSearchBtn').prop('disabled', true);
        }
    });

    $('#startVideoRecordBtn').on('click', startVideoRecording);

    $('#stopVideoRecordBtn').on('click', function() {
        if (mediaRecorder) {
            mediaRecorder.stop();
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            $('#videoFeed').empty();
            $('#startVideoRecordBtn').prop('disabled', false);
            $('#stopVideoRecordBtn').prop('disabled', true);
            $('#executeVideoSearchBtn').prop('disabled', false);
        }
    });

    $('#executeVideoSearchBtn').on('click', function() {
        const videoSrc = $('#videoPreview').attr('src');
        if (videoSrc) {
            alert('Video search is not implemented. This would typically involve an API call to a video analysis service.');
            $('#videoSearchModal').hide();
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            $('#videoFeed').empty();
        }
    });

    $('#closeVideoSearchModal').on('click', function() {
        if (mediaRecorder && mediaRecorder.state !== 'inactive') {
            mediaRecorder.stop();
        }
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
            stream = null;
        }
        $('#videoFeed').empty();
        $('#videoSearchModal').hide();
    });

    // --- Customize Search ---
    $('#customizeSearchBtn').on('click', function() {
        $('#customizeSearchModal').show();
    });

    $('#closeCustomizeSearchModal').on('click', function() {
        $('#customizeSearchModal').hide();
    });

    $('#sortableSearchOptions').sortable({
        update: function() {
            searchOptionsOrder = $(this).sortable('toArray', { attribute: 'data-option' });
        }
    });

    $('#sortableFilterOptions').sortable({
        update: function() {
            filterOptionsOrder = $(this).sortable('toArray', { attribute: 'data-filter' });
            updateFilterOrder();
        }
    });

    $('.search-option-toggle').on('change', function() {
        const option = $(this).data('option');
        if ($(this).is(':checked')) {
            enabledSearchOptions.push(option);
            $(`#${option}SearchBtn`).show();
        } else {
            enabledSearchOptions = enabledSearchOptions.filter(opt => opt !== option);
            $(`#${option}SearchBtn`).hide();
        }
    });

    $('.filter-option-toggle').on('change', function() {
        const filter = $(this).data('filter');
        if ($(this).is(':checked')) {
            enabledFilters.push(filter);
            $(`#${filter}FilterSection`).show();
        } else {
            enabledFilters = enabledFilters.filter(f => f !== filter);
            $(`#${filter}FilterSection`).hide();
        }
    });

    function updateFilterOrder() {
        filterOptionsOrder.forEach(filter => {
            if (enabledFilters.includes(filter)) {
                $(`#${filter}FilterSection`).appendTo('#filterForm');
            }
        });
        equalizeFilterHeights();
    }

    $('#addNewFilterBtn').on('click', function() {
        const filterName = $('#newFilterName').val().trim();
        const filterType = $('#newFilterType').val();
        const filterOptions = $('#newFilterOptions').val().trim().split('\n').filter(opt => opt.trim() !== '');

        if (!filterName) {
            alert('Please enter a filter name.');
            return;
        }

        const filterId = filterName.toLowerCase().replace(/\s+/g, '-');
        if (enabledFilters.includes(filterId) || customFilters[filterId]) {
            alert('Filter already exists.');
            return;
        }

        customFilters[filterId] = { name: filterName, type: filterType, options: filterOptions };
        enabledFilters.push(filterId);
        filterOptionsOrder.push(filterId);

        let filterHtml = `<div class="filter-section" id="${filterId}FilterSection"><h4 class="filter-title text-text-light dark:text-text-dark">${filterName}</h4>`;
        if (filterType === 'text') {
            filterHtml += `<input type="text" id="filter${filterId}" name="${filterId}" placeholder="Enter ${filterName}" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-primary-light dark:bg-gray-700 text-text-light dark:text-text-dark text-sm focus:outline-none focus:ring-1">`;
        } else if (filterType === 'checkbox') {
            filterHtml += `<div class="space-y-1 text-sm">`;
            filterOptions.forEach(option => {
                filterHtml += `<label class="flex items-center"><input type="checkbox" name="${filterId}" value="${option}" class="mr-2 rounded"> ${option}</label>`;
            });
            filterHtml += `</div>`;
        } else if (filterType === 'radio') {
            filterHtml += `<div class="space-y-1 text-sm"><label class="flex items-center"><input type="radio" name="${filterId}" value="" class="mr-2" checked> Any</label>`;
            filterOptions.forEach(option => {
                filterHtml += `<label class="flex items-center"><input type="radio" name="${filterId}" value="${option}" class="mr-2"> ${option}</label>`;
            });
            filterHtml += `</div>`;
        }
        filterHtml += `</div>`;

        $('#filterForm').append(filterHtml);
        $('#sortableFilterOptions').append(`
            <div class="sortable-item flex items-center justify-between" data-filter="${filterId}">
                <span>${filterName}</span>
                <input type="checkbox" class="filter-option-toggle mr-2 rounded" data-filter="${filterId}" checked>
            </div>
        `);

        $(`input[name="${filterId}"]`).on('change', filterProducts);
        $('#newFilterName, #newFilterOptions').val('');
        updateFilterOrder();
    });

    $('#applyCustomizationBtn').on('click', function() {
        updateFilterOrder();
        $('#customizeSearchModal').hide();
    });

    // --- Category Navigation ---
    $('.nav-category-link').on('click', function(e) {
        e.preventDefault();
        $('.nav-category-link').removeClass('active');
        $(this).addClass('active');
        const category = $(this).data('category');
        $('#filterCategorySearch').val(category);
        $('#categoryFilterCheckboxes input').prop('checked', false);
        if (category) {
            $(`#categoryFilterCheckboxes input[value="${category}"]`).prop('checked', true);
        }
        filterProducts();
    });

    // --- Suggestions ---
    $('#productSearchInput').on('input', function() {
        const query = $(this).val().toLowerCase();
        if (query.length < 2) {
            $('#suggestions').hide().empty();
            return;
        }

        const suggestions = mockProducts
            .filter(p => p.name.toLowerCase().includes(query) || p.category.toLowerCase().includes(query) || p.description.toLowerCase().includes(query))
            .slice(0, 5)
            .map(p => `<div class="suggestion-item px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer text-sm" data-query="${p.name}">${p.name} (${p.category})</div>`);

        if (suggestions.length > 0) {
            $('#suggestions').html(suggestions.join('')).show();
        } else {
            $('#suggestions').hide().empty();
        }
    });

    $(document).on('click', '.suggestion-item', function() {
        $('#productSearchInput').val($(this).data('query'));
        $('#suggestions').hide().empty();
        filterProducts();
    });

    $(document).on('click', function(e) {
        if (!$(e.target).closest('#productSearchInput, #suggestions').length) {
            $('#suggestions').hide();
        }
    });

    // --- Current Year ---
    $('#currentYear').text(new Date().getFullYear());
});
</script>
</body>
</html>