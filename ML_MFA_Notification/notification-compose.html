<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notification Center</title>
  <!-- Global Functions -->
  <script>
    // Global cancel function that will work regardless of other script loading
    function cancelForm() {
      console.log("Cancel button clicked - navigating to incoming notifications");

      // Get elements
      const composeForm = document.getElementById('composeForm');
      const notificationsView = document.getElementById('notificationsView');
      const notificationList = document.getElementById('notificationList');
      const emptyNotificationsState = document.getElementById('emptyNotificationsState');

      // Hide compose form and show notifications view
      if (composeForm) {
        composeForm.classList.remove('active');
        composeForm.classList.add('hidden');
      }

      // Show notifications view
      if (notificationsView) {
        notificationsView.classList.remove('hidden');
      }

      // Show notification list
      if (notificationList) {
        notificationList.style.display = 'block';
      }

      // Show empty state if needed
      if (notificationList && emptyNotificationsState) {
        if (notificationList.children.length === 0) {
          emptyNotificationsState.style.display = 'flex';
        } else {
          emptyNotificationsState.style.display = 'none';
        }
      }

      // Reset form fields
      const titleInput = document.getElementById('notificationTitle');
      if (titleInput) titleInput.value = '';

      const typeSelect = document.getElementById('notificationType');
      if (typeSelect) typeSelect.value = '';

      // Reset to page 1 for next time
      const page1 = document.getElementById('page1');
      const page2 = document.getElementById('page2');
      if (page1 && page2) {
        page1.classList.add('active');
        page2.classList.remove('active');
      }

      // Reset page indicators
      const page1Indicator = document.getElementById('page1Indicator');
      const page2Indicator = document.getElementById('page2Indicator');
      if (page1Indicator && page2Indicator) {
        page1Indicator.classList.add('active');
        page1Indicator.classList.remove('completed');
        page2Indicator.classList.remove('active', 'completed');
      }

      // Make sure the trash container is hidden
      const trashContainer = document.getElementById('trashContainer');
      if (trashContainer) {
        trashContainer.style.display = 'none';
      }

      // Reset any active filter buttons
      const filterButtons = document.querySelectorAll('.filter-button');
      if (filterButtons.length > 0) {
        filterButtons.forEach(btn => {
          if (btn.getAttribute('data-filter') === 'all') {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });
      }

      console.log('Successfully navigated to incoming notifications page');
      return false; // Prevent default button behavior
    }

    // Add event listeners to all cancel buttons when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Find all cancel buttons
      const cancelButtons = document.querySelectorAll('.cancel-button');

      // Add click event listener to each cancel button
      cancelButtons.forEach(function(button) {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('Cancel button clicked via event listener');
          return cancelForm();
        });
      });

      console.log('Cancel button event listeners initialized');
    });
  </script>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Notification Alert Styles -->
  <link rel="stylesheet" href="notification-alert.css">
  <!-- Recipient Selection Styles -->
  <link rel="stylesheet" href="recipient-selection.css">
  <!-- Language Selection Styles -->
  <link rel="stylesheet" href="language-selection.css">
  <!-- Translation Request Styles -->
  <link rel="stylesheet" href="translation-request.css">
  <!-- Send/Schedule Styles -->
  <link rel="stylesheet" href="send-schedule.css">
  <!-- Preferences Styles -->
  <link rel="stylesheet" href="preferences.css">
  <!-- Notification Banner Styles -->
  <link rel="stylesheet" href="notification-banner.css">
  <!-- Theme Styles -->
  <link rel="stylesheet" href="themes.css">
  <!-- Quill.js Rich Text Editor -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <style>
    :root {
      /* Black and Cement Theme Colors */
      --color-black: #000000;
      --color-dark-gray: #121212;
      --color-cement: #ccc5b9;
      --color-light-cement: #e6e2dd;
      --color-lighter-cement: #f5f3f0;
      --color-white: #ffffff;
      --color-accent: #333333;
      --color-accent-hover: #444444;

      /* Text Colors */
      --color-text-primary: #ffffff;
      --color-text-secondary: #e6e2dd;
      --color-text-tertiary: #ccc5b9;

      /* Border and UI Colors */
      --color-border: #333333;
      --color-success: #4caf50;
      --color-warning: #ff9800;
      --color-error: #f44336;
      --color-info: #2196f3;

      /* Shadows */
      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.5);

      /* Border Radius */
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: #000;
      color: #fff;
      background-image: url('https://images.pexels.com/photos/3807319/pexels-photo-3807319.jpeg?auto=compress&cs=tinysrgb&w=1600');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      position: relative;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.65);
      z-index: -1;
    }

    .button-group {
      position: relative;
    }


    /*body {
      font-family: 'Inter', sans-serif;
      background-color: var(--color-cement);
      color: var(--color-black);
    }*/

    .notification-container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background-color: var(--color-black);
      color: var(--color-white);
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: flex-end; /* Changed to push content to the right */
      align-items: center;
      border-bottom: 2px solid var(--color-black);
      box-shadow: var(--shadow-md);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .back-button {
      background: none;
      border: none;
      color: var(--color-cement);
      cursor: pointer;
      display: flex;
      align-items: center;
      font-size: 0.875rem;
      transition: all 0.2s;
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius-sm);
    }

    .back-button:hover {
      color: var(--color-light-cement);
      background-color: rgba(204, 197, 185, 0.1);
    }

    .back-button .material-icons {
      margin-right: 0.5rem;
    }

    .create-button {
      background-color:#fff;
      color: #000;
      border: 1px solid #000;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-sm);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      box-shadow: var(--shadow-sm);
    }

    /* Removed hover effect for create-button */

    .header-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .notification-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background-color: var(--color-white);
      color: var(--color-black);
      border: 1px solid var(--color-black);
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .notification-button:hover {
      background-color: var(--color-light-cement);
    }

    .notification-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background-color: #f44336;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    .notification-badge:empty {
      display: none;
    }

    .notification-test-buttons {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
    }

    .notification-trigger {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--color-black);
      color: var(--color-white);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: var(--shadow-md);
      transition: all 0.2s;
    }

    .notification-trigger:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-lg);
    }

    .notification-trigger.ai-recommendation {
      background-color: #4285F4; /* Google blue color */
    }

    /* Right Center Arrow */
    .right-center-arrow {
      position: fixed;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      background-color: var(--color-black);
      color: var(--color-white);
      border-radius: 50% 0 0 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: var(--shadow-md);
      z-index: 900;
      transition: all 0.2s;
    }

    /* Translation Management Styles */
    .translation-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .translation-table th {
      background-color: #f0f0f0;
      padding: 10px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #ddd;
      color:#000;
    }

    .translation-table td {
      color:#000;
      padding: 12px 10px;
      border-bottom: 1px solid #ddd;
    }

    .translation-row:hover {
      background-color: #f9f9f9;
    }

    .translation-status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .translation-status.pending {
      background-color: #FFF3CD;
      color: #856404;
    }

    .translation-status.requested {
      background-color: #CCE5FF;
      color: #004085;
    }

    .translation-status.approved {
      background-color: #D4EDDA;
      color: #155724;
    }

    .translation-action-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: #555;
      margin-right: 5px;
    }

    .translation-action-btn:hover {
      color: #000;
    }

    .translation-request-btn, .translation-approve-btn {
      padding: 8px 16px;
      border-radius: 4px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .translation-request-btn {
      background-color: #000;
      color: #fff;
      border: none;
    }

    .translation-request-btn:hover {
      background-color: #333;
    }

    .translation-approve-btn {
      background-color: #4CAF50;
      color: #fff;
      border: none;
    }

    .translation-approve-btn:hover {
      background-color: #45a049;
    }

    .translation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .translation-actions {
      display: flex;
      gap: 10px;
    }

    .right-center-arrow:hover {
      width: 50px;
      box-shadow: var(--shadow-lg);
    }

    .right-center-arrow .material-icons {
      font-size: 24px;
    }

    /* Main Content Layout */
    .main-content {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    /* View Selector Styles */
    .view-selector {
      display: flex;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid var(--color-black);
    }

    .view-tab {
      padding: 1rem 1.5rem;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      font-size: 1rem;
      font-weight: 600;
      color: var(--color-text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: relative;
      transition: all 0.2s;
    }

    .view-tab.active {
      color: var(--color-black);
      border-bottom-color: var(--color-black);
    }

    .view-tab:hover:not(.active) {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .tab-badge {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background-color: #f44336;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .tab-badge:empty {
      display: none;
    }

    /* Notifications View Styles */
    .notifications-view {
      width: 100%;
      display: flex;
      flex-direction: column;
      background-color: var(--color-white);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .notifications-view.hidden {
      display: none;
    }

    .notifications-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .notifications-actions {
      display: flex;
      gap: 1rem;
    }

    .action-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      color:#000;
      background-color: var(--color-white);
      border: 1px solid var(--color-black);
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }


    .notifications-filters {
      display: flex;
      padding: 0.75rem 1.5rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      background-color: var(--color-light-cement);
      overflow-x: auto;
      gap: 0.75rem;
    }

    .filter-button {
      padding: 0.5rem 1rem;
      color: #000;

      border: 1px solid var(--color-black);
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .filter-button.active {
      background-color: var(--color-black);
      color: var(--color-white);
    }

    .notifications-list-container {
      padding: 1.5rem;
      min-height: 400px;
      max-height: 600px;
      overflow-y: auto;
    }

    .notification-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .notification-item {
      padding: 1rem;
      background-color: var(--color-white);
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: var(--radius-sm);
      transition: all 0.2s;
      position: relative;
    }

    .notification-item:hover {
      box-shadow: var(--shadow-sm);
    }

    .notification-item.unread {
      border-left: 3px solid var(--color-black);
      background-color: rgba(0, 0, 0, 0.02);
    }

    .notification-item.priority-high {
      border-left: 3px solid #f44336;
    }

    .notification-item.priority-normal {
      border-left: 3px solid #2196f3;
    }

    .notification-item.priority-low {
      border-left: 3px solid #4caf50;
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }

    .notification-title {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
      color: var(--color-black);
    }

    .notification-time {
      font-size: 0.75rem;
      color: var(--color-text-secondary);
    }

    .notification-content {
      margin-bottom: 0.75rem;
      font-size: 0.875rem;
      line-height: 1.4;
    }

    .notification-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .notification-meta {
      display: flex;
      gap: 0.5rem;
    }

    .notification-tag {
      display: inline-block;
      padding: 0.125rem 0.375rem;
      background-color: var(--color-black);
      color: var(--color-white);
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 500;
    }

    /* Message type color coding */
    .notification-tag.type-important {
      background-color: rgba(244, 67, 54, 0.1);
      color: #d32f2f;
      border: 1px solid rgba(244, 67, 54, 0.3);
    }

    .notification-tag.type-scheduled {
      background-color: rgba(255, 152, 0, 0.1);
      color: #e65100;
      border: 1px solid rgba(255, 152, 0, 0.3);
    }

    .notification-tag.type-approval {
      background-color: rgba(156, 39, 176, 0.1);
      color: #7b1fa2;
      border: 1px solid rgba(156, 39, 176, 0.3);
    }

    .notification-tag.type-meeting {
      background-color: rgba(0, 150, 136, 0.1);
      color: #00796b;
      border: 1px solid rgba(0, 150, 136, 0.3);
    }

    .notification-tag.type-alert {
      background-color: rgba(255, 87, 34, 0.1);
      color: #d84315;
      border: 1px solid rgba(255, 87, 34, 0.3);
    }

    .notification-tag.type-info {
      background-color: rgba(33, 150, 243, 0.1);
      color: #1976d2;
      border: 1px solid rgba(33, 150, 243, 0.3);
    }

    .notification-tag.type-ai {
      background-color: rgba(121, 85, 72, 0.1);
      color: #5d4037;
      border: 1px solid rgba(121, 85, 72, 0.3);
    }

    .notification-tag.type-emergency {
      background-color: rgba(183, 28, 28, 0.1);
      color: #b71c1c;
      border: 1px solid rgba(183, 28, 28, 0.3);
    }

    .notification-actions {
      display: flex;
      gap: 0.25rem;
    }

    .notification-action {
      background: none;
      border: none;
      color: var(--color-black);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.25rem;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .notification-action:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .unread-indicator {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #2196f3;
    }

    .empty-notifications-state, .empty-trash-state {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 150px;
      width: 100%;
    }

    /* Trash Styles */
    .trash-container {
      width: 100%;
    }

    .trash-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--color-black);
    }

    .trash-header h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0;
      color: var(--color-black);
    }

    .empty-trash-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background-color: #f44336;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .empty-trash-btn:hover {
      background-color: #d32f2f;
    }

    .trash-list {
      margin-bottom: 1.5rem;
    }

    .notification-card.trash-item {
      opacity: 0.8;
      background-color: var(--color-cement);
    }

    .notification-card.trash-item::before {
      background-color: #f44336;
    }

    .trash-item-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }

    .restore-btn, .delete-permanently-btn {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .restore-btn {
      background-color: var(--color-black);
      color: white;
      border: none;
    }

    .restore-btn:hover {
      background-color: rgba(0, 0, 0, 0.8);
    }

    .delete-permanently-btn {
      background-color: #f44336;
      color: white;
      border: none;
    }

    .delete-permanently-btn:hover {
      background-color: #d32f2f;
    }

    .empty-state-content {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 1rem;
    }

    .empty-state-icon {
      font-size: 1.75rem;
      margin-right: 1rem;
      color: #666;
      background-color: #e0e0e0;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .empty-state-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0 0 0.25rem 0;
      color: var(--color-text-primary);
    }

    .empty-state-message {
      margin: 0;
      font-size: 0.8125rem;
      color: var(--color-text-secondary);
    }

    .empty-state-text {
      text-align: left;
    }

    /* Notifications disabled message */
    .notifications-disabled-message {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 3rem 1rem;
      background-color: var(--color-lighter-cement);
      border-radius: var(--radius-md);
      margin: 1rem 0;
    }

    .notifications-disabled-message .material-icons {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: #999;
      background-color: #e0e0e0;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .notifications-disabled-message h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0 0 0.5rem 0;
      color: var(--color-text-primary);
    }

    .notifications-disabled-message p {
      margin: 0 0 1.5rem 0;
      font-size: 0.875rem;
      color: var(--color-text-secondary);
    }

    .create-button .material-icons {
      color: #000;
      margin-right: 0.5rem;
    }

    .notification-list {
      margin-top: 2rem;
    }

    .notification-card {
      background-color: var(--color-light-cement);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      border: 1px solid var(--color-black);
      position: relative;
      overflow: hidden;
    }

    .notification-actions {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      display: flex;
      gap: 0.5rem;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .notification-card:hover .notification-actions {
      opacity: 1;
    }

    .notification-action-btn {
      background-color: var(--color-black);
      color: white;
      border: none;
      width: 2.25rem;
      height: 2.25rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
    }

    .notification-action-btn:hover {
      transform: scale(1.1);
    }

    .notification-action-btn.delete-btn:hover {
      background-color: #f44336;
    }

    .notification-action-btn.mark-read-btn:hover {
      background-color: #4caf50;
    }

    /* Unread indicator styles */
    .unread-indicator {
      position: absolute;
      top: 1rem;
      left: 0.5rem;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #2196f3;
      display: none;
    }

    .notification-card.unread .unread-indicator {
      display: block;
    }

    .notification-card.unread {
      border-left: 4px solid #2196f3;
    }

    .notification-card.unread::before {
      background-color: #2196f3;
    }

    .notification-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      border-color: var(--color-black);
    }

    .notification-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background-color: var(--color-black);
    }

    .notification-title {
      font-weight: 600;
      font-size: 1.125rem;
      margin-bottom: 0.75rem;
      color: var(--color-black);
    }

    .notification-meta {
      display: flex;
      justify-content: space-between;
      color: rgba(0, 0, 0, 0.6);
      font-size: 0.875rem;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--color-black);
    }

    .notification-content {
      color: var(--color-black);
      margin-bottom: 1.25rem;
      line-height: 1.6;
    }

    .notification-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: rgba(0, 0, 0, 0.7);
      font-size: 0.875rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--color-black);
    }

    .notification-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .notification-tag {
      background-color: var(--color-black);
      color: var(--color-white);
      padding: 0.375rem 0.75rem;
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.025em;
      box-shadow: var(--shadow-sm);
      display: inline-flex;
      align-items: center;
    }

    .notification-tag.important {
      background-color: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }

    .notification-tag.action {
      background-color: rgba(33, 150, 243, 0.2);
      color: #2196f3;
    }

    .notification-tag.language {
      background-color: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }

    .compose-form {
      background-color: var(--color-light-cement);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      padding: 2rem;
      margin-top: 2rem;
      display: none;
      border: 1px solid var(--color-black);
      position: relative;
    }

    .compose-form.active {
      display: block;
    }

    .compose-form::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 4px;
      width: 100%;
      background-color: var(--color-black);
    }

    .compose-header {
      display: flex;
      align-items: center;
      margin-bottom: 1.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--color-black);
    }

    .form-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--color-black);
      margin: 0;
      display: flex;
      align-items: center;
    }

    .form-title::before {
      content: '';
      display: inline-block;
      width: 18px;
      height: 18px;
      background-color: var(--color-black);
      margin-right: 10px;
      border-radius: 50%;
    }

    .form-group {
      margin-bottom: 1.75rem;
    }

    .form-label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--color-black);
      letter-spacing: 0.025em;
    }

    .form-input {
      width: 100%;
      padding: 0.875rem 1rem;
      background-color: var(--color-lighter-cement);
      border: 1px solid var(--color-black);
      border-radius: var(--radius-sm);
      font-size: 1rem;
      color: var(--color-black);
      transition: all 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--color-black);
      box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.2);
    }



    .form-input::placeholder {
      color: rgba(0, 0, 0, 0.5);
    }

    /* Notification content fields */
    .notification-content-fields {
      background-color: var(--color-white);
      border: 1px solid var(--color-black);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .content-field-group {
      margin-bottom: 1.25rem;
    }

    .content-field-group:last-child {
      margin-bottom: 0;
    }

    .sub-label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--color-black);
      font-size: 0.875rem;
    }

    textarea.form-input {
      resize: vertical;
      min-height: 100px;
    }

    /* Rich Text Editor Styles */
    .rich-text-editor-container {
      border: 1px solid var(--color-black);
      border-radius: var(--radius-sm);
      background-color: var(--color-white);
      overflow: hidden;
    }

    #editor-toolbar {
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      background-color: var(--color-lighter-cement);
    }

    #editor {
      min-height: 200px;
      max-height: 400px;
      overflow-y: auto;
      padding: 1rem;
      font-family: 'Inter', sans-serif;
    }

    /* Customize Quill toolbar */
    .ql-toolbar.ql-snow {
      border: none !important;
      padding: 0.75rem !important;
    }

    .ql-container.ql-snow {
      border: none !important;
      font-family: 'Inter', sans-serif !important;
      font-size: 1rem !important;
    }

    .ql-editor {
      color:#000;
      padding: 1rem !important;
    }

    .ql-editor p {
      margin-bottom: 0.75rem;
    }

    /* Style Quill toolbar buttons */
    .ql-formats button {
      color: var(--color-black) !important;
    }

    .ql-formats button.ql-active,
    .ql-formats button:hover {
      color: var(--color-black) !important;
    }

    .ql-formats button.ql-active .ql-stroke,
    .ql-formats button:hover .ql-stroke {
      stroke: var(--color-black) !important;
    }

    .ql-formats button.ql-active .ql-fill,
    .ql-formats button:hover .ql-fill {
      fill: var(--color-black) !important;
    }

    /* Template Selection Styles */
    .template-selection-container {
      margin-bottom: 1.5rem;
    }

    .template-search-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.25rem;
    }

    .template-search {
      position: relative;
      flex: 1;
      max-width: 400px;
    }

    .template-search input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.75rem;
      background-color: var(--color-white);
      border: 1px solid var(--color-black);
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      color: var(--color-black);
      transition: all 0.2s;
    }

    .template-search input:focus {
      outline: none;
      border-color: var(--color-black);
      box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
    }

    .template-search input::placeholder {
      color: rgba(0, 0, 0, 0.5);
    }

    .template-search .search-icon {
      position: absolute;
      left: 0.875rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--color-black);
      opacity: 0.6;
      font-size: 1.25rem;
    }

    .template-action-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 1rem;
      background-color: var(--color-black);
      border: none;
      border-radius: var(--radius-sm);
      color: var(--color-white);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
    }

    .template-action-btn:hover {
      background-color: rgba(0, 0, 0, 0.8);
      box-shadow: var(--shadow-md);
    }

    .template-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.25rem;
      background-color: var(--color-white);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-black);
    }

    .template-card {
      background-color: var(--color-light-cement);
      border-radius: var(--radius-sm);
      border: 1px solid rgba(0, 0, 0, 0.1);
      padding: 1.25rem;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
      position: relative;
      overflow: hidden;
    }

    .template-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
      border-color: var(--color-black);
    }

    .template-card.selected {
      border: 2px solid var(--color-black);
      background-color: var(--color-cement);
      box-shadow: var(--shadow-md);
    }

    .template-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background-color: var(--color-black);
    }

    .template-card-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .template-icon {
      color: var(--color-black);
      font-size: 1.5rem;
    }

    .template-title {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
      color: var(--color-black);
    }

    .template-description {
      margin: 0 0 1rem 0;
      font-size: 0.875rem;
      color: rgba(0, 0, 0, 0.7);
      line-height: 1.5;
    }

    .template-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      color: rgba(0, 0, 0, 0.6);
    }

    .template-type {
      background-color: var(--color-black);
      color: var(--color-white);
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      font-weight: 500;
    }

    .template-date {
      font-style: italic;
    }

    /* Response Time Styles */
    .response-time-container {
      background-color: var(--color-white);
      border: 1px solid var(--color-black);
      border-radius: var(--radius-md);
      padding: 1.25rem;
      box-shadow: var(--shadow-sm);
    }

    .response-time-options {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.25rem;
    }

    .response-time-option {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      position: relative;
    }

    .response-time-option input[type="radio"] {
      margin-top: 0.25rem;
      accent-color: var(--color-black);
    }

    .response-time-option label {
      font-weight: 500;
      color: var(--color-black);
      cursor: pointer;
    }

    .custom-time-inputs {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 0.75rem;
      margin-left: 1.75rem;
      padding: 1rem;
      background-color: var(--color-light-cement);
      border-radius: var(--radius-sm);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .time-input-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .time-input {
      width: 4rem;
      padding: 0.5rem;
      border: 1px solid var(--color-black);
      border-radius: var(--radius-sm);
      background-color: var(--color-white);
      font-size: 0.875rem;
      color: var(--color-black);
      text-align: center;
    }

    .time-input:focus {
      outline: none;
      border-color: var(--color-black);
      box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
    }

    .time-input-group label {
      font-size: 0.875rem;
      color: var(--color-black);
      font-weight: 400;
    }

    .response-time-summary {
      padding: 0.75rem 1rem;
      background-color: var(--color-light-cement);
      border-radius: var(--radius-sm);
      border-left: 4px solid var(--color-black);
      font-size: 0.875rem;
      color: var(--color-black);
      font-weight: 500;
    }

    /* Preview Button Styles */
    .preview-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background-color: var(--color-cement);
      color: var(--color-black);
      border: 1px solid var(--color-black);
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
    }

    .preview-button:hover {
      background-color: var(--color-light-cement);
      box-shadow: var(--shadow-md);
    }

    /* Modal Styles (Common) */
    .modal, .preview-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      overflow-y: auto;
      padding: 2rem 0;
    }

    .modal.active, .preview-modal.active {
      display: block;
    }

    .modal-content, .preview-modal-content {
      background-color: var(--color-cement);
      max-width: 1000px;
      margin: 0 auto;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
    }

    .modal-header, .preview-modal-header {
      background-color: var(--color-black);
      color: var(--color-white);
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2, .preview-modal-header h2 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .close-modal-btn {
      background: none;
      border: none;
      color: var(--color-white);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
      border-radius: 50%;
      transition: background-color 0.2s;
    }

    .close-modal-btn:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .modal-body, .preview-modal-body {
      padding: 1.5rem;
    }

    /* Edit Recipients Modal Styles */
    .edit-recipients-summary {
      background-color: var(--color-white);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-black);
      overflow: hidden;
      margin-bottom: 1.5rem;
    }

    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      background-color: var(--color-black);
      color: var(--color-white);
    }

    .summary-header h3 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
    }

    .recipient-count-badge {
      background-color: rgba(255, 255, 255, 0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .language-tabs {
      display: flex;
      background-color: var(--color-light-cement);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      overflow-x: auto;
      scrollbar-width: thin;
    }

    .language-tab {
      padding: 0.75rem 1.25rem;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--color-black);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      white-space: nowrap;
      transition: all 0.2s;
    }

    .language-tab.active {
      border-bottom-color: var(--color-black);
      background-color: var(--color-white);
    }

    .language-tab:hover:not(.active) {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .selected-recipients-container {
      max-height: 300px;
      overflow-y: auto;
      background-color: var(--color-white);
    }

    .selected-recipients-list {
      padding: 1rem;
    }

    .selected-recipient-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      background-color: var(--color-light-cement);
      border-radius: var(--radius-sm);
      margin-bottom: 0.75rem;
      border: 1px solid rgba(0, 0, 0, 0.1);
      transition: all 0.2s;
    }

    .selected-recipient-item:last-child {
      margin-bottom: 0;
    }

    .selected-recipient-item:hover {
      border-color: var(--color-black);
      box-shadow: var(--shadow-sm);
    }

    .recipient-info-compact {
      display: flex;
      flex-direction: column;
    }

    .recipient-name-compact {
      font-weight: 600;
      color: var(--color-black);
      font-size: 0.875rem;
    }

    .recipient-details-compact {
      font-size: 0.75rem;
      color: rgba(0, 0, 0, 0.6);
      margin-top: 0.25rem;
    }

    .remove-recipient-btn {
      background: none;
      border: none;
      color: var(--color-black);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.25rem;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .remove-recipient-btn:hover {
      background-color: rgba(0, 0, 0, 0.1);
      color: #f44336;
    }

    .empty-selection-message {
      text-align: center;
      padding: 2rem;
      color: rgba(0, 0, 0, 0.5);
      font-style: italic;
    }

    .edit-recipients-actions {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    .primary-button, .secondary-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      border-radius: var(--radius-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .primary-button {
      background-color: var(--color-black);
      color: var(--color-white);
      border: none;
      box-shadow: var(--shadow-sm);
    }

    .primary-button:hover {
      background-color: rgba(0, 0, 0, 0.8);
      box-shadow: var(--shadow-md);
    }

    .secondary-button {
      background-color: var(--color-white);
      color: var(--color-black);
      border: 1px solid var(--color-black);
    }

    .secondary-button:hover {
      background-color: var(--color-light-cement);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .section-header h3 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
      color: var(--color-black);
    }

    .close-section-btn {
      background: none;
      border: none;
      color: var(--color-black);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.25rem;
      border-radius: 50%;
      transition: background-color 0.2s;
    }

    .close-section-btn:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .add-recipients-section {
      background-color: var(--color-white);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-black);
      padding: 1.25rem;
      margin-top: 1.5rem;
    }

    .recipient-filter-options.compact {
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .recipient-search-bar.compact {
      margin-bottom: 1rem;
    }

    .recipient-list-container.compact {
      max-height: 300px;
      margin-bottom: 0;
    }

    .recipient-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .select-all-btn {
      background: none;
      border: none;
      color: var(--color-white);
      font-size: 0.75rem;
      cursor: pointer;
      text-decoration: underline;
      padding: 0;
    }

    .select-all-btn:hover {
      text-decoration: none;
    }

    /* Preview Modal Specific Styles */
    .preview-modal-content {
      background-color: var(--color-cement);
    }

    .preview-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-bottom: 2rem;
      background-color: var(--color-light-cement);
      padding: 1rem;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .preview-control-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .preview-control-group label {
      font-weight: 500;
      font-size: 0.875rem;
      color: var(--color-black);
    }

    .preview-recipients-control {
      flex-basis: 100%;
      margin-top: 0.5rem;
    }

    .preview-recipients-summary {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: var(--color-white);
      padding: 0.75rem 1rem;
      border-radius: var(--radius-sm);
      border: 1px solid var(--color-black);
    }

    #previewRecipientCount {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--color-black);
    }

    .preview-edit-recipients-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background-color: var(--color-black);
      border: none;
      border-radius: var(--radius-sm);
      color: var(--color-white);
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .preview-edit-recipients-btn:hover {
      background-color: rgba(0, 0, 0, 0.8);
    }

    .preview-select {
      padding: 0.5rem;
      border-radius: var(--radius-sm);
      border: 1px solid var(--color-black);
      background-color: var(--color-white);
      min-width: 180px;
      font-family: 'Inter', sans-serif;
      color: var(--color-black);
    }

    .preview-device-container {
      display: flex;
      justify-content: center;
      padding: 2rem 0;
    }

    .preview-device {
      background-color: var(--color-white);
      border-radius: 2rem;
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      transition: all 0.3s ease;
    }

    .preview-device.mobile {
      width: 360px;
      height: 640px;
      border: 12px solid var(--color-black);
    }

    .preview-device.desktop {
      width: 800px;
      height: 600px;
      border: 12px solid var(--color-black);
      border-bottom-width: 36px;
    }

    .preview-device-header {
      background-color: var(--color-black);
      color: var(--color-white);
    }

    .preview-device-status-bar {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }

    .preview-status-icons {
      display: flex;
      gap: 0.25rem;
    }

    .preview-status-icons .material-icons {
      font-size: 0.875rem;
    }

    .preview-app-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      background-color: var(--color-black);
      color: var(--color-white);
    }

    .preview-app-title {
      font-weight: 500;
    }

    .preview-device-content {
      height: calc(100% - 80px);
      overflow-y: auto;
      padding: 1rem;
    }

    .preview-notification {
      background-color: var(--color-light-cement);
      border-radius: var(--radius-md);
      padding: 1.25rem;
      margin-bottom: 1rem;
      box-shadow: var(--shadow-sm);
      border-left: 4px solid var(--color-black);
    }

    /* Updated styles to match the screenshot */
    .preview-device-content {
      background-color: white;
    }

    .preview-notification {
      background-color: #f5f5f5;
      border-radius: 8px;
      border-left: none;
      margin: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .preview-notification-title {
      font-weight: 600;
      font-size: 1.125rem;
      margin: 0 0 0.75rem 0;
      color: var(--color-black);
    }

    .preview-notification-meta {
      display: flex;
      justify-content: space-between;
      color: rgba(0, 0, 0, 0.6);
      font-size: 0.75rem;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .preview-notification-content {
      font-size: 0.875rem;
      line-height: 1.5;
      color: var(--color-black);
      margin-bottom: 1rem;
    }

    .preview-notification-response-time {
      font-size: 0.75rem;
      padding: 0.5rem 0.75rem;
      margin-bottom: 1rem;
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: var(--radius-sm);
      border-left: 3px solid var(--color-black);
      color: var(--color-black);
      font-weight: 500;
    }

    /* Updated response time style to match screenshot */
    .preview-notification-response-time {
      background-color: #f0f0f0;
      border-left: 2px solid #ccc;
      border-radius: 4px;
      padding: 8px 12px;
      margin: 12px 0;
      font-size: 0.8rem;
      color: #333;
    }

    .preview-notification-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      color: rgba(0, 0, 0, 0.7);
      padding-top: 0.5rem;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }

    .preview-notification-tag {
      display: inline-block;
      background-color: var(--color-black);
      color: var(--color-white);
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      font-size: 0.625rem;
      font-weight: 500;
      margin-right: 4px;
    }

    .preview-notification-tag.language-tag {
      background-color: #333;
    }

    .preview-recipient-info {
      font-size: 0.75rem;
      color: rgba(0, 0, 0, 0.6);
    }

    .preview-language-indicator {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.5rem;
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
      margin-left: auto;
    }

    .preview-notification-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .preview-action-btn {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.5rem 1rem;
      background-color: var(--color-light-cement);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .preview-action-btn:hover {
      background-color: var(--color-cement);
    }

    /* Two-page form styles */
    .form-page {
      display: none;
    }

    .form-page.active {
      display: block;
    }

    .page-indicator {
      display: flex;
      justify-content: center;
      margin-bottom: 2rem;
      padding: 1rem;
      background-color: var(--color-light-cement);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-black);
    }

    .page {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
      margin: 0 0.5rem;
      border-radius: var(--radius-md);
      font-weight: 500;
      color: var(--color-black);
      position: relative;
    }

    .page:not(:last-child)::after {
      content: '';
      position: absolute;
      right: -1rem;
      top: 50%;
      width: 1rem;
      height: 2px;
      background-color: var(--color-black);
    }

    .page.active {
      background-color: var(--color-black);
      color: var(--color-white);
      font-weight: 600;
    }

    .page.completed {
      background-color: var(--color-cement);
      color: var(--color-white);
    }

    .form-actions {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      margin-top: 2.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--color-black);
    }

    .step-buttons {
      display: flex;
      gap: 1rem;
    }

    .cancel-button {
      background-color: var(--color-white);
      color: var(--color-black);
      border: 3px solid var(--color-black);
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-sm);
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 120px;
      box-shadow: var(--shadow-md);
      z-index: 100;
      position: relative;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    .cancel-button:hover {
      background-color: rgba(0, 0, 0, 0.1);
      border-color: #ff3333;
      color: #ff3333;
      box-shadow: var(--shadow-lg);
      transform: translateY(-3px);
    }

    .cancel-button:active {
      transform: translateY(0);
      background-color: rgba(255, 51, 51, 0.1);
      box-shadow: var(--shadow-sm);
    }

    .cancel-button .material-icons {
      margin-right: 8px;
      font-size: 20px;
    }

    .save-button {
      background-color: var(--color-black);
      color: var(--color-white);
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
    }

    .save-button:hover {
      background-color: rgba(0, 0, 0, 0.8);
      box-shadow: var(--shadow-md);
    }

    .empty-state {
      text-align: center;
      padding: 5rem 2rem;
      color: var(--color-black);
      background-color: var(--color-light-cement);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-black);
      box-shadow: var(--shadow-md);
    }

    .empty-state-icon {
      font-size: 4.5rem;
      margin-bottom: 1.5rem;
      color: var(--color-black);
      opacity: 0.8;
      background-color: rgba(0, 0, 0, 0.1);
      width: 100px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      margin: 0 auto 1.5rem;
    }

    .empty-state-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--color-text-primary);
    }

    .empty-state-description {
      max-width: 28rem;
      margin: 0 auto;
      margin-bottom: 2rem;
      line-height: 1.6;
      color: var(--color-text-secondary);
    }

    /* Translation Management Tab */
    .translation-management-container {
      padding: 1rem;
    }

    .translation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .translation-actions {
      display: flex;
      gap: 1rem;
    }

    .translation-request-btn,
    .translation-approve-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .translation-request-btn {
      background-color: var(--color-black);
      color: var(--color-white);
      border: none;
    }

    .translation-approve-btn {
      background-color: var(--color-light-cement);
      color: var(--color-black);
      border: 1px solid var(--color-black);
    }

    .translation-request-btn:hover,
    .translation-approve-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .translation-request-btn:disabled,
    .translation-approve-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .translation-table-container {
      overflow-x: auto;
      background-color: white;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
    }

    .translation-table {
      width: 100%;
      border-collapse: collapse;
    }

    .translation-table th,
    .translation-table td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--color-border);
    }

    .translation-table th {
      font-weight: 600;
      background-color: var(--color-light-cement);
    }

    .translation-table tr:hover {
      background-color: rgba(0, 0, 0, 0.02);
    }

    .translation-table tr:last-child td {
      border-bottom: none;
    }

    .translation-status-empty {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      color: var(--color-text-secondary);
      font-style: italic;
    }

    .translation-status-info {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      color: var(--color-text-primary);
    }

    .translation-status {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
    }

    .translation-status.pending {
      background-color: #FFF3CD;
      color: #856404;
    }

    .translation-status.requested {
      background-color: #D1ECF1;
      color: #0C5460;
    }

    .translation-status.approved {
      background-color: #D4EDDA;
      color: #155724;
    }

    .translation-action-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--color-black);
      opacity: 0.7;
      transition: all 0.2s;
      padding: 0.25rem;
      margin: 0 0.25rem;
    }

    .translation-action-btn:hover {
      opacity: 1;
      transform: translateY(-2px);
    }

    .translation-action-btn .material-icons {
      font-size: 1.25rem;
    }

    /* Tab styles */
    .tabs-container {
      margin-top: 1.5rem;
    }

    .tabs-header {
      display: flex;
      border-bottom: 2px solid var(--color-black);
      margin-bottom: 1rem;
    }

    .tab-button {
      padding: 0.75rem 1.5rem;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      font-weight: 600;
      color: var(--color-black);
      cursor: pointer;
      transition: all 0.2s;
      opacity: 0.7;
    }

    .tab-button.active {
      border-bottom-color: var(--color-black);
      opacity: 1;
    }

    .tab-button:hover {
      opacity: 1;
      background-color: rgba(0, 0, 0, 0.05);
    }

    .tab-content {
      padding: 1rem;
      background-color: var(--color-white);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-black);
    }

    .tab-content.hidden {
      display: none;
    }

    .tab-empty-message {
      padding: 2rem;
      text-align: center;
      color: var(--color-text-secondary);
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="notification-container">
    <header class="header">
      <button class="back-button" onclick="window.location.href='Home-new.html'">
        <span class="material-icons">arrow_back</span>
        Back to Home
      </button>
      <div class="header-actions">
        <button class="create-button" id="createNotificationBtn">
          <span class="material-icons">add</span>
          Create New Notification
        </button>
      </div>
    </header>

    <div class="main-content">

      <!-- Notifications View (Default) -->
      <div class="notifications-view" id="notificationsView">
        <div class="notifications-header">
          <h2 class="form-title">Incoming Notifications</h2>
          <div class="notifications-actions">
            <button class="action-button" id="markAllReadBtn" title="Mark All as Read">
              <span class="material-icons">done_all</span>
              Mark All Read
            </button>
            <button class="action-button" id="clearAllNotificationsBtn" title="Clear All">
              <span class="material-icons">delete_sweep</span>
              Clear All
            </button>
            <button class="action-button" id="preferencesBtn" title="Preferences">
              <span class="material-icons">settings</span>
              Preferences
            </button>
          </div>
        </div>

        <div class="notifications-filters">
          <button class="filter-button active" data-filter="all">All</button>
          <button class="filter-button" data-filter="unread">Unread</button>
          <button class="filter-button" data-filter="high">High Priority</button>
          <button class="filter-button" data-filter="normal">Normal</button>
          <button class="filter-button" data-filter="low">Low</button>
          <button class="filter-button" data-filter="sent">Sent</button>
          <button class="filter-button" data-filter="scheduled">Scheduled</button>
          <button class="filter-button" data-filter="trash">Trash</button>
        </div>

        <div class="notifications-list-container">
          <div class="notification-list" id="notificationList">
            <!-- Sample notification card -->
            <div class="notification-card unread" data-notification-id="1">
              <div class="notification-actions">
                <button class="notification-action-btn mark-read-btn" title="Mark as Read">
                  <span class="material-icons">mark_email_read</span>
                </button>
                <button class="notification-action-btn delete-btn" title="Move to Trash">
                  <span class="material-icons">delete</span>
                </button>
              </div>
              <div class="unread-indicator"></div>
              <h3 class="notification-title">Welcome to the Notification System</h3>
              <div class="notification-meta">
                <span>Info</span>
                <span>Today</span>
              </div>
              <div class="notification-content">This is a sample notification to demonstrate the system. You can create your own notifications using the "Create New Notification" button.</div>
              <div class="notification-footer">
                <div class="notification-tags">
                  <span class="notification-tag">Info</span>
                  <span class="notification-tag">English</span>
                </div>
                <span>All users</span>
              </div>
            </div>
          </div>

          <div class="empty-notifications-state" id="emptyNotificationsState">
            <div class="empty-state-content">
              <span class="material-icons empty-state-icon">notifications_off</span>
              <div class="empty-state-text">
                <h3 class="empty-state-title">No notifications yet</h3>
                <p class="empty-state-message">New notifications will appear here as they arrive</p>
              </div>
            </div>
          </div>

          <!-- Trash Container (Hidden by default) -->
          <div class="trash-container" id="trashContainer" style="display: none;">
            <div class="trash-header">
              <h3>Trash</h3>
              <div class="trash-actions">
                <button class="empty-trash-btn" id="emptyTrashBtn">
                  <span class="material-icons">delete_forever</span>
                  Empty Trash
                </button>
              </div>
            </div>

            <div class="trash-list" id="trashList">
              <!-- Sample deleted notification -->
              <div class="notification-card trash-item" data-notification-id="2">
                <h3 class="notification-title">Deleted Notification Example</h3>
                <div class="notification-meta">
                  <span>Alert</span>
                  <span>Yesterday</span>
                </div>
                <div class="notification-content">This is an example of a deleted notification that has been moved to trash.</div>
                <div class="notification-footer">
                  <div class="notification-tags">
                    <span class="notification-tag">Alert</span>
                    <span class="notification-tag">English</span>
                  </div>
                  <span>5 recipients</span>
                </div>
                <div class="trash-item-actions">
                  <button class="restore-btn">
                    <span class="material-icons">restore</span>
                    Restore
                  </button>
                  <button class="delete-permanently-btn">
                    <span class="material-icons">delete_forever</span>
                    Delete Permanently
                  </button>
                </div>
              </div>
            </div>

            <div class="empty-trash-state" id="emptyTrashState">
              <div class="empty-state-content">
                <span class="material-icons empty-state-icon">delete_outline</span>
                <div class="empty-state-text">
                  <h3 class="empty-state-title">Trash is empty</h3>
                  <p class="empty-state-message">Deleted notifications will appear here</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Compose Form View (Hidden by default) -->
      <div class="compose-form hidden" id="composeForm">

      <div class="compose-header">
        <h2 class="form-title">Compose New Notification</h2>
      </div>

      <!-- Two-page form indicator -->
      <div class="page-indicator">
        <div class="page active" id="page1Indicator">Recipients Selection</div>
        <div class="page" id="page2Indicator">Notification Details</div>
      </div>

      <!-- Page 1: Recipient Selection -->
      <div id="page1" class="form-page active">
        <div class="form-group" id="recipientSelectionSection">
          <label class="form-label">Select Recipients</label>

          <div class="recipient-selection-container">
          <!-- Filter Options -->
          <div class="recipient-filter-options" id="recipientFilterOptions">
            <!-- Manually added filter options instead of relying on JavaScript -->
            <div class="filter-option">
              <input type="radio" name="recipientFilter" id="filterAll" value="all" checked>
              <label for="filterAll">All Users</label>
            </div>

            <div class="filter-option">
              <input type="radio" name="recipientFilter" id="filterDownline" value="downline">
              <label for="filterDownline">Downline</label>
            </div>

            <div class="filter-option">
              <input type="radio" name="recipientFilter" id="filterCompany" value="company">
              <label for="filterCompany">Company</label>
              <div class="sub-filter company-filter hidden">
                <select id="companySelect">
                  <option value="">Select Company</option>
                  <option value="Acme Inc.">Acme Inc.</option>
                  <option value="Beta Corp.">Beta Corp.</option>
                </select>
              </div>
            </div>

            <div class="filter-option">
              <input type="radio" name="recipientFilter" id="filterTeam" value="team">
              <label for="filterTeam">Group/Team</label>
              <div class="sub-filter team-filter hidden">
                <select id="teamSelect">
                  <option value="">Select Team</option>
                  <option value="Sales">Sales</option>
                  <option value="Field Service">Field Service</option>
                  <option value="Customer Support">Customer Support</option>
                  <option value="IT">IT</option>
                </select>
              </div>
            </div>

            <div class="filter-option">
              <input type="radio" name="recipientFilter" id="filterRole" value="role">
              <label for="filterRole">Role</label>
              <div class="sub-filter role-filter hidden">
                <select id="roleSelect">
                  <option value="">Select Role</option>
                  <option value="Manager">Manager</option>
                  <option value="Technician">Technician</option>
                  <option value="Supervisor">Supervisor</option>
                  <option value="Administrator">Administrator</option>
                </select>
              </div>
            </div>

            <div class="filter-option">
              <input type="radio" name="recipientFilter" id="filterIndividual" value="individual">
              <label for="filterIndividual">Individual</label>
              <div class="sub-filter individual-filter hidden">
                <input type="text" id="individualSearch" placeholder="Search by name...">
              </div>
            </div>
          </div>

          <!-- Search and Action Bar -->
          <div class="recipient-search-bar">
            <div class="recipient-search">
              <span class="material-icons search-icon">search</span>
              <input type="text" id="recipientSearch" placeholder="Search recipients...">
            </div>
            <div class="recipient-actions">
              <button class="recipient-action-btn" onclick="selectAllVisibleRecipients()">Select All Visible</button>
              <button class="recipient-action-btn" onclick="deselectAllRecipients()">Deselect All</button>
            </div>
          </div>

          <!-- Recipients and Language Grouping Side by Side Container -->
          <div style="display: flex; gap: 20px;">
            <!-- Left Side: Recipient List -->
            <div class="recipient-list-container" style="flex: 1; min-width: 400px; background-color: #000; color: #fff; border-radius: 5px; overflow: hidden;">
              <div class="recipient-list-header" style="padding: 10px; background-color: #000; color: #fff; font-weight: 600; border-bottom: 1px solid #333;">
                <span>Recipients</span>
              </div>
              <div id="recipientList" class="recipient-list" style="max-height: 400px; overflow-y: auto;">
                <!-- Manually added sample recipients instead of relying on JavaScript -->
                <div class="recipient-item" data-user-id="1" data-language="English" style="padding: 10px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between;">
                  <div style="display: flex; align-items: center;">
                    <div class="recipient-checkbox" style="margin-right: 10px;">
                      <input type="checkbox" id="user-1" data-user-id="1">
                      <label for="user-1"></label>
                    </div>
                    <div class="recipient-info">
                      <div class="recipient-name" style="font-weight: 600;">Lakshmi</div>
                      <div class="recipient-details" style="font-size: 0.8rem; color: #ccc;">
                        <span class="recipient-role">Manager</span> •
                        <span class="recipient-team">Sales</span> •
                        <span class="recipient-company">Acme Inc.</span>
                      </div>
                    </div>
                  </div>
                  <div class="recipient-language" style="background-color: #333; padding: 3px 8px; border-radius: 3px; font-size: 0.8rem;">English</div>
                </div>

                <div class="recipient-item" data-user-id="2" data-language="Hindi" style="padding: 10px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between;">
                  <div style="display: flex; align-items: center;">
                    <div class="recipient-checkbox" style="margin-right: 10px;">
                      <input type="checkbox" id="user-2" data-user-id="2">
                      <label for="user-2"></label>
                    </div>
                    <div class="recipient-info">
                      <div class="recipient-name" style="font-weight: 600;">Impana</div>
                      <div class="recipient-details" style="font-size: 0.8rem; color: #ccc;">
                        <span class="recipient-role">Technician</span> •
                        <span class="recipient-team">Field Service</span> •
                        <span class="recipient-company">Acme Inc.</span>
                      </div>
                    </div>
                  </div>
                  <div class="recipient-language" style="background-color: #333; padding: 3px 8px; border-radius: 3px; font-size: 0.8rem;">Hindi</div>
                </div>

                <div class="recipient-item" data-user-id="3" data-language="Punjabi" style="padding: 10px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between;">
                  <div style="display: flex; align-items: center;">
                    <div class="recipient-checkbox" style="margin-right: 10px;">
                      <input type="checkbox" id="user-3" data-user-id="3">
                      <label for="user-3"></label>
                    </div>
                    <div class="recipient-info">
                      <div class="recipient-name" style="font-weight: 600;">Arjun Singh</div>
                      <div class="recipient-details" style="font-size: 0.8rem; color: #ccc;">
                        <span class="recipient-role">Technician</span> •
                        <span class="recipient-team">Field Service</span> •
                        <span class="recipient-company">Acme Inc.</span>
                      </div>
                    </div>
                  </div>
                  <div class="recipient-language" style="background-color: #333; padding: 3px 8px; border-radius: 3px; font-size: 0.8rem;">Punjabi</div>
                </div>

                <div class="recipient-item" data-user-id="4" data-language="English" style="padding: 10px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between;">
                  <div style="display: flex; align-items: center;">
                    <div class="recipient-checkbox" style="margin-right: 10px;">
                      <input type="checkbox" id="user-4" data-user-id="4">
                      <label for="user-4"></label>
                    </div>
                    <div class="recipient-info">
                      <div class="recipient-name" style="font-weight: 600;">Ananya Desai</div>
                      <div class="recipient-details" style="font-size: 0.8rem; color: #ccc;">
                        <span class="recipient-role">Supervisor</span> •
                        <span class="recipient-team">Customer Support</span> •
                        <span class="recipient-company">Acme Inc.</span>
                      </div>
                    </div>
                  </div>
                  <div class="recipient-language" style="background-color: #333; padding: 3px 8px; border-radius: 3px; font-size: 0.8rem;">English</div>
                </div>

                <div class="recipient-item" data-user-id="5" data-language="Telugu" style="padding: 10px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between;">
                  <div style="display: flex; align-items: center;">
                    <div class="recipient-checkbox" style="margin-right: 10px;">
                      <input type="checkbox" id="user-5" data-user-id="5">
                      <label for="user-5"></label>
                    </div>
                    <div class="recipient-info">
                      <div class="recipient-name" style="font-weight: 600;">Vikram Reddy</div>
                      <div class="recipient-details" style="font-size: 0.8rem; color: #ccc;">
                        <span class="recipient-role">Technician</span> •
                        <span class="recipient-team">Field Service</span> •
                        <span class="recipient-company">Acme Inc.</span>
                      </div>
                    </div>
                  </div>
                  <div class="recipient-language" style="background-color: #333; padding: 3px 8px; border-radius: 3px; font-size: 0.8rem;">Telugu</div>
                </div>

                <div class="recipient-item" data-user-id="6" data-language="Tamil" style="padding: 10px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between;">
                  <div style="display: flex; align-items: center;">
                    <div class="recipient-checkbox" style="margin-right: 10px;">
                      <input type="checkbox" id="user-6" data-user-id="6">
                      <label for="user-6"></label>
                    </div>
                    <div class="recipient-info">
                      <div class="recipient-name" style="font-weight: 600;">Meera Iyer</div>
                      <div class="recipient-details" style="font-size: 0.8rem; color: #ccc;">
                        <span class="recipient-role">Technician</span> •
                        <span class="recipient-team">Field Service</span> •
                        <span class="recipient-company">Acme Inc.</span>
                      </div>
                    </div>
                  </div>
                  <div class="recipient-language" style="background-color: #333; padding: 3px 8px; border-radius: 3px; font-size: 0.8rem;">Tamil</div>
                </div>
              </div>
            </div>

            <!-- Right Side: Language Grouping (No container box) -->
            <div class="language-grouping-section" id="languageGrouping" style="flex: 1; min-width: 400px; color: #fff;">
              <div class="language-grouping-header" style="padding: 10px; color: #fff; font-weight: 600;">
                <span>Language Grouping</span>
              </div>
              <!-- Language grouping content - populated dynamically when recipients are selected -->
              <div id="languageGroupingContent" class="language-grouping-content" style="padding: 10px; max-height: 350px; overflow-y: auto;">
                <!-- This will be populated dynamically when recipients are selected -->
              </div>
            </div>
          </div>
        </div>

        <!-- Next Button -->
        <div class="form-actions">
          <div>
            <button class="cancel-button" id="cancelBtnPage1" onclick="return cancelForm()">Cancel</button>
          </div>
          <div class="step-buttons">
            <button class="primary-button" id="nextPageBtn">
              <span>Next</span>
              <span class="material-icons">arrow_forward</span>
            </button>
          </div>
        </div>
      </div>
      </div>

      <!-- Page 2: Notification Details (initially hidden) -->
      <div id="page2" class="form-page">

      <div class="form-group">
        <label class="form-label" for="notificationType">Notification Type</label>
        <select id="notificationType" class="form-input">
          <option value="">Select notification type</option>
          <option value="insert">Insert</option>
          <option value="approval">Approval</option>
          <option value="info">Info</option>
          <option value="alert">Alert</option>
          <option value="action">Action</option>
        </select>
      </div>

      <!-- Response Time Setting -->
      <div class="form-group">
        <label class="form-label">Response Time</label>
        <div class="response-time-container">
          <div class="response-time-options">
            <div class="response-time-option">
              <input type="radio" name="responseTimeOption" id="responseTimeDefault" value="default" checked>
              <label for="responseTimeDefault">Default (24 hours)</label>
            </div>

            <div class="response-time-option">
              <input type="radio" name="responseTimeOption" id="responseTimeCustom" value="custom">
              <label for="responseTimeCustom">Custom</label>

              <div class="custom-time-inputs hidden" id="customTimeInputs">
                <div class="time-input-group">
                  <input type="number" id="responseDays" min="0" max="30" value="1" class="time-input">
                  <label for="responseDays">Days</label>
                </div>

                <div class="time-input-group">
                  <input type="number" id="responseHours" min="0" max="23" value="0" class="time-input">
                  <label for="responseHours">Hours</label>
                </div>

                <div class="time-input-group">
                  <input type="number" id="responseMinutes" min="0" max="59" value="0" class="time-input">
                  <label for="responseMinutes">Minutes</label>
                </div>
              </div>
            </div>

            <div class="response-time-option">
              <input type="radio" name="responseTimeOption" id="responseTimeNone" value="none">
              <label for="responseTimeNone">No response required</label>
            </div>
          </div>

          <div class="response-time-summary" id="responseTimeSummary">
            Recipients must respond within 24 hours
          </div>
        </div>
      </div>
      <!-- MODULE 2C: Template Selection -->
      <div class="form-group">
        <label class="form-label">Template Selection</label>
        <div class="template-selection-container">
          <div class="template-search-bar">
            <div class="template-search">
              <span class="material-icons search-icon">search</span>
              <input type="text" id="templateSearch" placeholder="Search templates..." class="form-input">
            </div>
            <div class="template-actions">
              <button class="template-action-btn" id="createTemplateBtn">
                <span class="material-icons">add</span>
                Create Template
              </button>
            </div>
          </div>

          <div class="template-grid">
            <!-- Template cards will be displayed here -->
            <div class="template-card" data-template-id="1">
              <div class="template-card-header">
                <span class="material-icons template-icon">description</span>
                <h4 class="template-title">Welcome Message</h4>
              </div>
              <p class="template-description">Standard welcome message for new users</p>
              <div class="template-meta">
                <span class="template-type">Info</span>
                <span class="template-date">Last used: 2 days ago</span>
              </div>
            </div>

            <div class="template-card" data-template-id="2">
              <div class="template-card-header">
                <span class="material-icons template-icon">assignment</span>
                <h4 class="template-title">Service Reminder</h4>
              </div>
              <p class="template-description">Reminder for upcoming service appointments</p>
              <div class="template-meta">
                <span class="template-type">Alert</span>
                <span class="template-date">Last used: 1 week ago</span>
              </div>
            </div>

            <div class="template-card" data-template-id="3">
              <div class="template-card-header">
                <span class="material-icons template-icon">campaign</span>
                <h4 class="template-title">Promotional Offer</h4>
              </div>
              <p class="template-description">Special discount announcement for existing customers</p>
              <div class="template-meta">
                <span class="template-type">Action</span>
                <span class="template-date">Last used: 3 days ago</span>
              </div>
            </div>

            <div class="template-card" data-template-id="4">
              <div class="template-card-header">
                <span class="material-icons template-icon">event_available</span>
                <h4 class="template-title">Appointment Confirmation</h4>
              </div>
              <p class="template-description">Confirmation for scheduled appointments</p>
              <div class="template-meta">
                <span class="template-type">Info</span>
                <span class="template-date">Last used: Yesterday</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- MODULE 3: Multiple Language Selection -->
      <div class="form-group">
        <label class="form-label">Notification Content</label>

        <!-- Default notification content field -->
        <div class="notification-content-fields">
          <div class="content-field-group">
            <label class="sub-label">Title</label>
            <input type="text" id="notificationTitle" class="form-input" placeholder="Enter notification title">
          </div>
          <div class="content-field-group">
            <label class="sub-label">Message</label>
            <div class="rich-text-editor-container">
              <div id="editor-toolbar">
                <!-- Toolbar will be created by Quill -->
              </div>
              <div id="editor">
                <!-- Editor content will go here -->
              </div>
              <input type="hidden" id="notificationContent">
            </div>
          </div>
        </div>

        <div class="language-selection-container" id="languageSelection">
          <!-- Language selection will be populated by JavaScript -->
        </div>

        <!-- Translation Management Section -->
        <div class="tabs-container">
          <div class="tabs-header">
            <button class="tab-button active" data-tab="translation-management">Translation Management</button>
          </div>

          <div class="tab-content" id="translation-management-tab">
            <!-- Translation Management Tab Content -->
            <div class="translation-management-container">
              <div class="translation-header">
                <h3>Translation Management</h3>
                <div class="translation-actions">
                  <button class="translation-request-btn" id="requestTranslationBtn">
                    <span class="material-icons">translate</span>
                    Request Translation
                  </button>
                  <button class="translation-approve-btn" id="approveTranslationBtn">
                    <span class="material-icons">check_circle</span>
                    Approve Translations
                  </button>
                </div>
              </div>

              <div class="translation-table-container">
                <table class="translation-table">
                  <thead>
                    <tr>
                      <th>Language</th>
                      <th>Status</th>
                      <th>Translator</th>
                      <th>Due Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="translationStatusList">
                    <!-- Sample translation data for all available languages -->
                    <tr class="translation-row" data-language="Spanish">
                      <td>🇪🇸 Spanish</td>
                      <td><span class="translation-status status-pending">Pending</span></td>
                      <td>Auto-assigned</td>
                      <td>06/15/2023</td>
                      <td>
                        <button class="translation-action-btn view-btn" title="View Translation">
                          <span class="material-icons">visibility</span>
                        </button>
                        <button class="translation-action-btn edit-btn" title="Edit Translation">
                          <span class="material-icons">edit</span>
                        </button>
                      </td>
                    </tr>
                    <tr class="translation-row" data-language="Hindi">
                      <td>🇮🇳 Hindi</td>
                      <td><span class="translation-status status-in-progress">Requested</span></td>
                      <td>Priya Patel</td>
                      <td>06/16/2023</td>
                      <td>
                        <button class="translation-action-btn view-btn" title="View Translation">
                          <span class="material-icons">visibility</span>
                        </button>
                        <button class="translation-action-btn edit-btn" title="Edit Translation">
                          <span class="material-icons">edit</span>
                        </button>
                      </td>
                    </tr>
                    <tr class="translation-row" data-language="Punjabi">
                      <td>🇮🇳 Punjabi</td>
                      <td><span class="translation-status status-completed">Approved</span></td>
                      <td>Arjun Singh</td>
                      <td>06/14/2023</td>
                      <td>
                        <button class="translation-action-btn view-btn" title="View Translation">
                          <span class="material-icons">visibility</span>
                        </button>
                        <button class="translation-action-btn edit-btn" title="Edit Translation">
                          <span class="material-icons">edit</span>
                        </button>
                      </td>
                    </tr>
                    <tr class="translation-row" data-language="Italian">
                      <td>🇮🇹 Italian</td>
                      <td><span class="translation-status status-pending">Pending</span></td>
                      <td>Auto-assigned</td>
                      <td>06/17/2023</td>
                      <td>
                        <button class="translation-action-btn view-btn" title="View Translation">
                          <span class="material-icons">visibility</span>
                        </button>
                        <button class="translation-action-btn edit-btn" title="Edit Translation">
                          <span class="material-icons">edit</span>
                        </button>
                      </td>
                    </tr>
                    <tr class="translation-row" data-language="Tamil">
                      <td>🇮🇳 Tamil</td>
                      <td><span class="translation-status status-in-progress">Requested</span></td>
                      <td>Meera Iyer</td>
                      <td>06/18/2023</td>
                      <td>
                        <button class="translation-action-btn view-btn" title="View Translation">
                          <span class="material-icons">visibility</span>
                        </button>
                        <button class="translation-action-btn edit-btn" title="Edit Translation">
                          <span class="material-icons">edit</span>
                        </button>
                      </td>
                    </tr>
                    <tr class="translation-row" data-language="Japanese">
                      <td>🇯🇵 Japanese</td>
                      <td><span class="translation-status status-pending">Pending</span></td>
                      <td>Auto-assigned</td>
                      <td>06/19/2023</td>
                      <td>
                        <button class="translation-action-btn view-btn" title="View Translation">
                          <span class="material-icons">visibility</span>
                        </button>
                        <button class="translation-action-btn edit-btn" title="Edit Translation">
                          <span class="material-icons">edit</span>
                        </button>
                      </td>
                    </tr>
                    <tr class="translation-row" data-language="Telugu">
                      <td>🇮🇳 Telugu</td>
                      <td><span class="translation-status status-completed">Approved</span></td>
                      <td>Vikram Reddy</td>
                      <td>06/15/2023</td>
                      <td>
                        <button class="translation-action-btn view-btn" title="View Translation">
                          <span class="material-icons">visibility</span>
                        </button>
                        <button class="translation-action-btn edit-btn" title="Edit Translation">
                          <span class="material-icons">edit</span>
                        </button>
                      </td>
                    </tr>
                    <tr class="translation-row" data-language="Malayalam">
                      <td>🇮🇳 Malayalam</td>
                      <td><span class="translation-status status-in-progress">Requested</span></td>
                      <td>Aditya Nair</td>
                      <td>06/20/2023</td>
                      <td>
                        <button class="translation-action-btn view-btn" title="View Translation">
                          <span class="material-icons">visibility</span>
                        </button>
                        <button class="translation-action-btn edit-btn" title="Edit Translation">
                          <span class="material-icons">edit</span>
                        </button>
                      </td>
                    </tr>
                    <tr class="translation-row" data-language="Hindi">
                      <td>🇮🇳 Hindi</td>
                      <td><span class="translation-status status-pending">Pending</span></td>
                      <td>Auto-assigned</td>
                      <td>06/21/2023</td>
                      <td>
                        <button class="translation-action-btn view-btn" title="View Translation">
                          <span class="material-icons">visibility</span>
                        </button>
                        <button class="translation-action-btn edit-btn" title="Edit Translation">
                          <span class="material-icons">edit</span>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Send/Schedule Options -->
      <div class="send-schedule-container">
        <div class="send-schedule-header">
          <h3>Send Options</h3>
        </div>

        <div class="send-schedule-options">
          <div class="send-option">
            <input type="radio" name="sendOption" id="sendImmediately" value="immediate" checked>
            <label for="sendImmediately">Send immediately</label>
          </div>

          <div class="send-option">
            <input type="radio" name="sendOption" id="scheduleForLater" value="scheduled">
            <label for="scheduleForLater">Schedule for later</label>

            <div class="schedule-datetime-container hidden" id="scheduleDateTimeContainer">
              <div class="schedule-date-input">
                <label for="scheduleDate">Date</label>
                <input type="date" id="scheduleDate" class="schedule-input">
              </div>

              <div class="schedule-time-input">
                <label for="scheduleTime">Time</label>
                <input type="time" id="scheduleTime" class="schedule-input">
              </div>

              <div class="schedule-timezone">
                <label for="scheduleTimezone">Timezone</label>
                <select id="scheduleTimezone" class="schedule-input">
                  <option value="UTC-8">Pacific Time (UTC-8)</option>
                  <option value="UTC-7">Mountain Time (UTC-7)</option>
                  <option value="UTC-6">Central Time (UTC-6)</option>
                  <option value="UTC-5">Eastern Time (UTC-5)</option>
                  <option value="UTC+0">UTC</option>
                  <option value="UTC+1">Central European Time (UTC+1)</option>
                  <option value="UTC+2">Eastern European Time (UTC+2)</option>
                  <option value="UTC+5:30">Indian Standard Time (UTC+5:30)</option>
                  <option value="UTC+8">China Standard Time (UTC+8)</option>
                  <option value="UTC+9">Japan Standard Time (UTC+9)</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <div>
          <button class="cancel-button" id="cancelBtnPage2" onclick="return cancelForm()">
            <span class="material-icons">cancel</span>
            Cancel
          </button>
        </div>
        <div class="step-buttons">
          <!-- Back to Recipients button removed as requested -->
          <button class="preview-button" id="previewBtn">
            <span class="material-icons">visibility</span>
            Preview
          </button>
          <button class="save-button" id="saveBtn">Save Draft</button>
          <button class="send-button" id="sendBtn">
            <span class="material-icons">send</span>
            Send Notification
          </button>
        </div>
      </div>
      </div> <!-- End of page2 -->
    </div> <!-- End of composeForm -->

    <!-- Removed duplicate content -->
    </div>
  </div>

  <script>
    // Recipient selection and language grouping functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Add event listeners to all recipient checkboxes
      document.querySelectorAll('#recipientList input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', updateLanguageGrouping);
      });

      // Initial update of language grouping
      updateLanguageGrouping();
    });

    // Update language grouping based on selected recipients
    function updateLanguageGrouping() {
      const selectedRecipients = Array.from(document.querySelectorAll('#recipientList input[type="checkbox"]:checked'));
      const languageGroupingContent = document.getElementById('languageGroupingContent');

      // Clear previous content
      if (languageGroupingContent) {
        languageGroupingContent.innerHTML = '';
      }

      // If no recipients are selected, leave it empty
      if (selectedRecipients.length === 0) {
        return;
      }

      // Group recipients by language
      const languageGroups = {};

      selectedRecipients.forEach(checkbox => {
        const recipientItem = checkbox.closest('.recipient-item');
        const language = recipientItem.getAttribute('data-language');
        const name = recipientItem.querySelector('.recipient-name').textContent;

        if (!languageGroups[language]) {
          languageGroups[language] = [];
        }

        languageGroups[language].push(name);
      });

      // Generate HTML for language groups
      let languageGroupingHTML = '';

      for (const language in languageGroups) {
        const recipients = languageGroups[language];
        const recipientCount = recipients.length;

        languageGroupingHTML += `
          <div class="language-group" style="margin-bottom: 15px; background-color: #000; border-radius: 5px; padding: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
            <div class="language-group-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
              <span style="font-weight: 600;">${language} (${recipientCount})</span>
              <span style="background-color: #333; padding: 2px 6px; border-radius: 3px; font-size: 0.8rem;">${recipientCount} ${recipientCount === 1 ? 'Recipient' : 'Recipients'}</span>
            </div>
            <div class="language-group-recipients" style="padding-left: 10px; border-left: 2px solid #333;">
              ${recipients.map(name => `<div style="margin-bottom: 5px;">${name}</div>`).join('')}
            </div>
          </div>
        `;
      }

      // Update language grouping content
      if (languageGroupingContent) {
        languageGroupingContent.innerHTML = languageGroupingHTML;
      }
    }

    // Select all visible recipients
    function selectAllVisibleRecipients() {
      document.querySelectorAll('#recipientList input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = true;
      });
      updateLanguageGrouping();
    }

    // Deselect all recipients
    function deselectAllRecipients() {
      document.querySelectorAll('#recipientList input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
      });
      updateLanguageGrouping();
    }

    // Global variable for available languages
    const availableLanguages = [
      { code: 'en', name: 'English', flag: '🇮🇳' },
      { code: 'hi', name: 'Hindi', flag: '🇮🇳' },
      { code: 'pa', name: 'Punjabi', flag: '🇮🇳' },
      { code: 'te', name: 'Telugu', flag: '🇮🇳' },
      { code: 'ta', name: 'Tamil', flag: '🇮🇳' },
      { code: 'ml', name: 'Malayalam', flag: '🇮🇳' },
      { code: 'mr', name: 'Marathi', flag: '🇮🇳' },
      { code: 'bn', name: 'Bengali', flag: '🇮🇳' },
      { code: 'kn', name: 'Kannada', flag: '🇮🇳' },
      { code: 'gu', name: 'Gujarati', flag: '🇮🇳' }
    ];

    // Helper function to get available languages
    function getAvailableLanguages() {
      return availableLanguages;
    }

    document.addEventListener('DOMContentLoaded', function() {
      const createNotificationBtn = document.getElementById('createNotificationBtn');
      const emptyStateCreateBtn = document.getElementById('emptyStateCreateBtn');
      const composeForm = document.getElementById('composeForm');
      const cancelBtnPage1 = document.getElementById('cancelBtnPage1');
      const cancelBtnPage2 = document.getElementById('cancelBtnPage2');
      const saveBtn = document.getElementById('saveBtn');
      const notificationList = document.getElementById('notificationList');

      // Initialize Mark All as Read button
      const markAllReadBtn = document.getElementById('markAllReadBtn');
      if (markAllReadBtn) {
        markAllReadBtn.addEventListener('click', function() {
          // Get all unread notifications
          const unreadNotifications = document.querySelectorAll('.notification-card.unread');

          // Mark all as read
          unreadNotifications.forEach(notification => {
            // Remove unread class
            notification.classList.remove('unread');

            // Update button
            const markReadBtn = notification.querySelector('.mark-read-btn');
            if (markReadBtn) {
              markReadBtn.title = 'Mark as Unread';
              markReadBtn.querySelector('.material-icons').textContent = 'mark_email_unread';
            }
          });
        });
      }

      // Initialize Clear All button
      const clearAllNotificationsBtn = document.getElementById('clearAllNotificationsBtn');
      if (clearAllNotificationsBtn) {
        clearAllNotificationsBtn.addEventListener('click', function() {
          // Confirm before clearing all
          if (confirm('Are you sure you want to move all notifications to trash?')) {
            // Get all notifications
            const notifications = document.querySelectorAll('.notification-list .notification-card');

            // Move all to trash
            notifications.forEach(notification => {
              // Trigger delete button click
              const deleteBtn = notification.querySelector('.delete-btn');
              if (deleteBtn) {
                deleteBtn.click();
              }
            });
          }
        });
      }

      // Initialize filter buttons
      const filterButtons = document.querySelectorAll('.filter-button');
      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Remove active class from all buttons
          filterButtons.forEach(btn => btn.classList.remove('active'));

          // Add active class to clicked button
          this.classList.add('active');

          const filter = this.getAttribute('data-filter');

          // Handle trash filter separately
          if (filter === 'trash') {
            // Hide notification list and show trash
            notificationList.style.display = 'none';
            emptyNotificationsState.style.display = 'none';
            trashContainer.style.display = 'block';
            checkAndShowEmptyTrashState();
          } else {
            // Hide trash and show notification list
            trashContainer.style.display = 'none';
            notificationList.style.display = 'block';
            checkAndShowEmptyState();

            // Apply other filters (not implemented in this demo)
            // This would filter the notifications based on the selected filter
          }
        });
      });

      // Get empty state element
      const emptyNotificationsState = document.getElementById('emptyNotificationsState');

      // Get trash elements
      const trashContainer = document.getElementById('trashContainer');
      const trashList = document.getElementById('trashList');
      const emptyTrashState = document.getElementById('emptyTrashState');
      const emptyTrashBtn = document.getElementById('emptyTrashBtn');

      // Store deleted notifications
      let trashedNotifications = [];

      // Function to check if notification list is empty and show empty state if needed - defined in global scope
      window.checkAndShowEmptyState = function() {
        const notificationList = document.getElementById('notificationList');
        const emptyNotificationsState = document.getElementById('emptyNotificationsState');

        if (!notificationList || !emptyNotificationsState) {
          console.error('Notification list or empty state elements not found');
          return;
        }

        if (notificationList.children.length === 0) {
          // Show empty state
          emptyNotificationsState.style.display = 'flex';
        } else {
          // Hide empty state
          emptyNotificationsState.style.display = 'none';
        }

        console.log('Checked and updated empty state visibility');
      }

      // Function to check if trash is empty and show empty state if needed
      function checkAndShowEmptyTrashState() {
        if (trashList.children.length === 0) {
          // Show empty trash state
          emptyTrashState.style.display = 'flex';
        } else {
          // Hide empty trash state
          emptyTrashState.style.display = 'none';
        }
      }

      // Initialize empty states on page load
      checkAndShowEmptyState();
      checkAndShowEmptyTrashState();

      // Add event listeners for notification actions
      document.addEventListener('click', function(e) {
        // Handle mark as read button clicks
        if (e.target.closest('.mark-read-btn')) {
          const notificationCard = e.target.closest('.notification-card');

          // Toggle read/unread state
          if (notificationCard.classList.contains('unread')) {
            // Mark as read
            notificationCard.classList.remove('unread');

            // Change button to mark as unread
            const markReadBtn = notificationCard.querySelector('.mark-read-btn');
            markReadBtn.title = 'Mark as Unread';
            markReadBtn.querySelector('.material-icons').textContent = 'mark_email_unread';
          } else {
            // Mark as unread
            notificationCard.classList.add('unread');

            // Change button to mark as read
            const markReadBtn = notificationCard.querySelector('.mark-read-btn');
            markReadBtn.title = 'Mark as Read';
            markReadBtn.querySelector('.material-icons').textContent = 'mark_email_read';
          }

          // Prevent event bubbling
          e.stopPropagation();
        }

        // Handle delete button clicks
        if (e.target.closest('.delete-btn')) {
          const notificationCard = e.target.closest('.notification-card');
          const notificationId = notificationCard.getAttribute('data-notification-id');

          // Store notification data before removing
          const notificationData = {
            id: notificationId,
            title: notificationCard.querySelector('.notification-title').textContent,
            meta: notificationCard.querySelector('.notification-meta').innerHTML,
            content: notificationCard.querySelector('.notification-content').innerHTML,
            footer: notificationCard.querySelector('.notification-footer').innerHTML
          };

          // Add to trashed notifications
          trashedNotifications.push(notificationData);

          // Create trash item
          const trashItem = document.createElement('div');
          trashItem.className = 'notification-card trash-item';
          trashItem.setAttribute('data-notification-id', notificationId);
          trashItem.innerHTML = `
            <h3 class="notification-title">${notificationData.title}</h3>
            <div class="notification-meta">${notificationData.meta}</div>
            <div class="notification-content">${notificationData.content}</div>
            <div class="notification-footer">${notificationData.footer}</div>
            <div class="trash-item-actions">
              <button class="restore-btn">
                <span class="material-icons">restore</span>
                Restore
              </button>
              <button class="delete-permanently-btn">
                <span class="material-icons">delete_forever</span>
                Delete Permanently
              </button>
            </div>
          `;

          // Add to trash list
          trashList.appendChild(trashItem);

          // Remove from notification list
          notificationCard.remove();

          // Update empty states
          checkAndShowEmptyState();
          checkAndShowEmptyTrashState();

          // Prevent event bubbling
          e.stopPropagation();
        }

        // Handle restore button clicks
        if (e.target.closest('.restore-btn')) {
          const trashItem = e.target.closest('.trash-item');
          const notificationId = trashItem.getAttribute('data-notification-id');

          // Find notification data
          const notificationData = trashedNotifications.find(n => n.id === notificationId);

          if (notificationData) {
            // Create notification card
            const notificationCard = document.createElement('div');
            notificationCard.className = 'notification-card';
            notificationCard.setAttribute('data-notification-id', notificationId);
            notificationCard.innerHTML = `
              <div class="notification-actions">
                <button class="notification-action-btn mark-read-btn" title="Mark as Read">
                  <span class="material-icons">mark_email_read</span>
                </button>
                <button class="notification-action-btn delete-btn" title="Move to Trash">
                  <span class="material-icons">delete</span>
                </button>
              </div>
              <div class="unread-indicator"></div>
              <h3 class="notification-title">${notificationData.title}</h3>
              <div class="notification-meta">${notificationData.meta}</div>
              <div class="notification-content">${notificationData.content}</div>
              <div class="notification-footer">${notificationData.footer}</div>
            `;

            // Mark as unread by default when restored
            notificationCard.classList.add('unread');

            // Add to notification list
            notificationList.appendChild(notificationCard);

            // Remove from trashed notifications
            trashedNotifications = trashedNotifications.filter(n => n.id !== notificationId);

            // Remove from trash list
            trashItem.remove();

            // Update empty states
            checkAndShowEmptyState();
            checkAndShowEmptyTrashState();
          }

          // Prevent event bubbling
          e.stopPropagation();
        }

        // Handle delete permanently button clicks
        if (e.target.closest('.delete-permanently-btn')) {
          const trashItem = e.target.closest('.trash-item');
          const notificationId = trashItem.getAttribute('data-notification-id');

          // Remove from trashed notifications
          trashedNotifications = trashedNotifications.filter(n => n.id !== notificationId);

          // Remove from trash list
          trashItem.remove();

          // Update empty trash state
          checkAndShowEmptyTrashState();

          // Prevent event bubbling
          e.stopPropagation();
        }
      });

      // Empty trash button
      if (emptyTrashBtn) {
        emptyTrashBtn.addEventListener('click', function() {
          // Confirm before emptying trash
          if (confirm('Are you sure you want to permanently delete all items in the trash?')) {
            // Clear trashed notifications
            trashedNotifications = [];

            // Clear trash list
            trashList.innerHTML = '';

            // Update empty trash state
            checkAndShowEmptyTrashState();
          }
        });
      }

      // Back button for compose form removed as requested

      // Two-page form navigation
      const page1 = document.getElementById('page1');
      const page2 = document.getElementById('page2');
      const page1Indicator = document.getElementById('page1Indicator');
      const page2Indicator = document.getElementById('page2Indicator');
      const nextPageBtn = document.getElementById('nextPageBtn');

      // Function to navigate between pages - defined in global scope
      window.goToPage = function(pageNumber) {
        const page1 = document.getElementById('page1');
        const page2 = document.getElementById('page2');
        const page1Indicator = document.getElementById('page1Indicator');
        const page2Indicator = document.getElementById('page2Indicator');

        if (!page1 || !page2) {
          console.error('Page elements not found');
          return;
        }

        if (pageNumber === 1) {
          page1.classList.add('active');
          page2.classList.remove('active');
          if (page1Indicator) page1Indicator.classList.add('active');
          if (page1Indicator) page1Indicator.classList.remove('completed');
          if (page2Indicator) page2Indicator.classList.remove('active', 'completed');
        } else if (pageNumber === 2) {
          page1.classList.remove('active');
          page2.classList.add('active');
          if (page1Indicator) page1Indicator.classList.remove('active');
          if (page1Indicator) page1Indicator.classList.add('completed');
          if (page2Indicator) page2Indicator.classList.add('active');

          // Scroll to the top of page 2
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        console.log('Navigated to page', pageNumber);
      }

      // Next page button click handler
      if (nextPageBtn) {
        nextPageBtn.addEventListener('click', function() {
          // Validate recipient selection
          const hasRecipients = selectedRecipients.length > 0;
          if (!hasRecipients) {
            alert('Please select at least one recipient before proceeding.');
            return;
          }

          goToPage(2);
        });
      }

      // Previous page button handler removed as the button was removed

      // Initialize recipient selection
      if (typeof initRecipientSelection === 'function') {
        initRecipientSelection();
      } else {
        console.error('Recipient selection functionality not loaded');
      }

      // Initialize language selection
      if (typeof initLanguageSelection === 'function') {
        initLanguageSelection();
      } else {
        console.error('Language selection functionality not loaded');
      }

      // Show compose form when create button is clicked
      createNotificationBtn.addEventListener('click', function() {
        // Hide notifications view
        const notificationsView = document.getElementById('notificationsView');
        if (notificationsView) {
          notificationsView.classList.add('hidden');
        }

        // Show and activate compose form
        if (composeForm) {
          composeForm.classList.remove('hidden');
          composeForm.classList.add('active');
        }

        // Hide notification list
        if (notificationList) {
          notificationList.style.display = 'none';
        }

        // Reset to page 1
        goToPage(1);

        // Reset recipient selection
        if (typeof deselectAllRecipients === 'function') {
          deselectAllRecipients();
        }

        console.log('Create notification button clicked - showing compose form');
      });

      // Show compose form when empty state create button is clicked
      emptyStateCreateBtn.addEventListener('click', function() {
        // Hide notifications view
        const notificationsView = document.getElementById('notificationsView');
        if (notificationsView) {
          notificationsView.classList.add('hidden');
        }

        // Show and activate compose form
        if (composeForm) {
          composeForm.classList.remove('hidden');
          composeForm.classList.add('active');
        }

        // Hide notification list
        if (notificationList) {
          notificationList.style.display = 'none';
        }

        // Reset to page 1
        goToPage(1);

        // Reset recipient selection
        if (typeof deselectAllRecipients === 'function') {
          deselectAllRecipients();
        }

        console.log('Empty state create button clicked - showing compose form');
      });

      // Function to handle cancel button clicks - defined in global scope
      window.handleCancelClick = function() {
        const composeForm = document.getElementById('composeForm');
        const notificationList = document.getElementById('notificationList');

        if (composeForm) composeForm.classList.remove('active');
        if (notificationList) notificationList.style.display = 'block';

        // Check if notification list is empty and show empty state if needed
        if (typeof checkAndShowEmptyState === 'function') {
          checkAndShowEmptyState();
        }

        // Reset form fields
        const titleInput = document.getElementById('notificationTitle');
        if (titleInput) titleInput.value = '';

        const typeSelect = document.getElementById('notificationType');
        if (typeSelect) typeSelect.value = '';

        // Reset Quill editor if it exists
        try {
          const quill = Quill.find(document.getElementById('editor'));
          if (quill) quill.setText('');

          const contentInput = document.getElementById('notificationContent');
          if (contentInput) contentInput.value = '';
        } catch (e) {
          console.log('Quill editor not initialized yet');
        }

        // Reset recipient selection
        if (typeof deselectAllRecipients === 'function') {
          deselectAllRecipients();
        }

        // Reset to page 1 for next time
        if (typeof goToPage === 'function') {
          goToPage(1);
        }

        console.log('Cancel button clicked - form closed');
        return false; // Prevent default button behavior
      }

      // Hide compose form when cancel button on page 1 is clicked
      if (cancelBtnPage1) {
        cancelBtnPage1.addEventListener('click', handleCancelClick);
      } else {
        console.error('Cancel button on page 1 not found in the DOM');
      }

      // Hide compose form when cancel button on page 2 is clicked
      if (cancelBtnPage2) {
        cancelBtnPage2.addEventListener('click', handleCancelClick);
      } else {
        console.error('Cancel button on page 2 not found in the DOM');
      }

      // Save notification draft
      saveBtn.addEventListener('click', function() {
        const type = document.getElementById('notificationType').value;

        // Get language content
        let languageData = { languages: [], content: {} };
        if (typeof getAllLanguageContent === 'function') {
          languageData = getAllLanguageContent();
        }

        // Get recipients by language
        let recipientsByLanguage = {};
        if (typeof getRecipientsByLanguage === 'function') {
          recipientsByLanguage = getRecipientsByLanguage();
        }

        // Validate language content
        let languageValidation = { isValid: true, missingFields: [] };
        if (typeof validateLanguageContent === 'function') {
          languageValidation = validateLanguageContent();
        }

        // Check if recipients are selected
        const hasRecipients = Object.keys(recipientsByLanguage).length > 0;

        // Validate form
        if (!type) {
          alert('Please select a notification type');
          return;
        }

        if (!hasRecipients) {
          alert('Please select at least one recipient');
          return;
        }

        if (!languageValidation.isValid) {
          alert(`Please fill in all required fields for the following languages: ${languageValidation.missingFields.join(', ')}`);
          return;
        }

        // In a real application, you would save this to a database
        // For now, we'll just show a success message with recipient and language info
        const totalRecipients = Object.values(recipientsByLanguage)
          .reduce((total, recipients) => total + recipients.length, 0);
        const contentLanguageCount = languageData.languages.length;

        // Create a summary of recipients by language
        let recipientSummary = '';
        Object.entries(recipientsByLanguage).forEach(([langCode, recipients]) => {
          const language = availableLanguages.find(lang => lang.code === langCode);
          const langName = language ? language.name : langCode;
          recipientSummary += `\n- ${langName}: ${recipients.length} recipients`;
        });

        alert(`Notification draft saved successfully!\n\nTotal: ${totalRecipients} recipients in ${contentLanguageCount} languages${recipientSummary}`);

        // Hide compose form and show notification list
        composeForm.classList.remove('active');
        notificationList.style.display = 'block';

        // Reset form fields
        document.getElementById('notificationType').value = '';

        // Reset recipient selection
        if (typeof deselectAllRecipients === 'function') {
          deselectAllRecipients();
        }

        // Reset to page 1 for next time
        goToPage(1);

        // Reset language selection (will be reinitialized when form opens again)
        if (typeof initLanguageSelection === 'function') {
          // We'll reinitialize when the form opens again
        }

        // Create language tags for the notification card
        const languageTags = languageData.languages
          .map(langCode => {
            const language = availableLanguages.find(lang => lang.code === langCode);
            return `<span class="notification-tag">${language ? language.flag : ''} ${language ? language.name : langCode}</span>`;
          })
          .join('');

        // Get the primary language content (first language) for display
        const primaryLanguage = languageData.languages[0];
        const primaryContent = languageData.content[primaryLanguage] || { title: 'Untitled', content: 'No content' };

        // Remove empty state and add a sample notification card
        notificationList.innerHTML = `
          <div class="notification-card unread" data-notification-id="${Date.now()}">
            <div class="notification-actions">
              <button class="notification-action-btn mark-read-btn" title="Mark as Read">
                <span class="material-icons">mark_email_read</span>
              </button>
              <button class="notification-action-btn delete-btn" title="Move to Trash">
                <span class="material-icons">delete</span>
              </button>
            </div>
            <div class="unread-indicator"></div>
            <h3 class="notification-title">${primaryContent.title}</h3>
            <div class="notification-meta">
              <span>Draft</span>
              <span>Just now</span>
            </div>
            <div class="notification-content">${primaryContent.content}</div>
            <div class="notification-footer">
              <div class="notification-tags">
                <span class="notification-tag">${type}</span>
                ${languageTags}
              </div>
              <span>${totalRecipients} recipients</span>
            </div>
          </div>
        `;
      });
    });
  </script>

  <!-- Notification Alert Script -->
  <script src="notification-alert.js"></script>

  <!-- Recipient Selection Script -->
  <script src="recipient-selection.js"></script>

  <!-- Inline Recipient Selection Script (for immediate functionality) -->
  <script>
    // Store selected recipients
    let selectedRecipients = [];

    document.addEventListener('DOMContentLoaded', function() {
      // No need for tab switching since we only have one tab now
      // Make sure the translation management tab is visible
      const translationManagementTab = document.getElementById('translation-management-tab');
      if (translationManagementTab) {
        translationManagementTab.classList.remove('hidden');
      }

      // Initialize request translation button
      const requestTranslationBtn = document.getElementById('requestTranslationBtn');
      if (requestTranslationBtn) {
        requestTranslationBtn.addEventListener('click', function() {
          // Get all pending translation rows
          const pendingRows = document.querySelectorAll('.translation-row .translation-status.pending');

          if (pendingRows.length === 0) {
            alert('No pending translations to request.');
            return;
          }

          // Update status to "Requested"
          pendingRows.forEach(status => {
            status.textContent = 'Requested';
            status.classList.remove('pending');
            status.classList.add('requested');
          });

          // Enable approve button
          const approveBtn = document.getElementById('approveTranslationBtn');
          if (approveBtn) {
            approveBtn.disabled = false;
          }

          alert(`Translation requested for ${pendingRows.length} language(s).`);
        });
      }

      // Initialize approve translations button
      const approveTranslationBtn = document.getElementById('approveTranslationBtn');
      if (approveTranslationBtn) {
        approveTranslationBtn.addEventListener('click', function() {
          // Get all requested translation rows
          const requestedRows = document.querySelectorAll('.translation-row .translation-status.requested');

          if (requestedRows.length === 0) {
            alert('No requested translations to approve.');
            return;
          }

          // Update status to "Approved"
          requestedRows.forEach(status => {
            status.textContent = 'Approved';
            status.classList.remove('requested');
            status.classList.add('approved');
          });

          alert(`Translations approved for ${requestedRows.length} language(s).`);
        });
      }

      // Add event listeners to recipient checkboxes
      const recipientCheckboxes = document.querySelectorAll('.recipient-item input[type="checkbox"]');
      recipientCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const recipientItem = this.closest('.recipient-item');
          const userId = parseInt(recipientItem.dataset.userId);
          const userName = recipientItem.querySelector('.recipient-name').textContent;
          const userLanguage = recipientItem.dataset.language;
          const userRole = recipientItem.querySelector('.recipient-role').textContent;

          if (this.checked) {
            // Add to selected recipients
            selectedRecipients.push({
              id: userId,
              name: userName,
              language: userLanguage,
              role: userRole
            });
          } else {
            // Remove from selected recipients
            selectedRecipients = selectedRecipients.filter(recipient => recipient.id !== userId);
          }

          // Update language grouping
          updateLanguageGrouping();
        });
      });

      // Initialize select all and deselect all buttons
      const selectAllBtn = document.querySelector('.recipient-actions button:first-child');
      const deselectAllBtn = document.querySelector('.recipient-actions button:last-child');

      if (selectAllBtn) {
        selectAllBtn.addEventListener('click', function() {
          const visibleCheckboxes = document.querySelectorAll('.recipient-item:not([style*="display: none"]) input[type="checkbox"]');
          visibleCheckboxes.forEach(checkbox => {
            if (!checkbox.checked) {
              checkbox.checked = true;
              checkbox.dispatchEvent(new Event('change'));
            }
          });
        });
      }

      if (deselectAllBtn) {
        deselectAllBtn.addEventListener('click', function() {
          const checkedBoxes = document.querySelectorAll('.recipient-item input[type="checkbox"]:checked');
          checkedBoxes.forEach(checkbox => {
            checkbox.checked = false;
            checkbox.dispatchEvent(new Event('change'));
          });
        });
      }

      // Initialize filter radio buttons
      const filterRadios = document.querySelectorAll('input[name="recipientFilter"]');
      filterRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          // Hide all sub-filters
          const subFilters = document.querySelectorAll('.sub-filter');
          subFilters.forEach(filter => filter.classList.add('hidden'));

          // Show the selected sub-filter
          if (this.value !== 'all' && this.value !== 'downline') {
            const subFilter = document.querySelector(`.${this.value}-filter`);
            if (subFilter) {
              subFilter.classList.remove('hidden');
            }
          }

          // Apply filter
          applyFilter();
        });
      });

      // Initialize sub-filter selects
      const filterSelects = document.querySelectorAll('.sub-filter select');
      filterSelects.forEach(select => {
        select.addEventListener('change', applyFilter);
      });

      // Initialize individual search
      const individualSearch = document.getElementById('individualSearch');
      if (individualSearch) {
        individualSearch.addEventListener('input', applyFilter);
      }

      // Initialize recipient search
      const recipientSearch = document.getElementById('recipientSearch');
      if (recipientSearch) {
        recipientSearch.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase();
          const recipientItems = document.querySelectorAll('.recipient-item');

          recipientItems.forEach(item => {
            const name = item.querySelector('.recipient-name').textContent.toLowerCase();
            const details = item.querySelector('.recipient-details').textContent.toLowerCase();

            if (name.includes(searchTerm) || details.includes(searchTerm)) {
              item.style.display = '';
            } else {
              item.style.display = 'none';
            }
          });
        });
      }
    });

    // Apply filter based on selected option
    function applyFilter() {
      const selectedFilter = document.querySelector('input[name="recipientFilter"]:checked').value;
      const recipientItems = document.querySelectorAll('.recipient-item');

      // Reset display
      recipientItems.forEach(item => {
        item.style.display = '';
      });

      // Apply specific filter
      switch (selectedFilter) {
        case 'all':
          // Show all users
          break;

        case 'downline':
          // For demo, we'll use user ID 1 as current user
          const currentUserId = 1;
          // In this simple example, users 2 and 3 report to user 1
          const downlineUserIds = [2, 3];

          recipientItems.forEach(item => {
            const userId = parseInt(item.dataset.userId);
            if (!downlineUserIds.includes(userId) && userId !== currentUserId) {
              item.style.display = 'none';
            }
          });
          break;

        case 'company':
          const selectedCompany = document.getElementById('companySelect').value;
          if (selectedCompany) {
            recipientItems.forEach(item => {
              const company = item.querySelector('.recipient-company').textContent;
              if (company !== selectedCompany) {
                item.style.display = 'none';
              }
            });
          }
          break;

        case 'team':
          const selectedTeam = document.getElementById('teamSelect').value;
          if (selectedTeam) {
            recipientItems.forEach(item => {
              const team = item.querySelector('.recipient-team').textContent;
              if (team !== selectedTeam) {
                item.style.display = 'none';
              }
            });
          }
          break;

        case 'role':
          const selectedRole = document.getElementById('roleSelect').value;
          if (selectedRole) {
            recipientItems.forEach(item => {
              const role = item.querySelector('.recipient-role').textContent;
              if (role !== selectedRole) {
                item.style.display = 'none';
              }
            });
          }
          break;

        case 'individual':
          const searchTerm = document.getElementById('individualSearch').value.toLowerCase();
          if (searchTerm) {
            recipientItems.forEach(item => {
              const name = item.querySelector('.recipient-name').textContent.toLowerCase();
              if (!name.includes(searchTerm)) {
                item.style.display = 'none';
              }
            });
          }
          break;
      }
    }

    // Update language grouping based on selected recipients
    function updateLanguageGrouping() {
      const languageGroupingContainer = document.getElementById('languageGrouping');
      if (!languageGroupingContainer) return;

      if (selectedRecipients.length === 0) {
        // Show empty state
        languageGroupingContainer.innerHTML = `
          <div class="language-grouping-empty">
            <p>Select recipients to see language grouping</p>
          </div>
        `;

        // Clear translation management table
        updateTranslationManagementTable({});
        return;
      }

      // Group recipients by language
      const groupedRecipients = {};
      selectedRecipients.forEach(recipient => {
        if (!groupedRecipients[recipient.language]) {
          groupedRecipients[recipient.language] = [];
        }
        groupedRecipients[recipient.language].push(recipient);
      });

      // Create language groups HTML
      let groupsHTML = '';
      Object.keys(groupedRecipients).forEach(language => {
        const recipients = groupedRecipients[language];
        const recipientCount = recipients.length;

        groupsHTML += `
          <div class="language-group">
            <div class="language-group-header">
              <h4>${language}</h4>
              <span class="recipient-count">${recipientCount} recipient${recipientCount !== 1 ? 's' : ''}</span>
            </div>
            <div class="language-group-recipients">
              ${recipients.map(recipient => `
                <div class="language-group-recipient">
                  <span class="recipient-name">${recipient.name}</span>
                  <span class="recipient-role">${recipient.role}</span>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      });

      // Update container
      languageGroupingContainer.innerHTML = `
        <div class="language-grouping-header">
          <h3>Recipients by Language</h3>
          <div class="language-grouping-summary">
            <span class="total-recipients">${selectedRecipients.length} total recipients</span>
            <span class="language-count">${Object.keys(groupedRecipients).length} languages</span>
          </div>
        </div>
        <div class="language-groups">
          ${groupsHTML}
        </div>
      `;

      // Update translation management table with the grouped recipients
      updateTranslationManagementTable(groupedRecipients);
    }

    // Function to update the translation management table based on recipient languages
    function updateTranslationManagementTable(groupedRecipients) {
      const translationStatusList = document.getElementById('translationStatusList');
      if (!translationStatusList) return;

      // If no recipients are selected, show empty state
      if (Object.keys(groupedRecipients).length === 0) {
        translationStatusList.innerHTML = `
          <tr class="translation-empty-row">
            <td colspan="5">
              <div class="translation-status-empty">
                <p>No translations requested yet</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      // Get the default language (English if available, otherwise first language)
      const defaultLanguage = groupedRecipients['English'] ? 'English' : Object.keys(groupedRecipients)[0];

      // Create rows for each language except the default
      let rowsHTML = '';
      Object.keys(groupedRecipients).forEach(language => {
        // Skip the default language as it doesn't need translation
        if (language === defaultLanguage) return;

        // Get language details from availableLanguages if possible
        const languageInfo = availableLanguages.find(lang =>
          lang.name === language || lang.code.toLowerCase() === language.toLowerCase()
        );

        const languageDisplay = languageInfo ?
          `${languageInfo.flag || ''} ${languageInfo.name}` :
          language;

        // Calculate a due date (3 business days from now)
        const dueDate = new Date();
        dueDate.setDate(dueDate.getDate() + 3);
        const formattedDueDate = dueDate.toLocaleDateString();

        // Add row for this language
        rowsHTML += `
          <tr class="translation-row" data-language="${language}">
            <td>${languageDisplay}</td>
            <td><span class="translation-status pending">Pending</span></td>
            <td>Auto-assigned</td>
            <td>${formattedDueDate}</td>
            <td>
              <button class="translation-action-btn view-btn" title="View Translation">
                <span class="material-icons">visibility</span>
              </button>
              <button class="translation-action-btn edit-btn" title="Edit Translation">
                <span class="material-icons">edit</span>
              </button>
            </td>
          </tr>
        `;
      });

      // If no languages need translation (only default language selected)
      if (!rowsHTML) {
        translationStatusList.innerHTML = `
          <tr class="translation-info-row">
            <td colspan="5">
              <div class="translation-status-info">
                <p style="color:black;">All recipients use ${defaultLanguage}. No translations needed.</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      // Update the table with the new rows
      translationStatusList.innerHTML = rowsHTML;

      // Enable the request translation button
      const requestTranslationBtn = document.getElementById('requestTranslationBtn');
      if (requestTranslationBtn) {
        requestTranslationBtn.disabled = false;
      }
    }

    // Helper functions for external access
    function selectAllVisibleRecipients() {
      const visibleCheckboxes = document.querySelectorAll('.recipient-item:not([style*="display: none"]) input[type="checkbox"]');
      visibleCheckboxes.forEach(checkbox => {
        if (!checkbox.checked) {
          checkbox.checked = true;
          checkbox.dispatchEvent(new Event('change'));
        }
      });
    }

    function deselectAllRecipients() {
      selectedRecipients = [];
      const checkedBoxes = document.querySelectorAll('.recipient-item input[type="checkbox"]:checked');
      checkedBoxes.forEach(checkbox => {
        checkbox.checked = false;
      });
      updateLanguageGrouping();
    }

    function getRecipientsByLanguage() {
      const recipientsByLanguage = {};
      selectedRecipients.forEach(recipient => {
        if (!recipientsByLanguage[recipient.language]) {
          recipientsByLanguage[recipient.language] = [];
        }
        recipientsByLanguage[recipient.language].push(recipient);
      });
      return recipientsByLanguage;
    }
  </script>

  <!-- Language Selection Script -->
  <script src="language-selection.js"></script>

  <!-- Debug Script -->
  <script src="check-scripts.js"></script>

  <!-- Rich Text Editor Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Quill rich text editor
      const quill = new Quill('#editor', {
        modules: {
          toolbar: [
            [{ 'header': [1, 2, 3, false] }],
            ['bold', 'italic', 'underline', 'strike'],
            [{ 'color': [] }, { 'background': [] }],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            ['link', 'blockquote'],
            ['clean']
          ]
        },
        placeholder: 'Enter notification message...',
        theme: 'snow'
      });

      // Update hidden input with editor content when editor changes
      quill.on('text-change', function() {
        document.getElementById('notificationContent').value = quill.root.innerHTML;
      });

      // Set initial content if needed (e.g., when editing an existing notification)
      // quill.root.innerHTML = initialContent;
    });
  </script>

  <!-- Preview Notification Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Preview functionality
      const previewBtn = document.getElementById('previewBtn');
      const previewModal = document.getElementById('previewModal');
      const closePreviewBtn = document.getElementById('closePreviewBtn');
      const previewLanguageSelect = document.getElementById('previewLanguageSelect');
      const previewDeviceSelect = document.getElementById('previewDeviceSelect');
      const previewRecipientTypeSelect = document.getElementById('previewRecipientTypeSelect');
      const previewDeviceFrame = document.getElementById('previewDeviceFrame');
      const previewNotification = document.getElementById('previewNotification');

      // Mock translations for different languages
      const mockTranslations = {
        'en': {
          default: 'Original content in English',
          'Untitled Notification': 'Untitled Notification',
          'No content': 'No content',
          'Response required within': 'Response required within',
          'No response required': 'No response required',
          'Acknowledge': 'Acknowledge',
          'Reply': 'Reply',
          'day': 'day',
          'days': 'days',
          'hour': 'hour',
          'hours': 'hours',
          'minute': 'minute',
          'minutes': 'minutes',
          'immediately': 'immediately',
          'recipient': 'recipient',
          'recipients': 'recipients',
          'selected': 'selected',
          'customer': 'customer',
          'employee': 'employee',
          'partner': 'partner',
          'This is a sample content for the': 'This is a sample content for the',
          'template': 'template',
          'You can edit this content using the rich text editor tools above.': 'You can edit this content using the rich text editor tools above.'
        },
        'es': {
          default: 'Contenido traducido al español',
          'Untitled Notification': 'Notificación sin título',
          'No content': 'Sin contenido',
          'Response required within': 'Respuesta requerida dentro de',
          'No response required': 'No se requiere respuesta',
          'Acknowledge': 'Confirmar',
          'Reply': 'Responder',
          'day': 'día',
          'days': 'días',
          'hour': 'hora',
          'hours': 'horas',
          'minute': 'minuto',
          'minutes': 'minutos',
          'immediately': 'inmediatamente',
          'recipient': 'destinatario',
          'recipients': 'destinatarios',
          'selected': 'seleccionados',
          'customer': 'cliente',
          'employee': 'empleado',
          'partner': 'socio',
          'This is a sample content for the': 'Este es un contenido de muestra para la',
          'template': 'plantilla',
          'You can edit this content using the rich text editor tools above.': 'Puede editar este contenido utilizando las herramientas del editor de texto enriquecido anteriores.'
        },
        'fr': {
          default: 'Contenu traduit en français',
          'Untitled Notification': 'Notification sans titre',
          'No content': 'Pas de contenu',
          'Response required within': 'Réponse requise dans',
          'No response required': 'Aucune réponse requise',
          'Acknowledge': 'Accuser réception',
          'Reply': 'Répondre',
          'day': 'jour',
          'days': 'jours',
          'hour': 'heure',
          'hours': 'heures',
          'minute': 'minute',
          'minutes': 'minutes',
          'immediately': 'immédiatement',
          'recipient': 'destinataire',
          'recipients': 'destinataires',
          'selected': 'sélectionnés'
        },
        'de': {
          default: 'Ins Deutsche übersetzter Inhalt',
          'Untitled Notification': 'Unbenannte Benachrichtigung',
          'No content': 'Kein Inhalt',
          'Response required within': 'Antwort erforderlich innerhalb von',
          'No response required': 'Keine Antwort erforderlich',
          'Acknowledge': 'Bestätigen',
          'Reply': 'Antworten',
          'day': 'Tag',
          'days': 'Tage',
          'hour': 'Stunde',
          'hours': 'Stunden',
          'minute': 'Minute',
          'minutes': 'Minuten',
          'immediately': 'sofort',
          'recipient': 'Empfänger',
          'recipients': 'Empfänger',
          'selected': 'ausgewählt'
        },
        'zh': {
          default: '翻译成中文的内容',
          'Untitled Notification': '无标题通知',
          'No content': '无内容',
          'Response required within': '需要在以下时间内回复',
          'No response required': '无需回复',
          'Acknowledge': '确认',
          'Reply': '回复',
          'day': '天',
          'days': '天',
          'hour': '小时',
          'hours': '小时',
          'minute': '分钟',
          'minutes': '分钟',
          'immediately': '立即',
          'recipient': '收件人',
          'recipients': '收件人',
          'selected': '已选择'
        },
        'ja': {
          default: '日本語に翻訳されたコンテンツ',
          'Untitled Notification': '無題の通知',
          'No content': 'コンテンツなし',
          'Response required within': '以内に応答が必要',
          'No response required': '応答は必要ありません',
          'Acknowledge': '確認',
          'Reply': '返信',
          'day': '日',
          'days': '日',
          'hour': '時間',
          'hours': '時間',
          'minute': '分',
          'minutes': '分',
          'immediately': '直ちに',
          'recipient': '受信者',
          'recipients': '受信者',
          'selected': '選択済み'
        }
      };

      // Function to translate text based on selected language
      function translateText(text, language) {
        if (!language || language === 'en') {
          return text; // Return original text for English
        }

        // Get translations for the selected language
        const translations = mockTranslations[language];
        if (!translations) {
          return text; // Return original if no translations available
        }

        // Check if we have a direct translation
        if (translations[text]) {
          return translations[text];
        }

        // For longer content, return the default translated content
        if (text.length > 20) {
          return translations.default;
        }

        return text; // Return original as fallback
      }

      // Sample recipient data for personalization
      const sampleRecipients = {
        customer: {
          name: 'John Smith',
          id: 'CUST-12345',
          company: 'Acme Corp',
          lastVisit: '2023-05-15'
        },
        employee: {
          name: 'Sarah Johnson',
          id: 'EMP-7890',
          department: 'Service',
          role: 'Technician'
        },
        partner: {
          name: 'Robert Chen',
          id: 'PART-4567',
          company: 'Chen Auto Parts',
          partnerType: 'Supplier'
        }
      };

      // Open preview modal
      previewBtn.addEventListener('click', function() {
        // Get notification data
        const title = document.getElementById('notificationTitle').value || 'Untitled Notification';
        const type = document.getElementById('notificationType').value || 'info';
        const quill = Quill.find(document.getElementById('editor'));
        const content = quill.root.innerHTML || '<p>No content</p>';

        // Get languages from selected recipients
        let recipientLanguages = [];
        if (selectedRecipients.length > 0) {
          // Extract unique languages from selected recipients
          const uniqueLanguages = [...new Set(selectedRecipients.map(r => r.language))];

          // Map language names to language codes and details
          recipientLanguages = uniqueLanguages.map(langName => {
            // Try to find the language in availableLanguages
            const langInfo = availableLanguages.find(l =>
              l.name === langName || l.code.toLowerCase() === langName.toLowerCase()
            );

            if (langInfo) {
              return langInfo;
            } else {
              // Create a basic entry if not found
              return {
                code: langName.toLowerCase().substring(0, 2),
                name: langName,
                flag: '🌐'
              };
            }
          });

          // Ensure English is always available as the default
          if (!recipientLanguages.some(l => l.code === 'en')) {
            recipientLanguages.unshift({ code: 'en', name: 'English', flag: '🇺🇸' });
          }
        } else {
          // Fallback to sample languages if no recipients selected
          recipientLanguages = [
            { code: 'en', name: 'English', flag: '🇺🇸' },
            { code: 'es', name: 'Spanish', flag: '🇪🇸' },
            { code: 'fr', name: 'French', flag: '🇫🇷' },
            { code: 'de', name: 'German', flag: '🇩🇪' },
            { code: 'zh', name: 'Chinese', flag: '🇨🇳' },
            { code: 'ja', name: 'Japanese', flag: '🇯🇵' }
          ];
        }

        // Populate language select
        previewLanguageSelect.innerHTML = '';
        recipientLanguages.forEach(lang => {
          const option = document.createElement('option');
          option.value = lang.code;
          option.textContent = `${lang.flag || ''} ${lang.name}`;
          previewLanguageSelect.appendChild(option);
        });

        // Update recipient count
        const recipientCount = selectedRecipients.length;
        previewRecipientCount.textContent = `${recipientCount} recipient${recipientCount !== 1 ? 's' : ''} selected`;

        // Generate preview
        updatePreview();

        // Show modal
        previewModal.classList.add('active');
      });

      // Close preview modal
      closePreviewBtn.addEventListener('click', function() {
        previewModal.classList.remove('active');
      });

      // Update preview when controls change
      previewLanguageSelect.addEventListener('change', updatePreview);
      previewDeviceSelect.addEventListener('change', function() {
        // Update device frame
        previewDeviceFrame.className = `preview-device ${this.value}`;
        updatePreview();
      });
      previewRecipientTypeSelect.addEventListener('change', updatePreview);

      // Update preview content
      function updatePreview() {
        // Get current values
        const language = previewLanguageSelect.value;
        const deviceType = previewDeviceSelect.value;
        const recipientType = previewRecipientTypeSelect.value;

        // Get notification data
        const title = document.getElementById('notificationTitle').value || 'Untitled Notification';
        const type = document.getElementById('notificationType').value || 'info';
        const quill = Quill.find(document.getElementById('editor'));
        let content = quill.root.innerHTML || '<p>No content</p>';

        // Get recipient data for personalization
        const recipient = sampleRecipients[recipientType];

        // Personalize content with recipient data
        if (recipient) {
          content = content.replace(/\{name\}/g, recipient.name);
          content = content.replace(/\{id\}/g, recipient.id);
          content = content.replace(/\{company\}/g, recipient.company || '');

          // Add recipient-specific content
          if (recipientType === 'customer') {
            content = content.replace(/\{lastVisit\}/g, recipient.lastVisit);
          } else if (recipientType === 'employee') {
            content = content.replace(/\{department\}/g, recipient.department);
            content = content.replace(/\{role\}/g, recipient.role);
          } else if (recipientType === 'partner') {
            content = content.replace(/\{partnerType\}/g, recipient.partnerType);
          }
        }

        // Translate title and content based on selected language
        const translatedTitle = translateText(title, language);

        // For content, we'll use a more comprehensive approach for demo
        let translatedContent = content;

        if (language !== 'en') {
          // Check if it's the default content or empty
          if (content.includes('No content')) {
            translatedContent = translatedContent.replace('No content', translateText('No content', language));
          } else if (content.includes('This is a sample content for the')) {
            // Handle the sample content specifically to match the screenshot
            translatedContent = `<p>${translateText('This is a sample content for the', language)}</p>
            <p><strong>${translatedTitle}</strong> ${translateText('template', language)}.</p>
            <p>${translateText('You can edit this content using the rich text editor tools above.', language)}</p>`;
          } else {
            // For other content, try to translate key phrases while preserving HTML structure
            // This is a simplified approach - in a real app you would use a proper HTML parser

            // First preserve HTML tags by replacing them with placeholders
            const htmlTags = [];
            let contentWithoutTags = translatedContent.replace(/<[^>]+>/g, match => {
              htmlTags.push(match);
              return `__TAG${htmlTags.length - 1}__`;
            });

            // Now translate the text content
            contentWithoutTags = mockTranslations[language]?.default || contentWithoutTags;

            // Restore HTML tags
            translatedContent = contentWithoutTags.replace(/__TAG(\d+)__/g, (match, index) => {
              return htmlTags[parseInt(index)];
            });
          }
        }

        // Get current date/time for preview with localization
        const now = new Date();
        const formattedDate = now.toLocaleDateString(language !== 'en' ? language : undefined);
        const formattedTime = now.toLocaleTimeString(language !== 'en' ? language : undefined, { hour: '2-digit', minute: '2-digit' });

        // Get response time information with translation
        let responseTimeText = '';
        const selectedResponseOption = document.querySelector('input[name="responseTimeOption"]:checked')?.value;

        if (selectedResponseOption) {
          switch (selectedResponseOption) {
            case 'default':
              responseTimeText = `<div class="preview-notification-response-time">${translateText('Response required within', language)} 24 ${translateText('hours', language)}</div>`;
              break;

            case 'custom':
              const days = parseInt(document.getElementById('responseDays')?.value) || 0;
              const hours = parseInt(document.getElementById('responseHours')?.value) || 0;
              const minutes = parseInt(document.getElementById('responseMinutes')?.value) || 0;

              // Format the time string with translations
              let timeString = '';

              if (days > 0) {
                timeString += `${days} ${translateText(days !== 1 ? 'days' : 'day', language)}`;
              }

              if (hours > 0) {
                if (timeString) timeString += ', ';
                timeString += `${hours} ${translateText(hours !== 1 ? 'hours' : 'hour', language)}`;
              }

              if (minutes > 0) {
                if (timeString) timeString += ', ';
                timeString += `${minutes} ${translateText(minutes !== 1 ? 'minutes' : 'minute', language)}`;
              }

              if (!timeString) {
                timeString = translateText('immediately', language);
              }

              responseTimeText = `<div class="preview-notification-response-time">${translateText('Response required within', language)} ${timeString}</div>`;
              break;

            case 'none':
              responseTimeText = `<div class="preview-notification-response-time">${translateText('No response required', language)}</div>`;
              break;
          }
        }

        // Get language display information
        const languageInfo = availableLanguages.find(lang => lang.code === language);
        const languageDisplay = languageInfo ?
          `${languageInfo.flag || ''} ${languageInfo.name}` :
          language;

        // Create notification HTML with translations - matching the screenshot layout
        const notificationHTML = `
          <h3 class="preview-notification-title">${translatedTitle}</h3>
          <div class="preview-notification-meta">
            <span>${formattedDate}</span>
            <span>${formattedTime}</span>
          </div>
          <div class="preview-notification-content">
            ${translatedContent}
          </div>
          ${responseTimeText}
          <div class="preview-notification-footer">
            <div class="preview-notification-tags">
              <span class="preview-notification-tag">${type}</span>
              ${language !== 'en' ? `<span class="preview-notification-tag language-tag">${language}</span>` : ''}
            </div>
            <div class="preview-recipient-info">
              For: ${translateText(recipientType, language)}
            </div>
          </div>
        `;

        // Update preview
        previewNotification.innerHTML = notificationHTML;

        // Update recipient count with translations
        const recipientCount = selectedRecipients.length;
        const recipientText = recipientCount === 1 ? 'recipient' : 'recipients';
        previewRecipientCount.textContent = `${recipientCount} ${translateText(recipientText, language)} ${translateText('selected', language)}`;
      }
    });
  </script>

  <!-- Edit Recipients Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Edit recipients functionality
      const editRecipientsBtn = document.getElementById('editRecipientsBtn');
      const editRecipientsModal = document.getElementById('editRecipientsModal');
      const closeEditRecipientsBtn = document.getElementById('closeEditRecipientsBtn');
      const addMoreRecipientsBtn = document.getElementById('addMoreRecipientsBtn');
      const saveRecipientsBtn = document.getElementById('saveRecipientsBtn');
      const addRecipientsSection = document.getElementById('addRecipientsSection');
      const closeAddRecipientsBtn = document.getElementById('closeAddRecipientsBtn');
      const selectedRecipientsList = document.getElementById('selectedRecipientsList');
      const selectedRecipientCount = document.getElementById('selectedRecipientCount');
      const editRecipientList = document.getElementById('editRecipientList');
      const editRecipientSearch = document.getElementById('editRecipientSearch');
      const editSelectAllBtn = document.getElementById('editSelectAllBtn');
      const editRecipientsLanguageTabs = document.getElementById('editRecipientsLanguageTabs');

      // Open edit recipients modal
      if (editRecipientsBtn) {
        editRecipientsBtn.addEventListener('click', function() {
          // Clone recipient list to edit modal
          if (editRecipientList) {
            const originalList = document.getElementById('recipientList');
            if (originalList) {
              editRecipientList.innerHTML = originalList.innerHTML;

              // Add event listeners to checkboxes in the cloned list
              const checkboxes = editRecipientList.querySelectorAll('input[type="checkbox"]');
              checkboxes.forEach(checkbox => {
                // Set initial state based on selected recipients
                const userId = parseInt(checkbox.dataset.userId);
                const isSelected = selectedRecipients.some(recipient => recipient.id === userId);
                checkbox.checked = isSelected;

                // Add change event listener
                checkbox.addEventListener('change', function() {
                  const recipientItem = this.closest('.recipient-item');
                  const userId = parseInt(recipientItem.dataset.userId);
                  const userName = recipientItem.querySelector('.recipient-name').textContent;
                  const userLanguage = recipientItem.dataset.language;
                  const userRole = recipientItem.querySelector('.recipient-role').textContent;

                  if (this.checked) {
                    // Add to temporary selected recipients
                    if (!tempSelectedRecipients.some(r => r.id === userId)) {
                      tempSelectedRecipients.push({
                        id: userId,
                        name: userName,
                        language: userLanguage,
                        role: userRole
                      });
                    }
                  } else {
                    // Remove from temporary selected recipients
                    tempSelectedRecipients = tempSelectedRecipients.filter(r => r.id !== userId);
                  }

                  // Update selected recipients list in modal
                  updateSelectedRecipientsList();
                });
              });
            }
          }

          // Clone filter options to edit modal
          const editRecipientFilterOptions = document.getElementById('editRecipientFilterOptions');
          if (editRecipientFilterOptions) {
            const originalFilterOptions = document.getElementById('recipientFilterOptions');
            if (originalFilterOptions) {
              editRecipientFilterOptions.innerHTML = originalFilterOptions.innerHTML;

              // Add event listeners to filter radio buttons
              const filterRadios = editRecipientFilterOptions.querySelectorAll('input[name="recipientFilter"]');
              filterRadios.forEach(radio => {
                radio.name = 'editRecipientFilter'; // Change name to avoid conflict
                radio.addEventListener('change', function() {
                  // Hide all sub-filters
                  const subFilters = editRecipientFilterOptions.querySelectorAll('.sub-filter');
                  subFilters.forEach(filter => filter.classList.add('hidden'));

                  // Show the selected sub-filter
                  if (this.value !== 'all' && this.value !== 'downline') {
                    const subFilter = editRecipientFilterOptions.querySelector(`.${this.value}-filter`);
                    if (subFilter) {
                      subFilter.classList.remove('hidden');
                    }
                  }

                  // Apply filter to edit recipient list
                  applyEditFilter();
                });
              });

              // Initialize sub-filter selects
              const filterSelects = editRecipientFilterOptions.querySelectorAll('.sub-filter select');
              filterSelects.forEach(select => {
                select.addEventListener('change', applyEditFilter);
              });
            }
          }

          // Create temporary copy of selected recipients
          tempSelectedRecipients = [...selectedRecipients];

          // Update selected recipients list in modal
          updateSelectedRecipientsList();

          // Show modal
          editRecipientsModal.classList.add('active');
        });
      }

      // Close edit recipients modal
      if (closeEditRecipientsBtn) {
        closeEditRecipientsBtn.addEventListener('click', function() {
          editRecipientsModal.classList.remove('active');
          // Discard changes by not updating selectedRecipients
        });
      }

      // Toggle add recipients section
      if (addMoreRecipientsBtn) {
        addMoreRecipientsBtn.addEventListener('click', function() {
          addRecipientsSection.classList.toggle('hidden');
          this.style.display = addRecipientsSection.classList.contains('hidden') ? 'block' : 'none';
        });
      }

      // Close add recipients section
      if (closeAddRecipientsBtn) {
        closeAddRecipientsBtn.addEventListener('click', function() {
          addRecipientsSection.classList.add('hidden');
          addMoreRecipientsBtn.style.display = 'block';
        });
      }

      // Save recipients changes
      if (saveRecipientsBtn) {
        saveRecipientsBtn.addEventListener('click', function() {
          // Update main selected recipients list
          selectedRecipients = [...tempSelectedRecipients];

          // Update checkboxes in main recipient list
          const mainCheckboxes = document.querySelectorAll('#recipientList input[type="checkbox"]');
          mainCheckboxes.forEach(checkbox => {
            const userId = parseInt(checkbox.dataset.userId);
            checkbox.checked = selectedRecipients.some(recipient => recipient.id === userId);
          });

          // Update language grouping
          updateLanguageGrouping();

          // Close modal
          editRecipientsModal.classList.remove('active');
        });
      }

      // Search in edit recipient list
      if (editRecipientSearch) {
        editRecipientSearch.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase();
          const recipientItems = editRecipientList.querySelectorAll('.recipient-item');

          recipientItems.forEach(item => {
            const name = item.querySelector('.recipient-name').textContent.toLowerCase();
            const details = item.querySelector('.recipient-details').textContent.toLowerCase();

            if (name.includes(searchTerm) || details.includes(searchTerm)) {
              item.style.display = '';
            } else {
              item.style.display = 'none';
            }
          });
        });
      }

      // Select all visible recipients in edit modal
      if (editSelectAllBtn) {
        editSelectAllBtn.addEventListener('click', function() {
          const visibleCheckboxes = editRecipientList.querySelectorAll('.recipient-item:not([style*="display: none"]) input[type="checkbox"]');
          visibleCheckboxes.forEach(checkbox => {
            if (!checkbox.checked) {
              checkbox.checked = true;

              // Trigger change event
              const event = new Event('change');
              checkbox.dispatchEvent(event);
            }
          });
        });
      }

      // Apply filter to edit recipient list
      function applyEditFilter() {
        const selectedFilter = editRecipientsModal.querySelector('input[name="editRecipientFilter"]:checked').value;
        const recipientItems = editRecipientList.querySelectorAll('.recipient-item');

        // Reset display
        recipientItems.forEach(item => {
          item.style.display = '';
        });

        // Apply specific filter
        switch (selectedFilter) {
          case 'all':
            // Show all users
            break;

          case 'downline':
            // For demo, we'll use user ID 1 as current user
            const currentUserId = 1;
            // In this simple example, users 2 and 3 report to user 1
            const downlineUserIds = [2, 3];

            recipientItems.forEach(item => {
              const userId = parseInt(item.dataset.userId);
              if (!downlineUserIds.includes(userId) && userId !== currentUserId) {
                item.style.display = 'none';
              }
            });
            break;

          case 'company':
            const companySelect = editRecipientsModal.querySelector('#companySelect');
            if (companySelect) {
              const selectedCompany = companySelect.value;
              if (selectedCompany) {
                recipientItems.forEach(item => {
                  const company = item.querySelector('.recipient-company').textContent;
                  if (company !== selectedCompany) {
                    item.style.display = 'none';
                  }
                });
              }
            }
            break;

          case 'team':
            const teamSelect = editRecipientsModal.querySelector('#teamSelect');
            if (teamSelect) {
              const selectedTeam = teamSelect.value;
              if (selectedTeam) {
                recipientItems.forEach(item => {
                  const team = item.querySelector('.recipient-team').textContent;
                  if (team !== selectedTeam) {
                    item.style.display = 'none';
                  }
                });
              }
            }
            break;

          case 'role':
            const roleSelect = editRecipientsModal.querySelector('#roleSelect');
            if (roleSelect) {
              const selectedRole = roleSelect.value;
              if (selectedRole) {
                recipientItems.forEach(item => {
                  const role = item.querySelector('.recipient-role').textContent;
                  if (role !== selectedRole) {
                    item.style.display = 'none';
                  }
                });
              }
            }
            break;

          case 'individual':
            const individualSearch = editRecipientsModal.querySelector('#individualSearch');
            if (individualSearch) {
              const searchTerm = individualSearch.value.toLowerCase();
              if (searchTerm) {
                recipientItems.forEach(item => {
                  const name = item.querySelector('.recipient-name').textContent.toLowerCase();
                  if (!name.includes(searchTerm)) {
                    item.style.display = 'none';
                  }
                });
              }
            }
            break;
        }
      }

      // Update selected recipients list in modal
      function updateSelectedRecipientsList() {
        if (!selectedRecipientsList || !selectedRecipientCount) return;

        // Update count
        selectedRecipientCount.textContent = `${tempSelectedRecipients.length} recipient${tempSelectedRecipients.length !== 1 ? 's' : ''}`;

        // If no recipients selected, show empty message
        if (tempSelectedRecipients.length === 0) {
          selectedRecipientsList.innerHTML = '<div class="empty-selection-message">No recipients selected</div>';
          return;
        }

        // Group recipients by language
        const recipientsByLanguage = {};
        tempSelectedRecipients.forEach(recipient => {
          if (!recipientsByLanguage[recipient.language]) {
            recipientsByLanguage[recipient.language] = [];
          }
          recipientsByLanguage[recipient.language].push(recipient);
        });

        // Create language tabs
        let tabsHTML = '';
        Object.keys(recipientsByLanguage).forEach((language, index) => {
          tabsHTML += `
            <div class="language-tab ${index === 0 ? 'active' : ''}" data-language="${language}">
              ${language} (${recipientsByLanguage[language].length})
            </div>
          `;
        });

        editRecipientsLanguageTabs.innerHTML = tabsHTML;

        // Add event listeners to tabs
        const tabs = editRecipientsLanguageTabs.querySelectorAll('.language-tab');
        tabs.forEach(tab => {
          tab.addEventListener('click', function() {
            // Remove active class from all tabs
            tabs.forEach(t => t.classList.remove('active'));

            // Add active class to clicked tab
            this.classList.add('active');

            // Show recipients for selected language
            const language = this.dataset.language;
            showRecipientsForLanguage(language);
          });
        });

        // Show recipients for first language
        const firstLanguage = Object.keys(recipientsByLanguage)[0];
        showRecipientsForLanguage(firstLanguage);
      }

      // Show recipients for selected language
      function showRecipientsForLanguage(language) {
        if (!selectedRecipientsList) return;

        // Get recipients for language
        const recipients = tempSelectedRecipients.filter(recipient => recipient.language === language);

        // Create HTML for recipients
        let recipientsHTML = '';
        recipients.forEach(recipient => {
          recipientsHTML += `
            <div class="selected-recipient-item" data-user-id="${recipient.id}">
              <div class="recipient-info-compact">
                <div class="recipient-name-compact">${recipient.name}</div>
                <div class="recipient-details-compact">${recipient.role}</div>
              </div>
              <button class="remove-recipient-btn" data-user-id="${recipient.id}">
                <span class="material-icons">close</span>
              </button>
            </div>
          `;
        });

        // Update list
        selectedRecipientsList.innerHTML = recipientsHTML;

        // Add event listeners to remove buttons
        const removeButtons = selectedRecipientsList.querySelectorAll('.remove-recipient-btn');
        removeButtons.forEach(button => {
          button.addEventListener('click', function() {
            const userId = parseInt(this.dataset.userId);

            // Remove from temporary selected recipients
            tempSelectedRecipients = tempSelectedRecipients.filter(recipient => recipient.id !== userId);

            // Uncheck checkbox in edit recipient list
            const checkbox = editRecipientList.querySelector(`input[data-user-id="${userId}"]`);
            if (checkbox) {
              checkbox.checked = false;
            }

            // Update selected recipients list
            updateSelectedRecipientsList();
          });
        });
      }

      // Variable to store temporary selected recipients
      let tempSelectedRecipients = [];
    });
  </script>

  <!-- Response Time Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Response time functionality
      const responseTimeOptions = document.querySelectorAll('input[name="responseTimeOption"]');
      const customTimeInputs = document.getElementById('customTimeInputs');
      const responseTimeSummary = document.getElementById('responseTimeSummary');
      const responseDays = document.getElementById('responseDays');
      const responseHours = document.getElementById('responseHours');
      const responseMinutes = document.getElementById('responseMinutes');

      // Add event listeners to response time radio buttons
      responseTimeOptions.forEach(option => {
        option.addEventListener('change', function() {
          // Show/hide custom time inputs
          if (this.value === 'custom') {
            customTimeInputs.classList.remove('hidden');
          } else {
            customTimeInputs.classList.add('hidden');
          }

          // Update summary text
          updateResponseTimeSummary();
        });
      });

      // Add event listeners to custom time inputs
      [responseDays, responseHours, responseMinutes].forEach(input => {
        input.addEventListener('change', function() {
          // Ensure value is within min/max range
          const min = parseInt(this.min) || 0;
          const max = parseInt(this.max) || 0;
          let value = parseInt(this.value) || 0;

          if (value < min) value = min;
          if (value > max) value = max;

          this.value = value;

          // Update summary text
          updateResponseTimeSummary();
        });

        // Prevent non-numeric input
        input.addEventListener('keypress', function(e) {
          if (!/[0-9]/.test(e.key)) {
            e.preventDefault();
          }
        });
      });

      // Function to update response time summary
      function updateResponseTimeSummary() {
        const selectedOption = document.querySelector('input[name="responseTimeOption"]:checked').value;

        switch (selectedOption) {
          case 'default':
            responseTimeSummary.textContent = 'Recipients must respond within 24 hours';
            break;

          case 'custom':
            const days = parseInt(responseDays.value) || 0;
            const hours = parseInt(responseHours.value) || 0;
            const minutes = parseInt(responseMinutes.value) || 0;

            // Format the time string
            let timeString = '';

            if (days > 0) {
              timeString += `${days} day${days !== 1 ? 's' : ''}`;
            }

            if (hours > 0) {
              if (timeString) timeString += ', ';
              timeString += `${hours} hour${hours !== 1 ? 's' : ''}`;
            }

            if (minutes > 0) {
              if (timeString) timeString += ', ';
              timeString += `${minutes} minute${minutes !== 1 ? 's' : ''}`;
            }

            if (!timeString) {
              timeString = 'immediately';
            }

            responseTimeSummary.textContent = `Recipients must respond within ${timeString}`;
            break;

          case 'none':
            responseTimeSummary.textContent = 'No response required from recipients';
            break;
        }
      }

      // Initialize summary text
      updateResponseTimeSummary();
    });
  </script>

  <!-- Preview Script -->
  <script src="preview-script.js"></script>

  <!-- Translation Request Script -->
  <script src="translation-request.js"></script>

  <!-- Send/Schedule Script -->
  <script src="send-schedule.js"></script>

  <!-- Notification Receiver Script -->
  <script src="notification-receiver.js"></script>

  <!-- Preferences Script -->
  <script src="preferences.js"></script>

  <!-- Themes Script -->
  <script src="themes.js"></script>

  <!-- Notification Banner Script -->
  <script src="notification-banner.js"></script>

  <!-- Template Selection Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Template selection functionality
      const templateCards = document.querySelectorAll('.template-card');
      const templateSearch = document.getElementById('templateSearch');
      const createTemplateBtn = document.getElementById('createTemplateBtn');

      // Add click event to template cards
      templateCards.forEach(card => {
        card.addEventListener('click', function() {
          // Remove selected class from all cards
          templateCards.forEach(c => c.classList.remove('selected'));

          // Add selected class to clicked card
          this.classList.add('selected');

          // Get template data
          const templateId = this.getAttribute('data-template-id');
          const templateTitle = this.querySelector('.template-title').textContent;
          const templateType = this.querySelector('.template-type').textContent;

          // In a real implementation, this would load the template data into the form
          console.log(`Selected template: ${templateTitle} (ID: ${templateId}, Type: ${templateType})`);

          // For demo purposes, update the notification type and content fields
          document.getElementById('notificationType').value = templateType.toLowerCase();
          document.getElementById('notificationTitle').value = templateTitle;

          // Update Quill editor content
          const quill = Quill.find(document.getElementById('editor'));
          quill.root.innerHTML = `<p>This is a sample content for the <strong>${templateTitle}</strong> template.</p><p>You can edit this content using the rich text editor tools above.</p>`;

          // Also update the hidden input
          document.getElementById('notificationContent').value = quill.root.innerHTML;

          // Show a confirmation message
          alert(`Template "${templateTitle}" applied successfully!`);
        });
      });

      // Template search functionality
      templateSearch.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();

        templateCards.forEach(card => {
          const title = card.querySelector('.template-title').textContent.toLowerCase();
          const description = card.querySelector('.template-description').textContent.toLowerCase();
          const type = card.querySelector('.template-type').textContent.toLowerCase();

          // Show/hide cards based on search term
          if (title.includes(searchTerm) || description.includes(searchTerm) || type.includes(searchTerm)) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
      });

      // Create template button (placeholder functionality)
      createTemplateBtn.addEventListener('click', function() {
        alert('Create template functionality will be implemented in a future update.');
      });
    });
  </script>

  <!-- Notification Receiver Initialization -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize UI elements
      const createNotificationBtn = document.getElementById('createNotificationBtn');
      const composeForm = document.getElementById('composeForm');
      const notificationsView = document.getElementById('notificationsView');
      const notificationList = document.getElementById('notificationList');
      const emptyNotificationsState = document.getElementById('emptyNotificationsState');
      const markAllReadBtn = document.getElementById('markAllReadBtn');
      const clearAllNotificationsBtn = document.getElementById('clearAllNotificationsBtn');
      const filterButtons = document.querySelectorAll('.notifications-filters .filter-button');

      // Current filter
      let currentFilter = 'all';

      // Check for existing notifications
      const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
      const unreadCount = notifications.filter(n => !n.read).length;

      // Update notification count
      updateNotificationBadge(unreadCount);

      // Load notifications on page load
      loadNotifications();

      // Listen for notification count updates
      document.addEventListener('notificationReceived', function(event) {
        // Update the notification list
        loadNotifications();

        // Update the badge
        const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
        const unreadCount = notifications.filter(n => !n.read).length;
        updateNotificationBadge(unreadCount);
      });

      // Create notification button click
      if (createNotificationBtn) {
        createNotificationBtn.addEventListener('click', function() {
          // Show compose form, hide notifications view
          composeForm.classList.remove('hidden');
          notificationsView.classList.add('hidden');
        });
      }

      // Back to notifications (cancel button)
      const cancelBtn = document.getElementById('cancelBtn');
      if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
          // Show notifications view, hide compose form
          notificationsView.classList.remove('hidden');
          composeForm.classList.add('hidden');

          // Load notifications
          loadNotifications();
        });
      }

      // Mark all as read
      if (markAllReadBtn) {
        markAllReadBtn.addEventListener('click', function() {
          const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');

          // Mark all as read
          notifications.forEach(notification => {
            notification.read = true;
          });

          // Save back to localStorage
          localStorage.setItem('notifications', JSON.stringify(notifications));

          // Update UI
          loadNotifications();

          // Update badge
          updateNotificationBadge(0);
        });
      }

      // Clear all notifications
      if (clearAllNotificationsBtn) {
        clearAllNotificationsBtn.addEventListener('click', function() {
          if (confirm('Are you sure you want to clear all notifications?')) {
            // Clear notifications
            localStorage.setItem('notifications', '[]');

            // Update UI
            loadNotifications();

            // Update badge
            updateNotificationBadge(0);
          }
        });
      }

      // Filter buttons
      if (filterButtons) {
        filterButtons.forEach(button => {
          button.addEventListener('click', function() {
            // Remove active class from all buttons
            filterButtons.forEach(btn => btn.classList.remove('active'));

            // Add active class to clicked button
            this.classList.add('active');

            // Update current filter
            currentFilter = this.dataset.filter;

            // Apply filter
            loadNotifications();
          });
        });
      }

      // Function to update notification count
      function updateNotificationBadge(count) {
        // We're not displaying badges anymore, but we keep this function
        // for compatibility with the existing code
        console.log(`Unread notifications: ${count}`);
      }

      // Function to play notification sound based on user preferences
      function playNotificationSound(priority) {
        // Get user preferences
        if (!window.notificationPreferences) return;

        const preferences = window.notificationPreferences.preferences;

        // Check if notifications are enabled globally
        if (!preferences.notificationsEnabled) return;

        // Check if sound is enabled
        if (!preferences.soundEnabled) return;

        // Check if this priority should play a sound
        if (priority === 'high' && !preferences.showHighPriority) return;
        if (priority === 'normal' && !preferences.showNormalPriority) return;
        if (priority === 'low' && !preferences.showLowPriority) return;

        // Get volume (0-1)
        const volume = preferences.volume / 100;

        // Get sound type
        const soundType = preferences.soundType;

        // Play sound using Web Audio API
        try {
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          // Set volume
          gainNode.gain.value = volume;

          // Set frequency based on priority and sound type
          let frequency = 440; // Default A4

          if (priority === 'high') {
            frequency = soundType === 'bell' ? 587.33 : 523.25; // D5 or C5
          } else if (priority === 'normal') {
            frequency = soundType === 'chime' ? 493.88 : 440; // B4 or A4
          } else {
            frequency = soundType === 'subtle' ? 392 : 349.23; // G4 or F4
          }

          oscillator.frequency.value = frequency;

          // Start and stop the sound
          oscillator.start();
          setTimeout(() => {
            oscillator.stop();
          }, priority === 'high' ? 800 : 500); // Longer sound for high priority
        } catch (error) {
          console.error('Error playing notification sound:', error);
        }
      }

      // Function to load notifications
      function loadNotifications() {
        if (!notificationList || !emptyNotificationsState) return;

        // Get notifications from localStorage
        const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');

        // Get user preferences
        const preferences = window.notificationPreferences ?
          window.notificationPreferences.preferences :
          {
            notificationsEnabled: true,
            showHighPriority: true,
            showNormalPriority: true,
            showLowPriority: true
          };

        // Check if notifications are enabled globally
        if (!preferences.notificationsEnabled) {
          // If notifications are disabled, show a message
          notificationList.innerHTML = `
            <div class="notifications-disabled-message">
              <span class="material-icons">notifications_off</span>
              <h3>Notifications are disabled</h3>
              <p>You can enable notifications in the preferences.</p>
              <button class="action-button" id="openPreferencesFromDisabledBtn">
                <span class="material-icons">settings</span>
                Open Preferences
              </button>
            </div>
          `;

          // Add event listener to the button
          const openPrefsBtn = document.getElementById('openPreferencesFromDisabledBtn');
          if (openPrefsBtn) {
            openPrefsBtn.addEventListener('click', function() {
              const preferencesBtn = document.getElementById('preferencesBtn');
              if (preferencesBtn) {
                preferencesBtn.click();
              }
            });
          }

          // Hide empty state
          emptyNotificationsState.style.display = 'none';
          return;
        }

        // Apply priority preferences
        let priorityFilteredNotifications = notifications.filter(notification => {
          if (notification.priority === 'high' && !preferences.showHighPriority) return false;
          if (notification.priority === 'normal' && !preferences.showNormalPriority) return false;
          if (notification.priority === 'low' && !preferences.showLowPriority) return false;
          return true;
        });

        // Filter notifications based on current filter
        let filteredNotifications;

        switch (currentFilter) {
          case 'unread':
            filteredNotifications = priorityFilteredNotifications.filter(n => !n.read);
            break;
          case 'high':
            filteredNotifications = priorityFilteredNotifications.filter(n => n.priority === 'high');
            break;
          case 'normal':
            filteredNotifications = priorityFilteredNotifications.filter(n => n.priority === 'normal');
            break;
          case 'low':
            filteredNotifications = priorityFilteredNotifications.filter(n => n.priority === 'low');
            break;
          default:
            filteredNotifications = priorityFilteredNotifications;
        }

        // Show empty state if no notifications
        if (filteredNotifications.length === 0) {
          notificationList.innerHTML = '';
          emptyNotificationsState.style.display = 'flex';
          return;
        }

        // Hide empty state
        emptyNotificationsState.style.display = 'none';

        // Render notifications
        let notificationsHTML = '';

        filteredNotifications.forEach(notification => {
          // Format timestamp
          const date = new Date(notification.timestamp);
          const formattedTime = date.toLocaleString();

          // Create notification item HTML
          notificationsHTML += `
            <div class="notification-item ${!notification.read ? 'unread' : ''} priority-${notification.priority}" data-id="${notification.id}">
              ${!notification.read ? '<div class="unread-indicator"></div>' : ''}
              <div class="notification-header">
                <h3 class="notification-title">${notification.title}</h3>
                <span class="notification-time">${formattedTime}</span>
              </div>
              <div class="notification-content">${notification.content}</div>
              <div class="notification-footer">
                <div class="notification-meta">
                  <span class="notification-tag type-${notification.type || 'notification'}">${notification.type || 'notification'}</span>
                  <span class="notification-tag">${notification.priority}</span>
                </div>
                <div class="notification-actions">
                  ${!notification.read ?
                    `<button class="notification-action mark-read-btn" data-id="${notification.id}" title="Mark as Read">
                      <span class="material-icons">done</span>
                    </button>` : ''}
                  <button class="notification-action delete-btn" data-id="${notification.id}" title="Delete">
                    <span class="material-icons">delete</span>
                  </button>
                </div>
              </div>
            </div>
          `;
        });

        // Update notification list
        notificationList.innerHTML = notificationsHTML;

        // Add event listeners to notification items
        const notificationItems = notificationList.querySelectorAll('.notification-item');
        notificationItems.forEach(item => {
          // Mark as read when clicked
          item.addEventListener('click', function() {
            const id = this.dataset.id;
            if (!this.classList.contains('read')) {
              markAsRead(id);
            }
          });

          // Mark as read button
          const markReadBtn = item.querySelector('.mark-read-btn');
          if (markReadBtn) {
            markReadBtn.addEventListener('click', function(e) {
              e.stopPropagation();
              const id = this.dataset.id;
              markAsRead(id);
            });
          }

          // Delete button
          const deleteBtn = item.querySelector('.delete-btn');
          if (deleteBtn) {
            deleteBtn.addEventListener('click', function(e) {
              e.stopPropagation();
              const id = this.dataset.id;
              deleteNotification(id);
            });
          }
        });
      }

      // Function to mark notification as read
      function markAsRead(id) {
        const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');

        // Find notification and mark as read
        const notification = notifications.find(n => n.id === id);
        if (notification) {
          notification.read = true;

          // Save back to localStorage
          localStorage.setItem('notifications', JSON.stringify(notifications));

          // Update UI
          loadNotifications();

          // Update badge
          const unreadCount = notifications.filter(n => !n.read).length;
          updateNotificationBadge(unreadCount);
        }
      }

      // Function to delete notification
      function deleteNotification(id) {
        const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');

        // Filter out the notification to delete
        const updatedNotifications = notifications.filter(n => n.id !== id);

        // Save back to localStorage
        localStorage.setItem('notifications', JSON.stringify(updatedNotifications));

        // Update UI
        loadNotifications();

        // Update badge
        const unreadCount = updatedNotifications.filter(n => !n.read).length;
        updateNotificationBadge(unreadCount);
      }

      // Listen for preference changes
      document.addEventListener('preferencesChanged', function(event) {
        console.log('Notification preferences changed:', event.detail.preferences);
        // Apply preferences to existing notifications
        loadNotifications();
      });

      // Function to simulate receiving a notification (for demo purposes)
      window.simulateNotification = function() {
        const demoNotifications = [
          {
            title: 'System Maintenance Alert',
            content: 'The system will be down for maintenance tonight from 2 AM to 4 AM.',
            priority: 'high',
            type: 'alert'
          },
          {
            title: 'New Feature Available',
            content: 'Check out our new dashboard features! Click here to learn more.',
            priority: 'normal',
            type: 'info'
          },
          {
            title: 'Important Security Update',
            content: 'Please update your password immediately to comply with new security policies.',
            priority: 'high',
            type: 'important'
          },
          {
            title: 'Meeting Reminder',
            content: 'You have a team meeting scheduled for tomorrow at 10:00 AM in Conference Room A.',
            priority: 'normal',
            type: 'meeting'
          },
          {
            title: 'Approval Request',
            content: 'A new document requires your approval. Please review and respond by end of day.',
            priority: 'high',
            type: 'approval'
          },
          {
            title: 'Scheduled Maintenance',
            content: 'Regular system maintenance is scheduled for this weekend. No action required.',
            priority: 'low',
            type: 'scheduled'
          },
          {
            title: 'AI Recommendation',
            content: 'Based on your recent activity, we recommend optimizing your workflow with these tips.',
            priority: 'normal',
            type: 'ai'
          },
          {
            title: 'Emergency Alert',
            content: 'Office evacuation drill scheduled for today at 3:00 PM. Please follow safety protocols.',
            priority: 'high',
            type: 'emergency'
          }
        ];

        // Select a random notification
        const randomNotification = demoNotifications[Math.floor(Math.random() * demoNotifications.length)];

        // Create notification object
        const notification = {
          id: `demo-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
          title: randomNotification.title,
          content: randomNotification.content,
          priority: randomNotification.priority,
          type: randomNotification.type,
          timestamp: Date.now(),
          read: false,
          source: 'demo'
        };

        // Add to localStorage
        const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
        notifications.unshift(notification);
        localStorage.setItem('notifications', JSON.stringify(notifications));

        // Update notification counter
        const unreadCount = notifications.filter(n => !n.read).length;
        updateNotificationBadge(unreadCount);

        // Dispatch event for other pages
        const event = new CustomEvent('notificationReceived', {
          detail: { notification }
        });
        document.dispatchEvent(event);

        // Update notification list if notifications view is visible
        if (notificationsView && !notificationsView.classList.contains('hidden')) {
          loadNotifications();
        }

        // Play notification sound based on user preferences
        playNotificationSound(notification.priority);

        // Show notification banner
        if (window.notificationBanner) {
          window.notificationBanner.showBanner(notification);
        }
      };

      // Function to navigate to the next page
      window.navigateToNextPage = function() {
        // You can replace this with the actual next page URL
        alert("Navigating to next page...");
        // For demo purposes, we'll just show an alert
        // In a real application, you would use:
        // window.location.href = "next-page.html";
      };

      // Function to generate AI recommendations based on notification history
      window.generateAIRecommendation = function() {
        // Get existing notifications from localStorage
        const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');

        // If no history exists, create a default recommendation
        if (notifications.length === 0) {
          const defaultRecommendation = {
            id: `ai-rec-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
            title: 'AI Recommendation',
            content: 'Welcome to the notification system! Start by exploring the preferences to customize your experience.',
            priority: 'normal',
            type: 'ai',
            timestamp: Date.now(),
            read: false,
            source: 'ai'
          };

          // Add to localStorage
          notifications.unshift(defaultRecommendation);
          localStorage.setItem('notifications', JSON.stringify(notifications));

          // Show notification banner
          if (window.notificationBanner) {
            window.notificationBanner.showBanner(defaultRecommendation);
          }

          // Update notification counter
          const unreadCount = notifications.filter(n => !n.read).length;
          updateNotificationBadge(unreadCount);

          // Update notification list if visible
          if (notificationsView && !notificationsView.classList.contains('hidden')) {
            loadNotifications();
          }

          return;
        }

        // Analyze notification history to generate personalized recommendations
        const notificationTypes = {};
        const priorities = {};

        // Count notification types and priorities
        notifications.forEach(notification => {
          if (notification.type) {
            notificationTypes[notification.type] = (notificationTypes[notification.type] || 0) + 1;
          }
          if (notification.priority) {
            priorities[notification.priority] = (priorities[notification.priority] || 0) + 1;
          }
        });

        // Find most common type and priority
        let mostCommonType = Object.keys(notificationTypes).reduce((a, b) =>
          notificationTypes[a] > notificationTypes[b] ? a : b, Object.keys(notificationTypes)[0]);

        let mostCommonPriority = Object.keys(priorities).reduce((a, b) =>
          priorities[a] > priorities[b] ? a : b, Object.keys(priorities)[0]);

        // Generate recommendation based on history
        let recommendationContent = '';
        let recommendationTitle = 'AI Recommendation';

        // Generate content based on most common notification type
        switch(mostCommonType) {
          case 'meeting':
            recommendationTitle = 'Meeting Schedule Optimization';
            recommendationContent = 'Based on your meeting history, we recommend blocking focused work time between meetings to improve productivity.';
            break;
          case 'approval':
            recommendationTitle = 'Approval Process Improvement';
            recommendationContent = 'We notice you receive many approval requests. Consider setting up delegation rules for routine approvals to save time.';
            break;
          case 'alert':
          case 'important':
            recommendationTitle = 'Priority Management';
            recommendationContent = 'You receive many high-priority notifications. We recommend reviewing your notification preferences to reduce alert fatigue.';
            break;
          case 'scheduled':
            recommendationTitle = 'Maintenance Schedule Overview';
            recommendationContent = 'We\'ve compiled a calendar of upcoming maintenance events to help you plan your work schedule more effectively.';
            break;
          case 'emergency':
            recommendationTitle = 'Emergency Preparedness';
            recommendationContent = 'Based on recent emergency notifications, we recommend reviewing the updated safety protocols in the company handbook.';
            break;
          default:
            recommendationTitle = 'Workflow Optimization';
            recommendationContent = 'Based on your notification patterns, we recommend organizing your notifications into categories for better management.';
        }

        // Create the AI recommendation notification
        const aiRecommendation = {
          id: `ai-rec-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
          title: recommendationTitle,
          content: recommendationContent,
          priority: 'normal',
          type: 'ai',
          timestamp: Date.now(),
          read: false,
          source: 'ai'
        };

        // Add to localStorage
        notifications.unshift(aiRecommendation);
        localStorage.setItem('notifications', JSON.stringify(notifications));

        // Show notification banner
        if (window.notificationBanner) {
          window.notificationBanner.showBanner(aiRecommendation);
        }

        // Update notification counter
        const unreadCount = notifications.filter(n => !n.read).length;
        updateNotificationBadge(unreadCount);

        // Update notification list if visible
        if (notificationsView && !notificationsView.classList.contains('hidden')) {
          loadNotifications();
        }

        // Play notification sound
        playNotificationSound('normal');
      };
    });
  </script>

  <!-- Demo Buttons for Notifications (for testing purposes) -->
  <div class="notification-test-buttons">
    <button class="notification-trigger" onclick="simulateNotification()" title="Simulate Notification">
      <span class="material-icons">notifications</span>
    </button>
    <button class="notification-trigger ai-recommendation" onclick="generateAIRecommendation()" title="Generate AI Recommendation">
      <span class="material-icons">psychology</span>
    </button>
  </div>

  <!-- Right Center Arrow -->
  <div class="right-center-arrow" title="Navigate to Next Page" onclick="navigateToNextPage()">
    <span class="material-icons">arrow_forward</span>
  </div>

  <!-- Preferences Modal -->
  <div class="modal" id="preferencesModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Notification Preferences</h2>
        <button class="close-modal-btn" id="closePreferencesBtn">
          <span class="material-icons">close</span>
        </button>
      </div>

      <div class="modal-body">
        <div class="preferences-section">
          <h3 class="preferences-section-title">Notification Display</h3>

          <div class="preference-item">
            <label class="preference-label">Banner Position</label>
            <div class="preference-control">
              <select id="bannerPositionSelect" class="preference-select">
                <option value="top-right">Top Right</option>
                <option value="top-left">Top Left</option>
                <option value="bottom-right">Bottom Right</option>
                <option value="bottom-left">Bottom Left</option>
              </select>
            </div>
          </div>

          <div class="preference-item">
            <label class="preference-label">Auto-dismiss Duration</label>
            <div class="preference-control">
              <select id="autoDismissDurationSelect" class="preference-select">
                <option value="0">Don't auto-dismiss</option>
                <option value="3000">3 seconds</option>
                <option value="5000" selected>5 seconds</option>
                <option value="10000">10 seconds</option>
                <option value="15000">15 seconds</option>
              </select>
            </div>
          </div>
        </div>

        <div class="preferences-section">
          <h3 class="preferences-section-title">Themes & Appearance</h3>

          <div class="preference-item">
            <label class="preference-label">Dark Mode</label>
            <div class="preference-control">
              <div class="toggle-switch">
                <input type="checkbox" id="darkModeToggle" class="toggle-input">
                <label for="darkModeToggle" class="toggle-label"></label>
              </div>
            </div>
            <div class="preference-description">
              Switch between light and dark color themes
            </div>
          </div>

          <div class="preference-item">
            <label class="preference-label">Font Size</label>
            <div class="preference-control">
              <select id="fontSizeSelect" class="preference-select">
                <option value="small">Small</option>
                <option value="medium" selected>Medium</option>
                <option value="large">Large</option>
                <option value="x-large">Extra Large</option>
              </select>
            </div>
          </div>

          <div class="preference-item">
            <label class="preference-label">Font Family</label>
            <div class="preference-control">
              <select id="fontFamilySelect" class="preference-select">
                <option value="inter" selected>Inter (Default)</option>
                <option value="roboto">Roboto</option>
                <option value="open-sans">Open Sans</option>
                <option value="montserrat">Montserrat</option>
                <option value="system">System Font</option>
              </select>
            </div>
            <div class="preference-description">
              Choose your preferred font style
            </div>
          </div>
        </div>

        <div class="preferences-section">
          <h3 class="preferences-section-title">Sound & Alerts</h3>

          <div class="preference-item">
            <label class="preference-label">Sound Notifications</label>
            <div class="preference-control">
              <div class="toggle-switch">
                <input type="checkbox" id="soundToggle" class="toggle-input">
                <label for="soundToggle" class="toggle-label"></label>
              </div>
            </div>
          </div>

          <div class="preference-item">
            <label class="preference-label">Sound Volume</label>
            <div class="preference-control">
              <input type="range" id="volumeSlider" min="0" max="100" value="50" class="volume-slider">
              <span class="volume-value" id="volumeValue">50%</span>
            </div>
          </div>

          <div class="preference-item">
            <label class="preference-label">Sound Type</label>
            <div class="preference-control">
              <select id="soundTypeSelect" class="preference-select">
                <option value="default">Default</option>
                <option value="subtle">Subtle</option>
                <option value="chime">Chime</option>
                <option value="bell">Bell</option>
              </select>
              <button class="test-sound-btn" id="testSoundBtn">
                <span class="material-icons">volume_up</span>
                Test
              </button>
            </div>
          </div>
        </div>

        <div class="preferences-section">
          <h3 class="preferences-section-title">Notification Settings</h3>

          <div class="preference-item">
            <label class="preference-label">Enable Notifications</label>
            <div class="preference-control">
              <div class="toggle-switch">
                <input type="checkbox" id="enableNotificationsToggle" class="toggle-input" checked>
                <label for="enableNotificationsToggle" class="toggle-label"></label>
              </div>
            </div>
            <div class="preference-description">
              Turn all notifications on or off
            </div>
          </div>
        </div>

        <div class="preferences-section">
          <h3 class="preferences-section-title">Priority Settings</h3>

          <div class="preference-item">
            <label class="preference-label">High Priority Notifications</label>
            <div class="preference-control">
              <div class="toggle-switch">
                <input type="checkbox" id="highPriorityToggle" class="toggle-input" checked>
                <label for="highPriorityToggle" class="toggle-label"></label>
              </div>
            </div>
          </div>

          <div class="preference-item">
            <label class="preference-label">Normal Priority Notifications</label>
            <div class="preference-control">
              <div class="toggle-switch">
                <input type="checkbox" id="normalPriorityToggle" class="toggle-input" checked>
                <label for="normalPriorityToggle" class="toggle-label"></label>
              </div>
            </div>
          </div>

          <div class="preference-item">
            <label class="preference-label">Low Priority Notifications</label>
            <div class="preference-control">
              <div class="toggle-switch">
                <input type="checkbox" id="lowPriorityToggle" class="toggle-input" checked>
                <label for="lowPriorityToggle" class="toggle-label"></label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="secondary-button" id="resetPreferencesBtn">Reset to Defaults</button>
        <button class="primary-button" id="savePreferencesBtn">Save Preferences</button>
      </div>
    </div>
  </div>

  <!-- Preview Modal -->
  <div class="preview-modal" id="previewModal">
    <div class="preview-modal-content">
      <div class="preview-modal-header">
        <h2>Notification Preview</h2>
        <button class="close-modal-btn" id="closePreviewBtn">
          <span class="material-icons">close</span>
        </button>
      </div>

      <div class="preview-modal-body">
        <div class="preview-controls">
          <div class="preview-control-group">
            <label>Preview for:</label>
            <select id="previewLanguageSelect" class="preview-select">
              <!-- Language options will be populated dynamically -->
            </select>
          </div>

          <div class="preview-control-group">
            <label>Device type:</label>
            <select id="previewDeviceSelect" class="preview-select">
              <option value="mobile">Mobile</option>
              <option value="desktop">Desktop</option>
            </select>
          </div>

          <div class="preview-control-group">
            <label>Recipient type:</label>
            <select id="previewRecipientTypeSelect" class="preview-select">
              <option value="customer">Customer</option>
              <option value="employee">Employee</option>
              <option value="partner">Partner</option>
            </select>
          </div>

          <div class="preview-control-group preview-recipients-control">
            <div class="preview-recipients-summary">
              <span id="previewRecipientCount">0 recipients selected</span>
              <button class="preview-edit-recipients-btn" id="previewEditRecipientsBtn">
                <span class="material-icons">edit</span>
                Edit Recipients
              </button>
            </div>
          </div>
        </div>

        <div class="preview-device-container">
          <div class="preview-device mobile" id="previewDeviceFrame">
            <div class="preview-device-header">
              <div class="preview-device-status-bar">
                <span class="preview-time">9:41</span>
                <div class="preview-status-icons">
                  <span class="material-icons">signal_cellular_alt</span>
                  <span class="material-icons">wifi</span>
                  <span class="material-icons">battery_full</span>
                </div>
              </div>
              <div class="preview-app-bar">
                <span class="material-icons">arrow_back</span>
                <span class="preview-app-title">Notifications</span>
                <span class="material-icons">more_vert</span>
              </div>
            </div>

            <div class="preview-device-content">
              <div class="preview-notification" id="previewNotification">
                <!-- Notification preview content will be inserted here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Recipients Modal -->
  <div class="modal" id="editRecipientsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Recipients</h2>
        <button class="close-modal-btn" id="closeEditRecipientsBtn">
          <span class="material-icons">close</span>
        </button>
      </div>

      <div class="modal-body">
        <div class="edit-recipients-summary">
          <div class="summary-header">
            <h3>Selected Recipients</h3>
            <span class="recipient-count-badge" id="selectedRecipientCount">0 recipients</span>
          </div>

          <div class="language-tabs" id="editRecipientsLanguageTabs">
            <!-- Language tabs will be populated dynamically -->
          </div>

          <div class="selected-recipients-container">
            <div id="selectedRecipientsList" class="selected-recipients-list">
              <!-- Selected recipients will be populated dynamically -->
              <div class="empty-selection-message">No recipients selected</div>
            </div>
          </div>
        </div>

        <div class="edit-recipients-actions">
          <button class="secondary-button" id="addMoreRecipientsBtn">
            <span class="material-icons">person_add</span>
            Add More Recipients
          </button>
          <button class="primary-button" id="saveRecipientsBtn">
            <span class="material-icons">check</span>
            Save Changes
          </button>
        </div>

        <div class="add-recipients-section hidden" id="addRecipientsSection">
          <div class="section-header">
            <h3>Add Recipients</h3>
            <button class="close-section-btn" id="closeAddRecipientsBtn">
              <span class="material-icons">expand_less</span>
            </button>
          </div>

          <div class="recipient-filter-options compact" id="editRecipientFilterOptions">
            <!-- Filter options will be cloned from the main form -->
          </div>

          <div class="recipient-search-bar compact">
            <div class="recipient-search">
              <span class="material-icons search-icon">search</span>
              <input type="text" id="editRecipientSearch" placeholder="Search recipients...">
            </div>
          </div>

          <div class="recipient-list-container compact">
            <div class="recipient-list-header">
              <span>Recipients</span>
              <button class="select-all-btn" id="editSelectAllBtn">Select All Visible</button>
            </div>
            <div id="editRecipientList" class="recipient-list">
              <!-- Recipients will be cloned from the main form -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="recipient-selection.js"></script>
  <script src="language-selection.js"></script>
  <script src="send-schedule.js"></script>
  <script src="notification-display.js"></script>

  <script>
    // Direct notification function that bypasses the event listener issues
    function sendDirectNotification() {
      // Get selected send option
      const sendOption = document.querySelector('input[name="sendOption"]:checked');
      if (!sendOption) {
        alert('Please select a send option (immediate or scheduled)');
        return;
      }

      try {
        if (sendOption.value === 'immediate') {
          // Get notification data
          const notificationTitle = document.getElementById('notificationTitle').value || 'Sample Notification';
          const notificationContent = document.getElementById('notificationContent').value || 'This is a sample notification content.';

          // Show success message
          alert('Notification sent successfully!');
          console.log('Sent notification with title:', notificationTitle);

          // Create custom popup as backup
          showCustomPopup('Notification sent successfully!');
        } else if (sendOption.value === 'scheduled') {
          // Get schedule elements
          const scheduleDate = document.getElementById('scheduleDate');
          const scheduleTime = document.getElementById('scheduleTime');
          const scheduleTimezone = document.getElementById('scheduleTimezone');

          if (!scheduleDate || !scheduleDate.value) {
            alert('Please select a date for the scheduled notification.');
            if (scheduleDate) scheduleDate.focus();
            return;
          }

          if (!scheduleTime || !scheduleTime.value) {
            alert('Please select a time for the scheduled notification.');
            if (scheduleTime) scheduleTime.focus();
            return;
          }

          // Format date for display
          const scheduledDateTime = new Date(`${scheduleDate.value}T${scheduleTime.value}`);
          const options = {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          };
          const formattedDateTime = scheduledDateTime.toLocaleDateString(undefined, options);
          const timezone = scheduleTimezone.options[scheduleTimezone.selectedIndex].text;

          // Show scheduled alert
          alert(`Notification scheduled for ${formattedDateTime} (${timezone}).`);

          // Create custom popup as backup
          showCustomPopup(`Notification scheduled for ${formattedDateTime} (${timezone}).`);
        }
      } catch (error) {
        console.error('Error in sendDirectNotification:', error);
        alert('An error occurred: ' + error.message);
      }
    }

    // Custom popup function
    function showCustomPopup(message) {
      // Check if popup container already exists
      let popupContainer = document.getElementById('custom-popup-container');

      // Create popup container if it doesn't exist
      if (!popupContainer) {
        popupContainer = document.createElement('div');
        popupContainer.id = 'custom-popup-container';
        popupContainer.style.position = 'fixed';
        popupContainer.style.top = '0';
        popupContainer.style.left = '0';
        popupContainer.style.width = '100%';
        popupContainer.style.height = '100%';
        popupContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        popupContainer.style.display = 'flex';
        popupContainer.style.justifyContent = 'center';
        popupContainer.style.alignItems = 'center';
        popupContainer.style.zIndex = '9999';
        document.body.appendChild(popupContainer);
      }

      // Create popup content
      const popup = document.createElement('div');
      popup.style.backgroundColor = '#222';
      popup.style.color = '#fff';
      popup.style.padding = '20px';
      popup.style.borderRadius = '5px';
      popup.style.maxWidth = '400px';
      popup.style.textAlign = 'center';
      popup.style.boxShadow = '0 0 10px rgba(0, 0, 0, 0.3)';

      // Add message
      const messageElement = document.createElement('p');
      messageElement.textContent = message;
      messageElement.style.marginBottom = '20px';
      popup.appendChild(messageElement);

      // Add close button
      const closeButton = document.createElement('button');
      closeButton.textContent = 'OK';
      closeButton.style.padding = '8px 16px';
      closeButton.style.backgroundColor = '#444';
      closeButton.style.color = '#fff';
      closeButton.style.border = 'none';
      closeButton.style.borderRadius = '3px';
      closeButton.style.cursor = 'pointer';
      closeButton.onclick = function() {
        document.body.removeChild(popupContainer);
      };
      popup.appendChild(closeButton);

      // Add popup to container
      popupContainer.innerHTML = '';
      popupContainer.appendChild(popup);

      console.log('Custom popup displayed with message:', message);
    }
  </script>
</body>
</html>
