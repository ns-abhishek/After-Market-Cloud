<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - Invoice Management</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/themes.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-file-invoice-dollar me-2"></i>
                Invoice Management
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="dashboard.html">
                            <i class="fas fa-chart-pie me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-plus me-1"></i>Add New
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="openAddModal('customer')">Customer Invoice</a></li>
                            <li><a class="dropdown-item" href="#" onclick="openAddModal('service-return')">Service Return</a></li>
                            <li><a class="dropdown-item" href="#" onclick="openAddModal('internal')">Internal Invoice</a></li>
                            <li><a class="dropdown-item" href="#" onclick="openAddModal('internal-return')">Internal Return</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-download me-1"></i>Export
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="exportData('pdf')">Export as PDF</a></li>
                            <li><a class="dropdown-item" href="#" onclick="exportData('excel')">Export as Excel</a></li>
                        </ul>
                    </li>
                </ul>

                <ul class="navbar-nav">
                    <li class="nav-item">
                        <button class="btn btn-link nav-link theme-toggle" onclick="toggleTheme()" title="Toggle theme">
                            <i class="fas fa-moon" id="themeIcon"></i>
                        </button>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-globe me-1"></i>Language
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="setLanguage('en')">English</a></li>
                            <li><a class="dropdown-item" href="#" onclick="setLanguage('es')">Español</a></li>
                            <li><a class="dropdown-item" href="#" onclick="setLanguage('fr')">Français</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container-fluid">


            <!-- Page Header -->
            <div class="row mb-2">
                <div class="col-12">
                    <div class="dashboard-header">
                        <h1 class="h4 mb-1">
                            <i class="fas fa-chart-line me-2"></i>
                            Analytics Dashboard
                        </h1>
                        <p class="mb-0 text-muted small">Comprehensive insights into your invoice management system</p>
                    </div>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="row g-2 mb-3">
                <div class="col-lg-3 col-md-6">
                    <div class="kpi-card">
                        <div class="kpi-icon">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 class="kpi-value" id="totalInvoices">248</h3>
                            <p class="kpi-label">Total Invoices</p>
                            <div class="kpi-trend positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>12% from last month</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="kpi-card">
                        <div class="kpi-icon revenue">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 class="kpi-value" id="totalRevenue">$125,430</h3>
                            <p class="kpi-label">Total Revenue</p>
                            <div class="kpi-trend positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>8% from last month</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="kpi-card">
                        <div class="kpi-icon warning">
                            <i class="fas fa-undo-alt"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 class="kpi-value" id="pendingReturns">35</h3>
                            <p class="kpi-label">Pending Returns</p>
                            <div class="kpi-trend negative">
                                <i class="fas fa-arrow-down"></i>
                                <span>5% from last month</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="kpi-card">
                        <div class="kpi-icon success">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 class="kpi-value" id="completionRate">92%</h3>
                            <p class="kpi-label">Completion Rate</p>
                            <div class="kpi-trend positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>3% from last month</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row 1 -->
            <div class="row g-2 mb-2">
                <div class="col-lg-8">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h6 class="mb-1">Revenue Trend</h6>
                            <div class="chart-controls">
                                <select class="form-select form-select-sm" id="revenueTimeframe">
                                    <option value="7">Last 7 days</option>
                                    <option value="30" selected>Last 30 days</option>
                                    <option value="90">Last 90 days</option>
                                    <option value="365">Last year</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h6 class="mb-1">Invoice Status Distribution</h6>
                        </div>
                        <div class="chart-body">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row 2 -->
            <div class="row g-2 mb-2">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h6 class="mb-1">Payment Methods</h6>
                        </div>
                        <div class="chart-body">
                            <canvas id="paymentChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h6 class="mb-1">Monthly Comparison</h6>
                        </div>
                        <div class="chart-body">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="row">
                <div class="col-12">
                    <div class="activity-container">
                        <div class="activity-header">
                            <h6 class="mb-1">Recent Activity</h6>
                            <a href="customer-invoice.html" class="btn btn-outline-primary btn-sm">View All</a>
                        </div>
                        <div class="activity-body">
                            <div class="activity-list" id="activityList">
                                <!-- Activity items will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals and Components will be loaded here -->
    <div id="modal-container"></div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/navigation.js"></script>
    <script src="../assets/js/themes.js"></script>
    <script src="../assets/js/language.js"></script>
    <script src="../assets/js/charts.js"></script>

    <script>
        // Dashboard-specific initialization
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
        });

        function initializeDashboard() {
            loadDashboardData();
            initializeCharts();
            loadRecentActivity();
            setupDashboardEventListeners();
        }

        function loadDashboardData() {
            // Simulate loading dashboard data
            animateKPIValues();
        }

        function animateKPIValues() {
            // Animate KPI values on load
            const kpiValues = [
                { element: 'totalInvoices', target: 248, prefix: '', suffix: '' },
                { element: 'totalRevenue', target: 125430, prefix: '$', suffix: '' },
                { element: 'pendingReturns', target: 35, prefix: '', suffix: '' },
                { element: 'completionRate', target: 92, prefix: '', suffix: '%' }
            ];

            kpiValues.forEach(kpi => {
                animateValue(kpi.element, 0, kpi.target, 2000, kpi.prefix, kpi.suffix);
            });
        }

        function animateValue(elementId, start, end, duration, prefix = '', suffix = '') {
            const element = document.getElementById(elementId);
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;

            const timer = setInterval(() => {
                current += increment;
                if (current >= end) {
                    current = end;
                    clearInterval(timer);
                }

                let value = Math.floor(current);
                if (elementId === 'totalRevenue') {
                    value = value.toLocaleString();
                }

                element.textContent = prefix + value + suffix;
            }, 16);
        }

        function initializeCharts() {
            createRevenueChart();
            createStatusChart();
            createPaymentChart();
            createComparisonChart();
        }

        function createRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');

            const data = {
                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                datasets: [{
                    label: 'Revenue',
                    data: [28500, 32100, 29800, 35030],
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            };

            new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function createStatusChart() {
            const ctx = document.getElementById('statusChart').getContext('2d');

            const data = {
                labels: ['Completed', 'Pending', 'Active', 'Cancelled'],
                datasets: [{
                    data: [124, 35, 67, 22],
                    backgroundColor: [
                        '#28a745',
                        '#ffc107',
                        '#007bff',
                        '#dc3545'
                    ]
                }]
            };

            new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createPaymentChart() {
            const ctx = document.getElementById('paymentChart').getContext('2d');

            const data = {
                labels: ['Card', 'Bank Transfer', 'Cash', 'Check'],
                datasets: [{
                    data: [45, 30, 15, 10],
                    backgroundColor: [
                        '#007bff',
                        '#28a745',
                        '#ffc107',
                        '#6c757d'
                    ]
                }]
            };

            new Chart(ctx, {
                type: 'pie',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createComparisonChart() {
            const ctx = document.getElementById('comparisonChart').getContext('2d');

            const data = {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'This Year',
                    data: [65, 78, 85, 92, 88, 95],
                    backgroundColor: 'rgba(54, 162, 235, 0.8)'
                }, {
                    label: 'Last Year',
                    data: [58, 72, 80, 85, 82, 88],
                    backgroundColor: 'rgba(255, 99, 132, 0.8)'
                }]
            };

            new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function loadRecentActivity() {
            const activities = [
                {
                    type: 'invoice',
                    icon: 'fas fa-file-invoice',
                    title: 'New customer invoice created',
                    description: 'Invoice CI0248 for John Doe - $1,250.00',
                    time: '2 minutes ago',
                    color: 'primary'
                },
                {
                    type: 'payment',
                    icon: 'fas fa-credit-card',
                    title: 'Payment received',
                    description: 'Payment for Invoice CI0247 - $850.00',
                    time: '15 minutes ago',
                    color: 'success'
                },
                {
                    type: 'return',
                    icon: 'fas fa-undo-alt',
                    title: 'Service return processed',
                    description: 'Return SRV001 for Model-A123 completed',
                    time: '1 hour ago',
                    color: 'warning'
                },
                {
                    type: 'email',
                    icon: 'fas fa-envelope',
                    title: 'Invoice email sent',
                    description: 'Invoice CI0246 sent to jane.smith@email.com',
                    time: '2 hours ago',
                    color: 'info'
                },
                {
                    type: 'update',
                    icon: 'fas fa-edit',
                    title: 'Invoice updated',
                    description: 'Invoice CI0245 status changed to completed',
                    time: '3 hours ago',
                    color: 'secondary'
                }
            ];

            const activityList = document.getElementById('activityList');
            activityList.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon bg-${activity.color}">
                        <i class="${activity.icon}"></i>
                    </div>
                    <div class="activity-content">
                        <h6 class="activity-title">${activity.title}</h6>
                        <p class="activity-description">${activity.description}</p>
                        <small class="activity-time">${activity.time}</small>
                    </div>
                </div>
            `).join('');
        }

        function setupDashboardEventListeners() {
            // Revenue timeframe selector
            document.getElementById('revenueTimeframe').addEventListener('change', function() {
                updateRevenueChart(this.value);
            });
        }

        function updateRevenueChart(timeframe) {
            // Simulate updating chart data based on timeframe
            showToast(`Revenue chart updated for ${timeframe} days`, 'info');
        }
    </script>
</body>
</html>
